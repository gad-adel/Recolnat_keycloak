import{jsx as e,jsxs as p,Fragment as H}from"react/jsx-runtime";import{u as S,F as b,b0 as Y,b1 as B,a as G,Z as L,r as z,j as E,O as le,i as I,C as A,S as D,b as W,c as P,a5 as F,R as w,Q as oe,bo as $,a4 as ee,g as te,B as O,h as ae,m as se,a6 as de,z as ce,D as ue,d as pe,f as me,P as he,aE as be,L as ge,dx as ie,A as ve,G as fe,dG as ye}from"./index-sihFV1NS.js";import{useState as q,useMemo as Ce,useEffect as ke}from"react";import{F as Te}from"./FixedButtonGroup-6gQXZmA0.js";import{V as qe}from"./ViewHeader-xo54NRb6.js";import{u as _}from"./useParams-OD1jI_R2.js";import{U as Se}from"./UserProfileContext-1YYbbzWi.js";import{F as U}from"./FormAccess-EK-4wbwg.js";import{K as Ve}from"./KeyValueInput-CbiNnu-2.js";/* empty css                               */import{K as Q}from"./KeycloakTextInput--S1SG2UN.js";import{u as Ne}from"./ConfirmDialog-WMVurgkl.js";import{u as re}from"./useToggle-mZS4AEtR.js";import{D as Ae}from"./DynamicComponents-f6aNOnzT.js";import{M as Ie,a as xe}from"./Modal-uOAPm2rX.js";import{F as ne}from"./Form-bfj-xQZn.js";import{T as Re,O as we,P as J,Q as j,R as Pe,S as K}from"./Td-uwYquKT4.js";import{i as Oe}from"./isEqual-guRJoAyD.js";import"react-dom";import"./ToolbarContent-46I9Yg7h.js";import"./copy-icon-WaWzxYgU.js";import"./minus-icon-3MARcJXf.js";import"./ActionListItem-1jrwMZdM.js";import"./EmptyStateBody-jnnI7hpP.js";import"./ClientSelect-sh5SEoBO.js";import"./FileUpload-LIezXv7x.js";import"./CodeEditor-7uqvO0EK.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./GroupPickerDialog-gC2-xBPw.js";import"./PaginatingTableToolbar--Dt3wwL6.js";import"./TableToolbar-vuixsfwd.js";import"./DataListItemRow-te2VcAoi.js";import"./data-list-CDN1kyj9.js";import"./grip-vertical-icon-accuSWkz.js";import"./_baseRest-lI6NnEVt.js";import"./Flex-W2FoLD7u.js";import"./FlexItem-Mxf6oLng.js";import"./MultiLineInput-MBnUzZD_.js";import"./PasswordInput-P6txGPqu.js";import"./AddRoleMappingModal-uxjjMt5W.js";import"./useLocaleSort-K-jL4v2R.js";import"./KeycloakDataTable-Q3kZYP9q.js";import"./resource-BRtaBrSc.js";import"./filter-icon-0B3gA_nj.js";import"./KeycloakTextArea-NBwG1p2x.js";const Le=()=>{const{t}=S();return e(U,{role:"manage-realm",isHorizontal:!0,children:e(b,{hasNoPaddingTop:!0,label:t("annotations"),fieldId:"kc-annotations",className:"kc-annotations-label",children:e(Y,{className:"kc-annotations",children:e(B,{children:e(Ve,{name:"annotations",defaultKeyValue:[{key:"inputType",label:t("inputType"),values:["text","textarea","select","select-radiobuttons","multiselect","multiselect-checkboxes","html5-email","html5-tel","html5-url","html5-number","html5-range","html5-datetime-local","html5-date","html5-month","html5-week","html5-time"]},{key:"inputHelperTextBefore",label:t("inputHelperTextBefore")},{key:"inputHelperTextAfter",label:t("inputHelperTextAfter")},{key:"inputOptionLabelsI18nPrefix",label:t("inputOptionLabelsI18nPrefix")},{key:"inputTypePlaceholder",label:t("inputTypePlaceholder")},{key:"inputTypeSize",label:t("inputTypeSize")},{key:"inputTypeCols",label:t("inputTypeCols")},{key:"inputTypeRows",label:t("inputTypeRows")},{key:"inputTypeStep",label:t("inputTypeStep")}]})})})})})},Z=[{label:"requiredForLabel.both",value:["admin","user"]},{label:"requiredForLabel.users",value:["user"]},{label:"requiredForLabel.admins",value:["admin"]}],De=()=>{const{t}=S(),i=G(),[o,l]=q(),[d,c]=q(),[m,h]=q(!1),[C,s]=q(!1),[g,v]=q(!1),{attributeName:u}=_(),n=!!u,y=L({control:i.control,name:"hasSelector"}),k=L({control:i.control,name:"hasRequiredScopes"}),N=L({control:i.control,name:"isRequired",defaultValue:!1});if(z(()=>E.clientScopes.find(),l,[]),z(()=>E.users.getProfile(),c,[]),!o)return e(le,{});function x(a){i.setValue("hasSelector",a)}function f(a){i.setValue("hasRequiredScopes",a)}return p(U,{role:"manage-realm",isHorizontal:!0,children:[e(b,{label:t("attributeName"),labelIcon:e(I,{helpText:t("attributeNameHelp"),fieldLabelId:"attributeName"}),fieldId:"kc-attribute-name",isRequired:!0,validated:i.formState.errors.name?"error":"default",helperTextInvalid:t("validateAttributeName"),children:e(Q,{isRequired:!0,id:"kc-attribute-name",defaultValue:"","data-testid":"attribute-name",isDisabled:n,validated:i.formState.errors.name?"error":"default",...i.register("name",{required:!0})})}),e(b,{label:t("attributeDisplayName"),labelIcon:e(I,{helpText:t("attributeDisplayNameHelp"),fieldLabelId:"attributeDisplayName"}),fieldId:"kc-attribute-display-name",children:e(Q,{id:"kc-attribute-display-name",defaultValue:"","data-testid":"attribute-display-name",...i.register("displayName")})}),e(b,{label:t("attributeGroup"),labelIcon:e(I,{helpText:t("attributeGroupHelp"),fieldLabelId:"realm-setting:attributeGroup"}),fieldId:"kc-attribute-group",children:e(A,{name:"group",defaultValue:"",control:i.control,render:({field:a})=>e(D,{toggleId:"kc-attributeGroup",onToggle:()=>v(!g),isOpen:g,onSelect:(r,R)=>{a.onChange(R.toString()),v(!1)},selections:[a.value||t("none")],variant:W.single,children:[e(P,{value:"",children:t("none")},"empty"),...d?.groups?.map(r=>e(P,{value:r.name,children:r.name},r.name))||[]]})})}),!We.includes(u)&&p(H,{children:[e(F,{}),p(b,{label:t("enabledWhen"),fieldId:"enabledWhen",hasNoPaddingTop:!0,children:[e(w,{id:"always","data-testid":"always",isChecked:!y,name:"enabledWhen",label:t("always"),onChange:()=>x(!1),className:"pf-u-mb-md"}),e(w,{id:"scopesAsRequested","data-testid":"scopesAsRequested",isChecked:y,name:"enabledWhen",label:t("scopesAsRequested"),onChange:()=>x(!0),className:"pf-u-mb-md"})]}),y&&e(b,{fieldId:"kc-scope-enabled-when",children:e(A,{name:"selector.scopes",control:i.control,defaultValue:[],render:({field:a})=>e(D,{name:"scopes","data-testid":"enabled-when-scope-field",variant:W.typeaheadMulti,typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:t("hide"),collapsedText:t("showRemaining")},onToggle:r=>h(r),selections:a.value,onSelect:(r,R)=>{const T=R.toString();let V=[""];a.value?V=a.value.includes(T)?a.value.filter(M=>M!==T):[...a.value,T]:V=[T],a.onChange(V)},onClear:r=>{r.stopPropagation(),a.onChange([])},isOpen:m,"aria-labelledby":"scope",children:o.map(r=>e(P,{value:r.name},r.name))})})}),e(F,{}),e(b,{label:t("required"),labelIcon:e(I,{helpText:t("requiredHelp"),fieldLabelId:"required"}),fieldId:"kc-required",hasNoPaddingTop:!0,children:e(A,{name:"isRequired","data-testid":"required",defaultValue:!1,control:i.control,render:({field:a})=>e(oe,{id:"kc-required",onChange:a.onChange,isChecked:a.value,label:t("on"),labelOff:t("off"),"aria-label":t("required")})})}),N&&p(H,{children:[e(b,{label:t("requiredFor"),fieldId:"requiredFor",hasNoPaddingTop:!0,children:e(A,{name:"required.roles","data-testid":"requiredFor",defaultValue:Z[0].value,control:i.control,render:({field:a})=>e("div",{className:"kc-requiredFor",children:Z.map(r=>e(w,{id:r.label,"data-testid":r.label,isChecked:Oe(a.value,r.value),name:"roles",onChange:()=>{a.onChange(r.value)},label:t(r.label),className:"kc-requiredFor-option"},r.label))})})}),p(b,{label:t("requiredWhen"),fieldId:"requiredWhen",hasNoPaddingTop:!0,children:[e(w,{id:"requiredAlways","data-testid":"requiredAlways",isChecked:!k,name:"requiredWhen",label:t("always"),onChange:()=>f(!1),className:"pf-u-mb-md"}),e(w,{id:"requiredScopesAsRequested","data-testid":"requiredScopesAsRequested",isChecked:k,name:"requiredWhen",label:t("scopesAsRequested"),onChange:()=>f(!0),className:"pf-u-mb-md"})]}),k&&e(b,{fieldId:"kc-scope-required-when",children:e(A,{name:"required.scopes",control:i.control,defaultValue:[],render:({field:a})=>e(D,{name:"scopeRequired","data-testid":"required-when-scope-field",variant:W.typeaheadMulti,typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:t("hide"),collapsedText:t("showRemaining")},onToggle:r=>s(r),selections:a.value,onSelect:(r,R)=>{const T=R.toString();let V=[""];a.value?V=a.value.includes(T)?a.value.filter(M=>M!==T):[...a.value,T]:V=[T],a.onChange(V)},onClear:r=>{r.stopPropagation(),a.onChange([])},isOpen:C,"aria-labelledby":"scope",children:o.map(r=>e(P,{value:r.name},r.name))})})})]})]})]})},X=({name:t})=>{const{t:i}=S(),{control:o}=G();return e(Y,{children:e(A,{name:`permissions.${t}`,control:o,defaultValue:[],render:({field:l})=>p(H,{children:[e(B,{lg:4,sm:6,children:e($,{id:`user-${t}`,label:i("user"),value:"user","data-testid":`user-${t}`,isChecked:l.value.includes("user"),onChange:()=>{const d="user",c=l.value.includes(d)?l.value.filter(m=>m!==d):[...l.value,d];l.onChange(c)}})}),e(B,{lg:8,sm:6,children:e($,{id:`admin-${t}`,label:i("admin"),value:"admin","data-testid":`admin-${t}`,isChecked:l.value.includes("admin"),onChange:()=>{const d="admin",c=l.value.includes(d)?l.value.filter(m=>m!==d):[...l.value,d];l.onChange(c)}})})]})})})},He=()=>{const{t}=S();return p(U,{role:"manage-realm",isHorizontal:!0,children:[e(b,{hasNoPaddingTop:!0,label:t("whoCanEdit"),labelIcon:e(I,{helpText:t("whoCanEditHelp"),fieldLabelId:"whoCanEdit"}),fieldId:"kc-who-can-edit",children:e(X,{name:"edit"})}),e(b,{hasNoPaddingTop:!0,label:t("whoCanView"),labelIcon:e(I,{helpText:t("whoCanViewHelp"),fieldLabelId:"whoCanView"}),fieldId:"kc-who-can-view",children:e(X,{name:"view"})})]})},Ee=({selectedValidators:t,onChange:i})=>{const{t:o}=S(),l=ee().componentTypes?.["org.keycloak.validate.Validator"]||[],d=Ce(()=>l.filter(({id:s})=>!t.includes(s)),[t]),[c,m]=re(),[h,C]=q();return e(b,{label:o("validatorType"),fieldId:"validator",children:e(D,{toggleId:"validator",onToggle:m,onSelect:(s,g)=>{const v=g;i(v),C(v),m()},selections:h?.id,variant:"single","aria-label":o("selectOne"),isOpen:c,placeholderText:o("choose"),menuAppendTo:"parent",maxHeight:300,children:d.map(s=>e(P,{selected:h?.id===s.id,value:s,description:s.helpText,children:s.id},s.id))})})},Ge=({selectedValidators:t,toggleDialog:i,onConfirm:o})=>{const{t:l}=S(),[d,c]=q(),m=ee().componentTypes?.["org.keycloak.validate.Validator"].length===t.length,h=te(),{handleSubmit:C}=h,s=g=>{o({...g,id:d?.id}),i()};return e(Ie,{variant:xe.small,title:l("addValidator"),isOpen:!0,onClose:i,actions:[e(O,{"data-testid":"save-validator-role-button",variant:"primary",type:"submit",form:"add-validator",children:l("save")},"save"),e(O,{"data-testid":"cancel-validator-role-button",variant:"link",onClick:i,children:l("cancel")},"cancel")],children:m?l("emptyValidators"):p(ne,{id:"add-validator",onSubmit:C(s),children:[e(Ee,{selectedValidators:t.map(g=>g.key),onChange:c}),d&&e(ae,{...h,children:e(Ae,{properties:d.properties})})]})})},Me=()=>{const{t}=S(),[i,o]=re(),[l,d]=q(),{setValue:c,control:m,register:h,getValues:C}=G(),s=L({name:"validations",control:m,defaultValue:[]});ke(()=>{h("validations")},[h]);const[g,v]=Ne({titleKey:t("deleteValidatorConfirmTitle"),messageKey:t("deleteValidatorConfirmMsg",{validatorName:l}),continueButtonLabel:"delete",continueButtonVariant:se.danger,onConfirm:async()=>{const u=s.filter(n=>n.key!==l);c("validations",[...u])}});return p(H,{children:[i&&e(Ge,{selectedValidators:s,onConfirm:u=>{const n=C("annotations");u.id==="options"&&!n.find(y=>y.key==="inputType")&&c("annotations",[...n,{key:"inputType",value:"select"}]),c("validations",[...s,{key:u.id,value:u.config}])},toggleDialog:o}),e(v,{}),p("div",{className:"kc-attributes-validations",children:[e(O,{id:"addValidator",onClick:()=>o(),variant:"link","data-testid":"addValidator",className:"kc--attributes-validations--add-validation-button",icon:e(de,{}),children:t("addValidator")}),e(F,{}),s.length!==0?p(Re,{children:[e(we,{children:p(J,{children:[e(j,{children:t("validatorColNames.colName")}),e(j,{children:t("validatorColNames.colConfig")}),e(j,{"aria-hidden":"true"})]})}),e(Pe,{children:s.map(u=>p(J,{children:[e(K,{dataLabel:t("validatorColNames.colName"),children:u.key}),e(K,{dataLabel:t("validatorColNames.colConfig"),children:JSON.stringify(u.value)}),e(K,{className:"kc--attributes-validations--action-cell",children:e(O,{variant:"link","data-testid":"deleteValidator",onClick:()=>{g(),d(u.key)},children:t("delete")},"validator")})]},u.key))})]}):e(ce,{className:"kc-emptyValidators",component:ue.h6,children:t("emptyValidators")})]})]})},We=["username","email"],je=({save:t})=>{const{t:i}=S(),o=G(),{realm:l,attributeName:d}=_(),c=!!d;return p(Se,{children:[e(be,{label:i("jumpToSection"),sections:[{title:i("generalSettings"),panel:e(De,{})},{title:i("permission"),panel:e(He,{})},{title:i("validations"),panel:e(Me,{})},{title:i("annotations"),panel:e(Le,{})}]}),e(ne,{onSubmit:o.handleSubmit(t),children:p(Te,{name:"attribute-settings",children:[e(O,{variant:"primary",type:"submit","data-testid":"attribute-create",children:i(c?"save":"create")}),e(ge,{to:ie({realm:l,tab:"attributes"}),"data-testid":"attribute-cancel",className:"kc-attributeCancel",children:i("cancel")})]})})]})};function Ot(){const{realm:t,attributeName:i}=_(),o=te(),{t:l}=S(),d=pe(),{addAlert:c,addError:m}=me(),[h,C]=q(null),s=!!i;z(()=>E.users.getProfile(),v=>{C(v);const{annotations:u,validations:n,permissions:y,selector:k,required:N,...x}=v.attributes.find(f=>f.name===i)||{permissions:{edit:["admin"]}};fe({...x,hasSelector:typeof k<"u",hasRequiredScopes:typeof N?.scopes<"u"},o.setValue),Object.entries(ye({permissions:y,selector:k,required:N},{safe:!0})).map(([f,a])=>o.setValue(f,a)),o.setValue("annotations",Object.entries(u||{}).map(([f,a])=>({key:f,value:a}))),o.setValue("validations",Object.entries(n||{}).map(([f,a])=>({key:f,value:a}))),o.setValue("isRequired",N!==void 0)},[]);const g=async({hasSelector:v,hasRequiredScopes:u,...n})=>{v||delete n.selector,u||delete n.required?.scopes;const y=n.validations.reduce((a,r)=>(a[r.key]=r.value||{},a),{}),k=n.annotations.reduce((a,r)=>Object.assign(a,{[r.key]:r.value}),{}),f=s?(()=>h?.attributes.map(a=>a.name!==i?a:(delete a.required,Object.assign({...a,name:i,displayName:n.displayName,selector:n.selector,permissions:n.permissions,annotations:k,validations:y},n.isRequired?{required:n.required}:void 0,n.group?{group:n.group}:{group:null}))))():(()=>h?.attributes.concat([Object.assign({name:n.name,displayName:n.displayName,required:n.isRequired?n.required:void 0,selector:n.selector,permissions:n.permissions,annotations:k,validations:y},n.isRequired?{required:n.required}:void 0,n.group?{group:n.group}:void 0)]))();try{await E.users.updateProfile({...h,attributes:f,realm:t}),d(ie({realm:t,tab:"attributes"})),c(l("createAttributeSuccess"),ve.success)}catch(a){m("createAttributeError",a)}};return p(ae,{...o,children:[e(qe,{titleKey:s?i:l("createAttribute"),subKey:s?"":l("createAttributeSubTitle")}),e(he,{variant:"light",children:e(je,{save:()=>o.handleSubmit(g)()})})]})}export{We as USERNAME_EMAIL,Ot as default};
//# sourceMappingURL=NewAttributeSettings-gihrjnQR.js.map
