import{jsx as e,jsxs as n,Fragment as T}from"react/jsx-runtime";import{V as ye}from"./ViewHeader-xo54NRb6.js";import{u as B,I as H,J as de,K as Q,f as me,g as ke,dY as ve,X as Y,z as L,D as M,af as Ae,Y as ue,B as F,dW as Te,m as J,A as j,S as Se,b as Ue,c as Ce,aG as Ne,ai as Ke,e as he,d as De,r as Fe,j as R,O as Ie,aj as z,L as we,b3 as Ee,p as se,b2 as Pe,E as _e,dZ as Ve,d_ as xe,$ as Oe,a0 as Re,a8 as Be,P as Le,da as ne}from"./index-sihFV1NS.js";import{P as je}from"./PermissionTab-5VqfGSUL.js";import{useState as m}from"react";import{u as ie}from"./ConfirmDialog-WMVurgkl.js";import{L as qe}from"./PaginatingTableToolbar--Dt3wwL6.js";import{b as $e}from"./resource-BRtaBrSc.js";import{K as Ge}from"./KeycloakDataTable-Q3kZYP9q.js";import{F as We}from"./filter-icon-0B3gA_nj.js";import{K as oe}from"./KeycloakTextInput--S1SG2UN.js";import{a as Me,u as ze}from"./utils-ATQIxiIC.js";import{A as He}from"./Form-bfj-xQZn.js";import{S as Qe,A as Ye}from"./TableToolbar-vuixsfwd.js";import{b as D,T as Je,a as Xe}from"./ToolbarContent-46I9Yg7h.js";import{E as Ze}from"./EmptyStateBody-jnnI7hpP.js";import{W as et}from"./warning-triangle-icon-CFZFa_fd.js";import{F as tt}from"./FlexItem-Mxf6oLng.js";import{R as rt,u as at}from"./RoutableTabs-a7VqIL_I.js";import{u as st,F as nt}from"./useIsFeatureEnabled-qmmJPqO8.js";/* empty css                     */import{a as le,b as ce}from"./Tabs-wiayO8Tk.js";import"react-dom";import"./useLocaleSort-K-jL4v2R.js";import"./Trans-1cjg0ImV.js";import"./Td-uwYquKT4.js";import"./grip-vertical-icon-accuSWkz.js";import"./Modal-uOAPm2rX.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./_baseRest-lI6NnEVt.js";import"./plus-icon-zbmNbCLY.js";import"./MenuList-82IaVNxu.js";const it=({searchType:s,onSelect:d})=>{const{t:i}=B(),[u,g]=m(!1),a=h=>e(Q,{onClick:()=>{d(h),g(!1)},children:i(`searchType.${h}`)},h),y=[a("default"),a("attribute")];return e(H,{className:"keycloak__users__searchtype",toggle:n(de,{id:"toggle-id",onToggle:g,children:[e(We,{})," ",i(`searchType.${s}`)]}),isOpen:u,dropdownItems:y})};function ot({activeFilters:s,setActiveFilters:d,profile:i,createAttributeSearchChips:u,searchUserWithAttributes:g}){const{t:a}=B(),{addAlert:y}=me(),[h,k]=m(!1),I={name:"",displayName:"",value:""},{getValues:v,register:A,reset:C,formState:{errors:b},setValue:w,setError:o,clearErrors:l}=ke({mode:"onChange",defaultValues:I}),V=()=>s.some(r=>r.name===v().name),S=()=>{let r=!1;return v().name.length?s.some(p=>p.name===v().name)?o("name",{type:"conflict",message:a("searchUserByAttributeKeyAlreadyInUseError")}):r=!0:o("name",{type:"empty",message:a("searchUserByAttributeMissingKeyError")}),r},E=()=>{let r=!1;return v().value.length?r=!0:o("value",{type:"empty",message:a("searchUserByAttributeMissingValueError")}),r},K=()=>S()&&E(),N=()=>{K()?(d([...s,{...v()}]),C()):(b.name?.message&&y(b.name.message,j.danger),b.value?.message&&y(b.value.message,j.danger))},x=()=>{const r=[...s].filter(p=>p.name!==p.name);d(r)},U=()=>i?e(Se,{"data-testid":"search-attribute-name",variant:Ue.typeahead,onToggle:r=>k(r),selections:v().displayName,onSelect:(r,p)=>{w("displayName",p.toString()),V()?o("name",{type:"conflict"}):l("name")},isOpen:h,placeholderText:a("selectAttribute"),validated:b.name&&"error",maxHeight:300,...A("displayName",{required:!0,validate:S}),children:i.attributes?.map(r=>e(Ce,{value:(Me(r.displayName)?a(ze(r.displayName)):r.displayName)||r.name,onClick:p=>{p.stopPropagation(),k(!1),w("name",r.name)}},r.name))}):e(oe,{id:"name",placeholder:a("keyPlaceholder"),validated:b.name&&"error",onKeyDown:r=>r.key==="Enter"&&N(),...A("name",{required:!0,validate:S})});return n(ve,{className:"user-attribute-search-form",children:[e(Y,{className:"user-attribute-search-form-headline",children:e(L,{component:M.h2,children:a("selectAttributes")})}),e(Ae,{isInline:!0,className:"user-attribute-search-form-alert",variant:"info",title:a("searchUserByAttributeDescription"),component:"h3"}),n(Y,{className:"user-attribute-search-form-key-value",children:[e("div",{className:"user-attribute-search-form-left",children:e(L,{component:M.h3,children:a("key")})}),e("div",{className:"user-attribute-search-form-right",children:e(L,{component:M.h3,children:a("value")})})]}),e("div",{className:"user-attribute-search-form-left",children:U()}),e("div",{className:"user-attribute-search-form-right",children:n(ue,{children:[e(oe,{id:"value",placeholder:a("valuePlaceholder"),validated:b.value&&"error",onKeyDown:r=>{r.key==="Enter"&&(r.preventDefault(),N())},...A("value",{required:!0,validate:E})}),e(F,{variant:"control",icon:e(Te,{}),onClick:N,"aria-label":a("addToFilter")})]})}),u(),n(He,{className:"user-attribute-search-form-action-group",children:[e(F,{"data-testid":"search-user-attribute-btn",variant:"primary",type:"submit",isDisabled:!s.length,onClick:g,children:a("search")}),e(F,{variant:J.link,onClick:()=>{C(),x()},children:a("reset")})]})]})}function lt({realm:s,hasSelectedRows:d,toggleDeleteDialog:i,toggleUnlockUsersDialog:u,goToCreate:g,searchType:a,setSearchType:y,searchUser:h,setSearchUser:k,activeFilters:I,setActiveFilters:v,refresh:A,profile:C,clearAllFilters:b,createAttributeSearchChips:w,searchUserWithAttributes:o}){const{t:l}=B(),[V,S]=m(!1),[E,K]=m(!1),{hasAccess:N}=Ne(),x=N("query-users"),U=()=>e(D,{children:n(ue,{children:[e(it,{searchType:a,onSelect:f=>{b(),y(f)}}),a==="default"&&r(),a==="attribute"&&p()]})}),r=()=>e(D,{children:e(Qe,{placeholder:l("searchForUser"),"aria-label":l("search"),value:h,onChange:(f,G)=>{k(G)},onSearch:()=>{k(h),A()},onKeyDown:f=>{f.key==="Enter"&&(k(h),A())},onClear:()=>{k("")}})}),p=()=>n(T,{children:[e(H,{id:"user-attribute-search-select","data-testid":"UserAttributeSearchSelector",toggle:e(de,{"data-testid":"userAttributeSearchSelectorToggle",onToggle:f=>{K(f)},className:"keycloak__user_attribute_search_selector_dropdown__toggle",children:l("selectAttributes")}),isOpen:E,children:e(ot,{activeFilters:I,setActiveFilters:v,profile:C,createAttributeSearchChips:w,searchUserWithAttributes:o})}),e(F,{icon:e(Ye,{}),variant:"control",onClick:o,"aria-label":l("searchAttributes")})]}),q=s.bruteForceProtected?e(D,{children:e(H,{toggle:e(Ke,{onToggle:f=>S(f)}),isOpen:V,isPlain:!0,dropdownItems:[e(Q,{component:"button",isDisabled:d,onClick:()=>{i(),S(!1)},children:l("deleteUser")},"deleteUser"),e(Q,{component:"button",onClick:()=>{u(),S(!1)},children:l("unlockAllUsers")},"unlock")]})}):e(D,{children:e(F,{variant:J.link,onClick:i,"data-testid":"delete-user-btn",isDisabled:d,children:l("deleteUser")})}),$=n(T,{children:[e(D,{children:e(F,{"data-testid":"add-user",onClick:g,children:l("addUser")})}),q]});return n(T,{children:[U(),x?$:null]})}function ct(){const{t:s}=B(),{addAlert:d,addError:i}=me(),{realm:u}=he(),g=De(),[a,y]=m(),[h,k]=m(""),[I,v]=m(),[A,C]=m([]),[b,w]=m("default"),[o,l]=m([]),[V,S]=m({}),[E,K]=m(""),[N,x]=m(0),U=()=>x(N+1);Fe(async()=>{const t={type:"org.keycloak.storage.UserStorageProvider"};try{return await Promise.all([R.components.find(t),R.realms.findOne({realm:u}),R.users.getProfile()])}catch{return[[],{},{}]}},([t,c,P])=>{y(t.filter(_=>_.config?.enabled?.[0]==="true")),v(c),S(P)},[]);const r=t=>e(we,{to:Ee({realm:u,id:t.id,tab:"settings"}),children:t.username},t.username),p=async(t,c,P)=>{const _={first:t,max:c,q:E},O=P||h||"";if(O&&(_.search=O),!Z&&!O)return[];try{return await $e({briefRepresentation:!0,..._})}catch(ae){return a?.length?i("noUsersFoundErrorStorage",ae):i("noUsersFoundError",ae),[]}},[q,$]=ie({titleKey:"unlockAllUsers",messageKey:"unlockUsersConfirm",continueButtonLabel:"unlock",onConfirm:async()=>{try{await R.attackDetection.delAll(),U(),d(s("unlockUsersSuccess"),j.success)}catch(t){i("unlockUsersError",t)}}}),[f,G]=ie({titleKey:"deleteConfirmUsers",messageKey:s("deleteConfirmDialog",{count:A.length}),continueButtonLabel:"delete",continueButtonVariant:J.danger,onConfirm:async()=>{try{for(const t of A)await R.users.del({id:t.id});C([]),W(),d(s("userDeletedSuccess"),j.success)}catch(t){i("userDeletedError",t)}}}),pe=t=>n(T,{children:[!t.enabled&&e(se,{color:"red",icon:e(Pe,{}),children:s("disabled")},t.id),t.bruteForceStatus?.disabled&&e(se,{color:"orange",icon:e(et,{}),children:s("temporaryLocked")},t.id),t.enabled&&!t.bruteForceStatus?.disabled&&"â€”"]}),be=t=>n(T,{children:[!t.emailVerified&&e(_e,{content:e(T,{children:s("notVerified")}),children:e(Ve,{className:"keycloak__user-section__email-verified"})},`email-verified-${t.id}`)," ",z()(t.email)]}),X=()=>g(xe({realm:u}));if(!a||!I)return e(Ie,{});const Z=!(a.length>0),W=()=>{const t=[...o].filter(c=>c.name!==c.name);l(t),k(""),K(""),U()},ee=t=>t.map(c=>`${c.name}:${c.value}`).join(" "),fe=()=>{const t=ee(o);K(t),U()},te=()=>e(tt,{children:o.length>0&&e(T,{children:Object.values(o).map(t=>e(Oe,{className:"pf-u-mt-md pf-u-mr-md",categoryName:t.displayName.length?t.displayName:t.name,isClosable:!0,onClick:c=>{c.stopPropagation();const P=[...o].filter(O=>O.name!==t.name),_=ee(P);l(P),K(_),U()},children:e(Re,{isReadOnly:!0,children:t.value},t.name)},t.name))})}),re=()=>e(lt,{realm:I,hasSelectedRows:A.length===0,toggleDeleteDialog:f,toggleUnlockUsersDialog:q,goToCreate:X,searchType:b,setSearchType:w,searchUser:h,setSearchUser:k,activeFilters:o,setActiveFilters:l,refresh:U,profile:V,clearAllFilters:W,createAttributeSearchChips:te,searchUserWithAttributes:fe}),ge=()=>{if(o.length)return n("div",{className:"user-attribute-search-form-subtoolbar",children:[e(D,{children:te()}),e(D,{children:e(F,{variant:"link",onClick:()=>{W()},children:s("clearAllFilters")})})]})};return n(T,{children:[e(G,{}),e($,{}),e(Ge,{isSearching:!0,loader:p,isPaginated:!0,ariaLabelKey:"titleUsers",canSelectAll:!0,onSelect:t=>C([...t]),emptyState:Z?e(qe,{message:s("noUsersFound"),instructions:s("emptyInstructions"),primaryActionText:s("createNewUser"),onPrimaryAction:X}):n(T,{children:[e(Je,{children:e(Xe,{children:re()})}),e(Ze,{"data-testid":"empty-state",variant:"large",children:e(Y,{className:"kc-search-users-text",children:e(L,{children:s("searchForUserDescription")})})})]}),toolbarItem:re(),subToolbar:ge(),actionResolver:t=>{const c=t.data;return c.access?.manage?[{title:s("delete"),onClick:()=>{C([c]),f()}}]:[]},columns:[{name:"username",displayKey:"username",cellRenderer:r},{name:"email",displayKey:"email",cellRenderer:be},{name:"lastName",displayKey:"lastName",cellFormatters:[z()]},{name:"firstName",displayKey:"firstName",cellFormatters:[z()]},{name:"status",displayKey:"status",cellRenderer:pe}]},N)]})}function qt(){const{t:s}=B(),{realm:d}=he(),i=st(),u=y=>at(ne({realm:d,tab:y})),g=u("list"),a=u("permissions");return n(T,{children:[e(ye,{titleKey:"titleUsers",subKey:"usersExplain",helpUrl:Be.usersUrl,divider:!1}),e(Le,{"data-testid":"users-page",variant:"light",className:"pf-u-p-0",children:n(rt,{"data-testid":"user-tabs",defaultLocation:ne({realm:d,tab:"list"}),isBox:!0,mountOnEnter:!0,children:[e(le,{id:"list","data-testid":"listTab",title:e(ce,{children:s("userList")}),...g,children:e(ct,{})}),i(nt.AdminFineGrainedAuthz)&&e(le,{id:"permissions","data-testid":"permissionsTab",title:e(ce,{children:s("permissions")}),...a,children:e(je,{type:"users"})})]})})]})}export{qt as default};
//# sourceMappingURL=UsersSection-Fr_HxX0H.js.map
