import{jsxs as b,Fragment as F,jsx as e}from"react/jsx-runtime";import{useState as y,useMemo as ke}from"react";import{u as k,a as A,Z as Y,C as I,Q as ee,F as S,i as x,V as C,S as B,b as E,c as N,r as $,j as v,g as Re,a4 as we,f as Pe,d as Me,e as de,m as te,A as U,bS as Ne,bT as ae,O as Oe,a5 as De,h as Le,P as Ve,aE as Ae,bU as ne,B as Be,L as ce,aF as Ee,K as He,bV as Ke}from"./index-sihFV1NS.js";import{u as z}from"./ConfirmDialog-WMVurgkl.js";import{D as Ue}from"./DynamicComponents-f6aNOnzT.js";import{F as qe}from"./FixedButtonGroup-6gQXZmA0.js";import{F as q}from"./FormAccess-EK-4wbwg.js";import{L as Ge}from"./PaginatingTableToolbar--Dt3wwL6.js";import{P as je}from"./PermissionTab-5VqfGSUL.js";import{R as ze,u as Je}from"./RoutableTabs-a7VqIL_I.js";import{K as _e}from"./KeycloakDataTable-Q3kZYP9q.js";import{V as $e}from"./ViewHeader-xo54NRb6.js";import{u as pe,F as me}from"./useIsFeatureEnabled-qmmJPqO8.js";import{u as W}from"./useParams-OD1jI_R2.js";import{T as J,S as m,F as _}from"./discovery-settings-sDKXSACJ.js";import{K as oe}from"./KeycloakTextInput--S1SG2UN.js";import{S as We,D as Qe}from"./SamlGeneralSettings-0TsojIjh.js";import{O as Ze,D as Xe,a as Ye}from"./OIDCGeneralSettings-x9esjFKG.js";import{E as et}from"./ExpandableSection-JW5wd_BH.js";import{F as ue}from"./Form-bfj-xQZn.js";import{N as tt}from"./NumberInput-QtFengwl.js";import{G as at}from"./GeneralSettings-nV2z-aDo.js";import{M as ie}from"./MultiLineInput-MBnUzZD_.js";import{a as G,b as j}from"./Tabs-wiayO8Tk.js";import{b as nt}from"./ToolbarContent-46I9Yg7h.js";import"react-dom";import"./Modal-uOAPm2rX.js";import"./ClientSelect-sh5SEoBO.js";import"./FileUpload-LIezXv7x.js";import"./CodeEditor-7uqvO0EK.js";import"./copy-icon-WaWzxYgU.js";import"./EmptyStateBody-jnnI7hpP.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./GroupPickerDialog-gC2-xBPw.js";import"./useToggle-mZS4AEtR.js";import"./DataListItemRow-te2VcAoi.js";import"./data-list-CDN1kyj9.js";import"./grip-vertical-icon-accuSWkz.js";import"./TableToolbar-vuixsfwd.js";import"./_baseRest-lI6NnEVt.js";import"./ActionListItem-1jrwMZdM.js";import"./Flex-W2FoLD7u.js";import"./FlexItem-Mxf6oLng.js";import"./PasswordInput-P6txGPqu.js";import"./AddRoleMappingModal-uxjjMt5W.js";import"./useLocaleSort-K-jL4v2R.js";import"./resource-BRtaBrSc.js";import"./filter-icon-0B3gA_nj.js";import"./Td-uwYquKT4.js";import"./KeycloakTextArea-NBwG1p2x.js";import"./Trans-1cjg0ImV.js";import"./DisplayOrder-DqQik7ga.js";import"./ClientIdSecret-xi11Xph8.js";import"./minus-icon-3MARcJXf.js";import"./plus-icon-zbmNbCLY.js";import"./MenuList-82IaVNxu.js";const re=({field:t,label:a,defaultValue:n})=>{const{t:l}=k(),{control:r}=A(),[d,i]=y(),[c,s]=y(!1);return $(()=>v.authenticationManagement.getFlows(),f=>i(f.filter(p=>p.providerId==="basic-flow")),[]),e(S,{label:l(a),labelIcon:e(x,{helpText:l(`${a}Help`),fieldLabelId:a}),fieldId:a,children:e(I,{name:t,defaultValue:n,control:r,render:({field:f})=>e(B,{toggleId:a,required:!0,onToggle:()=>s(!c),onSelect:(p,O)=>{f.onChange(O),s(!1)},selections:f.value||l("none"),variant:E.single,"aria-label":l(a),isOpen:c,children:[...n===""?[e(N,{value:"",children:l("none")},"empty")]:[],...d?.map(p=>e(N,{selected:p.alias===f.value,value:p.alias,children:p.alias},p.id))||[]]})})})},le=["import","legacy","force"],ot=({isOIDC:t,isSAML:a})=>{const{t:n}=k(),{control:l,register:r,setValue:d,formState:{errors:i}}=A(),[c,s]=y(!1),p=Y({control:l,name:"config.filteredByClaim",defaultValue:"false"})==="true",D=pe()(me.TransientUsers),R=Y({control:l,name:"config.doNotStoreUsers",defaultValue:"false"})==="false";return b(F,{children:[!t&&!a&&e(J,{field:"config.defaultScope",label:"scopes"}),e(m,{field:"storeToken",label:"storeTokens",fieldType:"boolean"}),(a||t)&&e(m,{field:"addReadTokenRoleOnCreate",label:"storedTokensReadable",fieldType:"boolean"}),!t&&!a&&b(F,{children:[e(m,{field:"config.acceptsPromptNoneForwardFromClient",label:"acceptsPromptNone"}),e(m,{field:"config.disableUserInfo",label:"disableUserInfo"})]}),t&&e(m,{field:"config.isAccessTokenJWT",label:"isAccessTokenJWT"}),e(m,{field:"trustEmail",label:"trustEmail",fieldType:"boolean"}),e(m,{field:"linkOnly",label:"accountLinkingOnly",fieldType:"boolean"}),e(m,{field:"config.hideOnLoginPage",label:"hideOnLoginPage"}),(!a||t)&&e(_,{label:"filteredByClaim",children:e(I,{name:"config.filteredByClaim",defaultValue:"false",control:l,render:({field:g})=>e(ee,{id:"filteredByClaim",label:n("on"),labelOff:n("off"),isChecked:g.value==="true",onChange:u=>{g.onChange(u.toString())}})})}),(!a||t)&&p&&b(F,{children:[e(S,{label:n("claimFilterName"),labelIcon:e(x,{helpText:n("claimFilterNameHelp"),fieldLabelId:"claimFilterName"}),fieldId:"kc-claim-filter-name",isRequired:!0,validated:i.config?.claimFilterName?C.error:C.default,helperTextInvalid:n("required"),children:e(oe,{isRequired:!0,id:"kc-claim-filter-name","data-testid":"claimFilterName",validated:i.config?.claimFilterName?C.error:C.default,...r("config.claimFilterName",{required:!0})})}),e(S,{label:n("claimFilterValue"),labelIcon:e(x,{helpText:n("claimFilterValueHelp"),fieldLabelId:"claimFilterName"}),fieldId:"kc-claim-filter-value",isRequired:!0,validated:i.config?.claimFilterValue?C.error:C.default,helperTextInvalid:n("required"),children:e(oe,{isRequired:!0,id:"kc-claim-filter-value","data-testid":"claimFilterValue",validated:i.config?.claimFilterValue?C.error:C.default,...r("config.claimFilterValue",{required:!0})})})]}),e(re,{field:"firstBrokerLoginFlowAlias",label:"firstBrokerLoginFlowAlias",defaultValue:"fist broker login"}),e(re,{field:"postBrokerLoginFlowAlias",label:"postBrokerLoginFlowAlias",defaultValue:""}),D&&e(_,{label:"doNotStoreUsers",children:e(I,{name:"config.doNotStoreUsers",defaultValue:"false",control:l,render:({field:g})=>e(ee,{id:"doNotStoreUsers",label:n("on"),labelOff:n("off"),isChecked:g.value==="true",onChange:u=>{g.onChange(u.toString()),u&&d("config.syncMode","IMPORT")}})})}),R&&e(S,{className:"pf-u-pb-3xl",label:n("syncMode"),labelIcon:e(x,{helpText:n("syncModeHelp"),fieldLabelId:"syncMode"}),fieldId:"syncMode",children:e(I,{name:"config.syncMode",defaultValue:le[0].toUpperCase(),control:l,render:({field:g})=>e(B,{toggleId:"syncMode",required:!0,direction:"up",onToggle:()=>s(!c),onSelect:(u,T)=>{g.onChange(T),s(!1)},selections:n(`syncModes.${g.value.toLowerCase()}`),variant:E.single,"aria-label":n("syncMode"),isOpen:c,children:le.map(u=>e(N,{selected:u===g.value,value:u.toUpperCase(),children:n(`syncModes.${u}`)},u))})})})]})},it={unspecified:"",none:"none",consent:"consent",login:"login",select_account:"select_account"},rt=()=>{const{t}=k(),{control:a}=A(),[n,l]=y(!1),[r,d]=y(!1);return e(et,{toggleText:t("advanced"),onToggle:()=>l(!n),isExpanded:n,children:b(ue,{isHorizontal:!0,children:[e(m,{label:"passLoginHint",field:"config.loginHint"}),e(m,{label:"passMaxAge",field:"config.passMaxAge"}),e(m,{label:"passCurrentLocale",field:"config.uiLocales"}),e(m,{field:"config.backchannelSupported",label:"backchannelLogout"}),e(m,{field:"config.disableUserInfo",label:"disableUserInfo"}),e(m,{field:"config.disableNonce",label:"disableNonce"}),e(J,{field:"config.defaultScope",label:"scopes"}),e(_,{label:"prompt",children:e(I,{name:"config.prompt",defaultValue:"",control:a,render:({field:i})=>e(B,{toggleId:"prompt",required:!0,onToggle:()=>d(!r),onSelect:(c,s)=>{i.onChange(s),d(!1)},selections:i.value||t("prompts.unspecified"),variant:E.single,"aria-label":t("prompt"),isOpen:r,children:Object.entries(it).map(([c,s])=>e(N,{selected:s===i.value,value:s,children:t(`prompts.${c}`)},c))})})}),e(m,{field:"config.acceptsPromptNoneForwardFromClient",label:"acceptsPromptNone"}),e(S,{label:t("allowedClockSkew"),labelIcon:e(x,{helpText:t("allowedClockSkewHelp"),fieldLabelId:"allowedClockSkew"}),fieldId:"allowedClockSkew",children:e(I,{name:"config.allowedClockSkew",defaultValue:0,control:a,render:({field:i})=>{const c=Number(i.value);return e(tt,{"data-testid":"allowedClockSkew",inputName:"allowedClockSkew",min:0,max:2147483,value:c,readOnly:!0,onPlus:()=>i.onChange(c+1),onMinus:()=>i.onChange(c-1),onChange:s=>{const f=Number(s.target.value);i.onChange(f<0?0:f)}})}})}),e(J,{field:"config.forwardParameters",label:"forwardParameters"})]})})},se=["exact","minimum","maximum","better"],lt=()=>{const{t}=k(),{control:a}=A(),[n,l]=y(!1);return b(F,{children:[e(S,{label:t("comparison"),labelIcon:e(x,{helpText:t("comparisonHelp"),fieldLabelId:"comparison"}),fieldId:"comparison",children:e(I,{name:"config.authnContextComparisonType",defaultValue:se[0],control:a,render:({field:r})=>e(B,{toggleId:"comparison",required:!0,direction:"up",onToggle:d=>l(d),onSelect:(d,i)=>{r.onChange(i.toString()),l(!1)},selections:r.value,variant:E.single,"aria-label":t("comparison"),isOpen:n,children:se.map(d=>e(N,{selected:d===r.value,value:d,children:t(d)},d))})})}),e(S,{label:t("authnContextClassRefs"),fieldId:"kc-authnContextClassRefs",labelIcon:e(x,{helpText:t("authnContextClassRefsHelp"),fieldLabelId:"authnContextClassRefs"}),children:e(ie,{name:"config.authnContextClassRefs","aria-label":t("identify-providers:authnContextClassRefs"),addButtonLabel:"addAuthnContextClassRef","data-testid":"classref-field"})}),e(S,{label:t("authnContextDeclRefs"),fieldId:"kc-authnContextDeclRefs",labelIcon:e(x,{helpText:t("authnContextDeclRefsHelp"),fieldLabelId:"authnContextDeclRefs"}),children:e(ie,{name:"config.authnContextDeclRefs","aria-label":t("identify-providers:authnContextDeclRefs"),addButtonLabel:"addAuthnContextDeclRef","data-testid":"declref-field"})})]})},st=({onChange:t,value:a,save:n,toggleDeleteDialog:l})=>{const{t:r}=k(),{alias:d}=W(),[i,c]=y();$(()=>v.identityProviders.findOne({alias:d}),p=>{if(!p)throw new Error(r("notFound"));c(p)},[]);const[s,f]=z({titleKey:"disableProvider",messageKey:r("disableConfirmIdentityProvider",{provider:d}),continueButtonLabel:"disable",onConfirm:()=>{t(!a),n()}});return b(F,{children:[e(f,{}),e($e,{titleKey:Ee(i?i.displayName?i.displayName:i.providerId:""),divider:!1,dropdownItems:[e(He,{onClick:()=>l(),children:r("delete")},"delete")],isEnabled:a,onToggle:p=>{p?(t(p),n()):s()}})]})},dt=({name:t,mapperId:a,provider:n})=>{const{realm:l}=de(),{alias:r}=W();return e(ce,{to:Ke({realm:l,alias:r,providerId:n?.providerId,id:a}),children:t})};function ua(){const{t}=k(),{alias:a,providerId:n}=W(),l=pe(),r=Re(),{handleSubmit:d,getValues:i,reset:c}=r,[s,f]=y(),[p,O]=y(),D=we(),H=ke(()=>{const o=["org.keycloak.broker.social.SocialIdentityProvider","org.keycloak.broker.provider.IdentityProvider"];for(const h of o){const P=D.componentTypes?.[h]?.find(({id:M})=>M===n);if(P)return P}},[D,n]),{addAlert:R,addError:g}=Pe(),u=Me(),{realm:T}=de(),[Q,fe]=y(0),ge=()=>fe(Q+1);$(()=>v.identityProviders.findOne({alias:a}),o=>{if(!o)throw new Error(t("notFound"));c(o),f(o),o.config.authnContextClassRefs&&r.setValue("config.authnContextClassRefs",JSON.parse(o.config?.authnContextClassRefs)),o.config.authnContextDeclRefs&&r.setValue("config.authnContextDeclRefs",JSON.parse(o.config?.authnContextDeclRefs))},[]);const Z=o=>ae({realm:T,alias:a,providerId:n,tab:o}),K=o=>Je(Z(o)),be=K("settings"),he=K("mappers"),ye=K("permissions"),L=async o=>{const h=o||i();h.config?.authnContextClassRefs&&(h.config.authnContextClassRefs=JSON.stringify(h.config.authnContextClassRefs)),h.config?.authnContextDeclRefs&&(h.config.authnContextDeclRefs=JSON.stringify(h.config.authnContextDeclRefs));try{await v.identityProviders.update({alias:a},{...h,config:{...s?.config,...h.config},alias:a,providerId:n}),R(t("updateSuccessIdentityProvider"),U.success)}catch(P){g("updateErrorIdentityProvider",P)}},[Ce,ve]=z({titleKey:"deleteProvider",messageKey:t("deleteConfirmIdentityProvider",{provider:a}),continueButtonLabel:"delete",continueButtonVariant:te.danger,onConfirm:async()=>{try{await v.identityProviders.del({alias:a}),R(t("deletedSuccessIdentityProvider"),U.success),u(Ne({realm:T}))}catch(o){g("deleteErrorIdentityProvider",o)}}}),[Ie,Se]=z({titleKey:"deleteProviderMapper",messageKey:t("deleteMapperConfirm",{mapper:p?.name}),continueButtonLabel:"delete",continueButtonVariant:te.danger,onConfirm:async()=>{try{await v.identityProviders.delMapper({alias:a,id:p?.mapperId}),R(t("deleteMapperSuccess"),U.success),ge(),u(ae({providerId:n,alias:a,tab:"mappers",realm:T}))}catch(o){g("deleteErrorIdentityProvider",o)}}});if(!s)return e(Oe,{});const V=s.providerId.includes("oidc"),w=s.providerId.includes("saml"),xe=async()=>{const[o,h]=await Promise.all([v.identityProviders.findMappers({alias:a}),v.identityProviders.findMapperTypes({alias:a})]);return o.map(M=>{const X=Object.values(h).find(Fe=>M.identityProviderMapper===Fe.id);return{...X,name:M.name,type:X?.name,mapperId:M.id}})},Te=[{title:t("generalSettings"),panel:b(q,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:d(L),children:[!V&&!w&&b(F,{children:[e(at,{create:!1,id:a}),H&&e(Ue,{stringify:!0,properties:H.properties})]}),V&&e(Ze,{}),w&&e(We,{isAliasReadonly:!0})]})},{title:t("oidcSettings"),isHidden:!V,panel:b(F,{children:[e(Xe,{readOnly:!1}),b(ue,{isHorizontal:!0,className:"pf-u-py-lg",children:[e(De,{}),e(Ye,{create:!1})]}),e(rt,{})]})},{title:t("samlSettings"),isHidden:!w,panel:e(Qe,{readOnly:!1})},{title:t("reqAuthnConstraints"),isHidden:!w,panel:e(q,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:d(L),children:e(lt,{})})},{title:t("advancedSettings"),panel:b(q,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:d(L),children:[e(ot,{isOIDC:V,isSAML:w}),e(qe,{name:"idp-details",isSubmit:!0,reset:c})]})}];return b(Le,{...r,children:[e(ve,{}),e(Se,{}),e(I,{name:"enabled",control:r.control,defaultValue:!0,render:({field:o})=>e(st,{value:o.value||!1,onChange:o.onChange,save:L,toggleDeleteDialog:Ce})}),e(Ve,{variant:"light",className:"pf-u-p-0",children:b(ze,{isBox:!0,defaultLocation:Z("settings"),children:[e(G,{id:"settings",title:e(j,{children:t("settings")}),...be,children:e(Ae,{label:t("jumpToSection"),className:"pf-u-px-lg",sections:Te})}),e(G,{id:"mappers","data-testid":"mappers-tab",title:e(j,{children:t("mappers")}),...he,children:e(_e,{emptyState:e(Ge,{message:t("noMappers"),instructions:t("noMappersInstructions"),primaryActionText:t("addMapper"),onPrimaryAction:()=>u(ne({realm:T,alias:a,providerId:s.providerId,tab:"mappers"}))}),loader:xe,ariaLabelKey:"mappersList",searchPlaceholderKey:"searchForMapper",toolbarItem:e(nt,{children:e(Be,{id:"add-mapper-button",component:o=>e(ce,{...o,to:ne({realm:T,alias:a,providerId:s.providerId,tab:"mappers"})}),"data-testid":"addMapper",children:t("addMapper")})}),columns:[{name:"name",displayKey:"name",cellRenderer:o=>e(dt,{...o,provider:s})},{name:"category",displayKey:"category"},{name:"type",displayKey:"type"}],actions:[{title:t("delete"),onRowClick:o=>{O(o),Ie()}}]},Q)}),l(me.AdminFineGrainedAuthz)&&e(G,{id:"permissions","data-testid":"permissionsTab",title:e(j,{children:t("permissions")}),...ye,children:e(je,{id:a,type:"identityProviders"})})]})})]})}export{ua as default};
//# sourceMappingURL=DetailSettings-8xarL2BP.js.map
