import{jsxs as I,jsx as s}from"react/jsx-runtime";import{useRef as N,useState as X,useMemo as Y}from"react";import{s as m}from"./data-list-CDN1kyj9.js";import{u as B,cn as o}from"./index-sihFV1NS.js";import{T as K,O as M,P as C,Q as A,R as P,S as h,ah as Q}from"./Td-uwYquKT4.js";function H({keyField:g,columns:u,data:f,actions:T,onDragFinish:y,...L}){const{t:p}=B(),i=N(null),[a,c]=X({draggedItemId:"",draggingToItemIndex:-1,dragging:!1,tempItemOrder:[""]}),b=Y(()=>f.map(e=>o(e,g)),[f]),O=e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",e.currentTarget.id);const r=e.currentTarget.id;e.currentTarget.classList.add(m.modifiers.ghostRow),e.currentTarget.setAttribute("aria-pressed","true"),c({...a,draggedItemId:r,dragging:!0})},v=(e,r,t)=>{const n=e.indexOf(r);if(n===t)return e;const d=e.splice(n,1);return e.splice(t,0,d[0]),e},x=e=>{if(!i.current)return;const r=i.current,t=Array.from(r.children);if(!t.map(n=>n.id).every((n,d)=>n===e[d])){for(;r.firstChild;)r.removeChild(r.lastChild);e.forEach(n=>{r.appendChild(t.find(d=>d.id===n))})}},S=()=>{Array.from(i.current?.children||[]).forEach(e=>{e.classList.remove(m.modifiers.ghostRow),e.setAttribute("aria-pressed","false")}),c({...a,draggedItemId:"",draggingToItemIndex:-1,dragging:!1})},E=e=>{D(e)||(x(b),c({...a,draggingToItemIndex:-1}))},D=e=>{const r=i.current.getBoundingClientRect();return e.clientX>r.x&&e.clientX<r.x+r.width&&e.clientY>r.y&&e.clientY<r.y+r.height},$=e=>{D(e)?y(a.draggedItemId,a.tempItemOrder):S()},R=e=>{e.preventDefault();const t=e.target.closest("tr");if(!t||i.current&&!i.current.contains(t)||t.id===a.draggedItemId)return null;{const n=t.id,d=Array.from(i.current?.children||[]).findIndex(l=>l.id===n);if(d!==a.draggingToItemIndex){const l=v(b,a.draggedItemId,d);x(l),c({...a,draggingToItemIndex:d,tempItemOrder:l})}}},j=e=>{const r=e.target;r.classList.remove(m.modifiers.ghostRow),r.setAttribute("aria-pressed","false"),c({...a,draggedItemId:"",draggingToItemIndex:-1,dragging:!1})},w=e=>{if(e.thTooltipText)return{popover:s("div",{children:p(e.thTooltipText)}),ariaLabel:p(e.thTooltipText)}};return I(K,{"aria-label":"Draggable table",className:a.dragging?m.modifiers.dragOver:"",...L,children:[s(M,{children:I(C,{children:[s(A,{"aria-hidden":"true"}),u.map(e=>s(A,{info:w(e),children:p(e.displayKey||e.name)},e.name))]})}),s(P,{ref:i,onDragOver:R,onDrop:R,onDragLeave:E,children:f.map(e=>I(C,{id:o(e,g),draggable:!0,onDrop:$,onDragEnd:j,onDragStart:O,children:[s(h,{draggableRow:{id:`draggable-row-${o(e,g)}`}}),u.map(r=>s(h,{dataLabel:r.name,children:r.cellRenderer?r.cellRenderer(e):o(e,r.name)},`${o(e,g)}_${r.name}`)),T&&s(h,{isActionCell:!0,children:s(Q,{items:T.map(({isActionable:r,...t})=>r?{...t,isDisabled:!r(e)}:t),rowData:e})})]},o(e,g)))})]})}export{H as D};
//# sourceMappingURL=DraggableTable-ZpdKj1kF.js.map
