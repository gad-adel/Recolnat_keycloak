import{jsx as t,jsxs as S,Fragment as k}from"react/jsx-runtime";import{useState as w}from"react";import{u as B,d as L,e as H,f as N,a7 as U,r as _,m as q,j as r,A as l,ad as z,O as G,K as J,P as f,ae as T,af as Q,ag as W,H as X}from"./index-sihFV1NS.js";import{c as Y,C as M,A as Z}from"./ClientScopeTypes-Hwl8E8GJ.js";import{u as $}from"./ConfirmDialog-WMVurgkl.js";import{R as ee}from"./AddRoleMappingModal-uxjjMt5W.js";import{R as te,u as oe}from"./RoutableTabs-a7VqIL_I.js";import{V as ae}from"./ViewHeader-xo54NRb6.js";import{u as ie}from"./useParams-OD1jI_R2.js";import{M as se}from"./MapperList-TbLqIHFZ.js";import{S as re}from"./ScopeForm-5ax7VntI.js";import{a as g,b as h}from"./Tabs-wiayO8Tk.js";import"react-dom";import"./Modal-uOAPm2rX.js";import"./useLocaleSort-K-jL4v2R.js";import"./PaginatingTableToolbar--Dt3wwL6.js";import"./EmptyStateBody-jnnI7hpP.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./TableToolbar-vuixsfwd.js";import"./ToolbarContent-46I9Yg7h.js";import"./Form-bfj-xQZn.js";import"./KeycloakDataTable-Q3kZYP9q.js";import"./Td-uwYquKT4.js";import"./grip-vertical-icon-accuSWkz.js";import"./_baseRest-lI6NnEVt.js";import"./resource-BRtaBrSc.js";import"./filter-icon-0B3gA_nj.js";import"./DataListItemRow-te2VcAoi.js";import"./data-list-CDN1kyj9.js";import"./utils-9X4NJJvK.js";import"./SwitchControl-KreblmOr.js";import"./FormAccess-EK-4wbwg.js";import"./copy-icon-WaWzxYgU.js";import"./KeycloakTextArea-NBwG1p2x.js";import"./KeycloakTextInput--S1SG2UN.js";import"./useIsFeatureEnabled-qmmJPqO8.js";import"./plus-icon-zbmNbCLY.js";import"./MenuList-82IaVNxu.js";function Je(){const{t:a}=B(),y=L(),{realm:d}=H(),{id:n}=ie(),{addAlert:c,addError:p}=N(),{enabled:v}=U(),[i,D]=w(),[C,A]=w(0),b=()=>A(C+1);_(async()=>{const e=await r.clientScopes.findOne({id:n});if(!e)throw new Error(a("notFound"));return{...e,type:await R(e)}},e=>{D(e)},[C,n]);async function R(e){return(await r.clientScopes.listDefaultClientScopes()).find(u=>u.name===e.name)?M.default:(await r.clientScopes.listDefaultOptionalClientScopes()).find(u=>u.name===e.name)?M.optional:Z.none}const m=e=>oe(W({realm:d,id:n,tab:e})),E=m("settings"),x=m("mappers"),I=m("scope"),K=async e=>{const o=X({...e,name:e.name?.trim().replace(/ /g,"_")});try{await r.clientScopes.update({id:n},o),await Y({...o,id:n},o.type),c(a("updateSuccessClientScope"),l.success)}catch(s){p("updateErrorClientScope",s)}},[O,P]=$({titleKey:a("deleteClientScope",{count:1,name:i?.name}),messageKey:"deleteConfirmClientScopes",continueButtonLabel:"delete",continueButtonVariant:q.danger,onConfirm:async()=>{try{await r.clientScopes.del({id:n}),c(a("deletedSuccessClientScope"),l.success),y(z({realm:d}))}catch(e){p("deleteErrorClientScope",e)}}}),V=async e=>{try{const o=e.filter(s=>s.client===void 0).map(s=>s.role).flat();await r.clientScopes.addRealmScopeMappings({id:n},o),await Promise.all(e.filter(s=>s.client!==void 0).map(s=>r.clientScopes.addClientScopeMappings({id:n,client:s.client.id},[s.role]))),c(a("roleMappingUpdatedSuccess"),l.success)}catch(o){p("roleMappingUpdatedError",o)}},F=async e=>{if(Array.isArray(e))try{await r.clientScopes.addMultipleProtocolMappers({id:i.id},e),b(),c(a("mappingCreatedSuccess"),l.success)}catch(o){p("mappingCreatedError",o)}else{const o=e;y(T({realm:d,id:i.id,mapperId:o.id}))}},j=async e=>{try{await r.clientScopes.delProtocolMapper({id:i.id,mapperId:e.id}),c(a("mappingDeletedSuccess"),l.success),b()}catch(o){p("mappingDeletedError",o)}return!0};return i?S(k,{children:[t(P,{}),t(ae,{titleKey:i.name,dropdownItems:[t(J,{onClick:O,children:a("delete")},"delete")],badges:[{text:i.protocol}],divider:!1}),t(f,{variant:"light",className:"pf-u-p-0",children:S(te,{isBox:!0,children:[t(g,{id:"settings","data-testid":"settings",title:t(h,{children:a("settings")}),...E,children:t(f,{variant:"light",children:t(re,{save:K,clientScope:i})})}),t(g,{id:"mappers","data-testid":"mappers",title:t(h,{children:a("mappers")}),...x,children:t(se,{model:i,onAdd:F,onDelete:j,detailLink:e=>T({realm:d,id:i.id,mapperId:e})})}),S(g,{id:"scope","data-testid":"scopeTab",title:t(h,{children:a("scope")}),...I,children:[v&&t(f,{children:t(Q,{variant:"info",isInline:!0,title:a("clientScopesRolesScope"),component:"h2"})}),t(ee,{id:i.id,name:i.name,type:"clientScopes",save:V})]})]})})]}):t(G,{})}export{Je as default};
//# sourceMappingURL=EditClientScope-xyE4f-Tc.js.map
