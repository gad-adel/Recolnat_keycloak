import{jsx as e,jsxs as b,Fragment as F}from"react/jsx-runtime";import{useState as g}from"react";import{aG as O,e as Z,r as D,j as A,B as T,L as j,dJ as ee,bm as ae,aP as ie,u as H,F as d,i as v,C as G,S as te,b as re,c as ne,f as le,Q as N,dP as de,dg as se,Y as oe,$ as ce,a0 as me,da as ue,A as S}from"./index-sihFV1NS.js";import{F as pe}from"./FormAccess-EK-4wbwg.js";import{G as fe}from"./GroupPickerDialog-gC2-xBPw.js";import{K as k}from"./KeycloakTextInput--S1SG2UN.js";import{u as he}from"./useFormatDate-kyFeutIw.js";import{A as be}from"./Form-bfj-xQZn.js";const ke=({user:r})=>{const n=O(),{realm:i}=Z(),[o,c]=g();return D(()=>n.hasAccess("view-realm")?A.components.findOne({id:r.federationLink||r.origin}):A.userStorageProvider.name({id:r.federationLink||r.origin}),c,[]),o?n.hasAccess("view-realm")?e(T,{variant:"link",component:p=>e(j,{...p,to:ee({id:o.id,providerId:o.providerId,realm:i})}),children:o.name}):e("span",{children:o.name}):null};function ve(r,n){const i=n?r.attributes:ae(r.attributes);return{...r,attributes:i}}function qe(r){const n=r.username?.trim(),i=Array.isArray(r.attributes)?ie(r.attributes):r.attributes;return{...r,username:n,attributes:i}}const ge=({control:r,name:n,label:i,help:o})=>{const{t:c}=H(),[p,q]=g(!1),[L,a]=g([]);return D(()=>A.authenticationManagement.getRequiredActions(),m=>{const l=m.filter(s=>s.enabled);a(l)},[]),e(d,{label:c(i),labelIcon:e(v,{helpText:c(o),fieldLabelId:"resetAction"}),fieldId:"actions",children:e(G,{name:n,defaultValue:[],control:r,render:({field:m})=>e(te,{maxHeight:375,toggleId:`${n}-actions`,variant:re.typeaheadMulti,chipGroupProps:{numChips:3},placeholderText:c("requiredActionPlaceholder"),menuAppendTo:"parent",onToggle:l=>q(l),isOpen:p,selections:m.value,onSelect:(l,s)=>{const f=m.value;m.onChange(f.find(I=>I===s)?f.filter(I=>I!==s):[...f,s])},onClear:l=>{l.stopPropagation(),m.onChange([])},typeAheadAriaLabel:c("resetAction"),children:L.map(({alias:l,name:s})=>e(ne,{value:l,"data-testid":`${l}-option`,children:s},l))})})})},we=({form:r,realm:n,user:i,bruteForce:{isBruteForceProtected:o,isLocked:c}={isBruteForceProtected:!1,isLocked:!1},userProfileMetadata:p,save:q,onGroupsUpdate:L})=>{const{t:a}=H(),m=he(),{addAlert:l,addError:s}=le(),{hasAccess:f}=O(),I=f("manage-users"),P=f("view-realm"),{handleSubmit:E,register:C,watch:M,control:x,reset:B,formState:{errors:y}}=r,K=M("username"),[h,U]=g([]),[V,w]=g(!1),[R,$]=g(c),z=async()=>{try{await A.attackDetection.del({id:i.id}),l(a("unlockSuccess"),S.success)}catch(t){s("unlockError",t)}},J=t=>{U(h.filter(u=>u.name!==t)),L?.(h)},Q=async t=>{U([...h,...t]),L?.([...h,...t])},Y=async t=>{t.forEach(async W=>{try{await A.users.addToGroup({id:i.id,groupId:W.id}),l(a("addedGroupMembership"),S.success)}catch(X){s("addedGroupMembershipError",X)}})},_=()=>{w(!V)};return b(pe,{isHorizontal:!0,onSubmit:E(q),role:"query-users",fineGrainedAccess:i?.access?.manage,className:"pf-u-mt-lg",children:[V&&e(fe,{type:"selectMany",text:{title:"selectGroups",ok:"join"},canBrowse:I,onConfirm:t=>{i?.id?Y(t||[]):Q(t||[]),w(!1)},onClose:()=>w(!1),filterGroups:h}),i?.id&&b(F,{children:[e(d,{label:a("id"),fieldId:"kc-id",isRequired:!0,children:e(k,{id:i.id,"aria-label":a("userID"),value:i.id,type:"text",isReadOnly:!0})}),e(d,{label:a("createdAt"),fieldId:"kc-created-at",isRequired:!0,children:e(k,{value:m(new Date(i.createdTimestamp)),type:"text",id:"kc-created-at","aria-label":a("createdAt"),name:"createdTimestamp",isReadOnly:!0})})]}),e(ge,{control:x,name:"requiredActions",label:"requiredUserActions",help:"requiredUserActionsHelp"}),(i?.federationLink||i?.origin)&&P&&e(d,{label:a("federationLink"),labelIcon:e(v,{helpText:a("federationLinkHelp"),fieldLabelId:"federationLink"}),children:e(ke,{user:i})}),p?b(F,{children:[e(d,{label:a("emailVerified"),fieldId:"kc-email-verified",helperTextInvalid:a("required"),labelIcon:e(v,{helpText:a("emailVerifiedHelp"),fieldLabelId:"emailVerified"}),children:e(G,{name:"emailVerified",defaultValue:!1,control:x,render:({field:t})=>e(N,{"data-testid":"email-verified-switch",id:"kc-user-email-verified",onChange:u=>t.onChange(u),isChecked:t.value,label:a("yes"),labelOff:a("no")})})}),e(de,{form:r,userProfileMetadata:p,hideReadOnly:!i,supportedLocales:n.supportedLocales||[],t:(t,u)=>a(t,{...u})})]}):b(F,{children:[!n.registrationEmailAsUsername&&e(d,{label:a("username"),fieldId:"kc-username",isRequired:!0,validated:y.username?"error":"default",helperTextInvalid:a("required"),children:e(k,{id:"kc-username",isReadOnly:!!i?.id&&!n.editUsernameAllowed&&n.editUsernameAllowed!==void 0,...C("username")})}),e(d,{label:a("email"),fieldId:"kc-email",validated:y.email?"error":"default",helperTextInvalid:a("emailInvalid"),children:e(k,{type:"email",id:"kc-email","data-testid":"email-input",...C("email",{pattern:se})})}),e(d,{label:a("emailVerified"),fieldId:"kc-email-verified",helperTextInvalid:a("required"),labelIcon:e(v,{helpText:a("emailVerifiedHelp"),fieldLabelId:"emailVerified"}),children:e(G,{name:"emailVerified",defaultValue:!1,control:x,render:({field:t})=>e(N,{"data-testid":"email-verified-switch",id:"kc-user-email-verified",onChange:u=>t.onChange(u),isChecked:t.value,label:a("yes"),labelOff:a("no")})})}),e(d,{label:a("firstName"),fieldId:"kc-firstName",validated:y.firstName?"error":"default",helperTextInvalid:a("required"),children:e(k,{"data-testid":"firstName-input",id:"kc-firstName",...C("firstName")})}),e(d,{label:a("lastName"),fieldId:"kc-lastName",validated:y.lastName?"error":"default",children:e(k,{"data-testid":"lastName-input",id:"kc-lastName","aria-label":a("lastName"),...C("lastName")})})]}),o&&e(d,{label:a("temporaryLocked"),fieldId:"temporaryLocked",labelIcon:e(v,{helpText:a("temporaryLockedHelp"),fieldLabelId:"temporaryLocked"}),children:e(N,{"data-testid":"user-locked-switch",id:"temporaryLocked",onChange:t=>{z(),$(t)},isChecked:R,isDisabled:!R,label:a("on"),labelOff:a("off")})}),!i?.id&&e(d,{label:a("groups"),fieldId:"kc-groups",validated:y.requiredActions?"error":"default",helperTextInvalid:a("required"),labelIcon:e(v,{helpText:a("groups"),fieldLabelId:"groups"}),children:e(G,{name:"groups",defaultValue:[],control:x,render:()=>b(oe,{children:[e(ce,{categoryName:" ",children:h.map(t=>e(me,{onClick:()=>J(t.name),children:t.path},t.id))}),e(T,{id:"kc-join-groups-button",onClick:_,variant:"secondary","data-testid":"join-groups-button",children:a("joinGroups")})]})})}),b(be,{children:[e(T,{"data-testid":i?.id?"save-user":"create-user",isDisabled:!i?.id&&!K&&!n.registrationEmailAsUsername,variant:"primary",type:"submit",children:i?.id?a("save"):a("create")}),e(T,{"data-testid":"cancel-create-user",variant:"link",onClick:i?.id?()=>B(ve(i,!!p)):void 0,component:i?.id?void 0:t=>e(j,{...t,to:ue({realm:n.id})}),children:i?.id?a("revert"):a("cancel")})]})]})};export{ke as F,ge as R,we as U,ve as a,qe as t};
//# sourceMappingURL=UserForm-KWIpw6L8.js.map
