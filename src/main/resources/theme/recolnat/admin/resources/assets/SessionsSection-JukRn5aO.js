import{jsxs as y,jsx as o,Fragment as D}from"react/jsx-runtime";import{useState as d}from"react";import{u as k,f as O,e as x,g as I,r as E,B as S,m as K,X as U,F as V,V as v,dg as q,j as g,A as n,K as L,a8 as P,P as M,S as j,c as T,cU as G}from"./index-sihFV1NS.js";import{u as H}from"./ConfirmDialog-WMVurgkl.js";import{V as $}from"./ViewHeader-xo54NRb6.js";import{K as z}from"./KeycloakTextInput--S1SG2UN.js";import{M as X,a as _}from"./Modal-uOAPm2rX.js";import{F as J}from"./Form-bfj-xQZn.js";import{S as Q}from"./SessionsTable-fP9nbE0z.js";import{u as W}from"./useToggle-mZS4AEtR.js";import{F as Y}from"./filter-icon-0B3gA_nj.js";import"react-dom";import"./ToolbarContent-46I9Yg7h.js";import"./PaginatingTableToolbar--Dt3wwL6.js";import"./EmptyStateBody-jnnI7hpP.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./TableToolbar-vuixsfwd.js";import"./KeycloakDataTable-Q3kZYP9q.js";import"./Td-uwYquKT4.js";import"./grip-vertical-icon-accuSWkz.js";import"./_baseRest-lI6NnEVt.js";import"./utils-ATQIxiIC.js";import"./useFormatDate-kyFeutIw.js";import"./ListItem-zTOCxRJG.js";const Z=({handleModalToggle:r,save:i})=>{const{t:e}=k(),{addAlert:s}=O(),{realm:a}=x(),{register:h,handleSubmit:l,formState:{errors:u}}=I(),[c,w]=d(),[b,A]=d(0),m=()=>{A(new Date().getTime())};E(()=>g.realms.findOne({realm:a}),t=>{w(t)},[b]);const B=(t,f)=>{const N=t.successRequests?.length||0,p=t.failedRequests?.length||0;N===0&&p===0?s(e("noAdminUrlSet"),n.warning):p>0?(s(e(""+f+"Success",{successNodes:t.successRequests}),n.success),s(e(""+f+"Fail",{failedNodes:t.failedRequests}),n.danger)):s(e(""+f+"Success",{successNodes:t.successRequests}),n.success)},C=async()=>{try{await g.realms.update({realm:a},{realm:a,notBefore:Date.now()/1e3}),s(e("notBeforeSuccess"),n.success)}catch(t){s(e("setToNowError",{error:t}),n.danger)}},R=async()=>{try{await g.realms.update({realm:a},{realm:a,notBefore:0}),s(e("notBeforeClearedSuccess"),n.success),m()}catch(t){s(e("notBeforeError",{error:t}),n.danger)}},F=async()=>{const t=await g.realms.pushRevocation({realm:a});B(t,"notBeforePush"),m()};return y(X,{variant:_.small,title:e("revocation"),isOpen:!0,onClose:r,actions:[o(S,{"data-testid":"set-to-now-button",variant:"tertiary",onClick:()=>{C(),r()},form:"revocation-modal-form",children:e("setToNow")},"set-to-now"),o(S,{"data-testid":"clear-not-before-button",variant:"tertiary",onClick:()=>{R(),r()},form:"revocation-modal-form",children:e("clear")},"clear"),o(S,{"data-testid":"modal-test-connection-button",variant:"secondary",onClick:()=>{F(),r()},form:"revocation-modal-form",children:e("push")},"push"),o(S,{id:"modal-cancel","data-testid":"cancel",variant:K.link,onClick:()=>{r()},children:e("cancel")},"cancel")],children:[o(U,{className:"kc-revocation-description-text",children:e("revocationDescription")}),o(J,{id:"revocation-modal-form",isHorizontal:!0,onSubmit:l(i),children:o(V,{className:"kc-revocation-modal-form-group",label:e("notBefore"),name:"notBefore",fieldId:"not-before",validated:u.email?v.error:v.default,children:o(z,{"data-testid":"not-before-input",autoFocus:!0,isReadOnly:!0,value:c?.notBefore===0?e("none"):new Date(c?.notBefore*1e3).toString(),type:"text",id:"not-before",...h("notBefore",{required:!0,pattern:q}),validated:u.email?v.error:v.default})})})]})},ee=({filterType:r,onChange:i})=>{const{t:e}=k(),[s,a]=W();return y(j,{"data-testid":"filter-session-type-select",isOpen:s,onToggle:a,toggleIcon:o(Y,{}),onSelect:(h,l)=>{i(l),a()},selections:r,children:[o(T,{"data-testid":"all-sessions-option",value:"ALL",children:e("sessionsType.allSessions")}),o(T,{"data-testid":"regular-sso-option",value:"REGULAR",children:e("sessionsType.regularSSO")}),o(T,{"data-testid":"offline-option",value:"OFFLINE",children:e("sessionsType.offline")})]})};function Re(){const{t:r}=k(),[i,e]=d(0),s=()=>e(i+1),{addError:a}=O(),{realm:h}=x(),[l,u]=d(!1),[c,w]=d("ALL"),[b,A]=d(!1),m=()=>{u(!l)},B=async(t,f,N)=>{const p=await G("ui-ext/sessions",{first:`${t}`,max:`${f}`,type:c,search:N||""});return A(p.length===0),p},[C,R]=H({titleKey:"logoutAllSessions",messageKey:"logoutAllDescription",continueButtonLabel:"confirm",onConfirm:async()=>{try{await g.realms.logoutAll({realm:h}),s()}catch(t){a("logoutAllSessionsError",t)}}}),F=[o(L,{"data-testid":"revocation",component:"button",onClick:()=>m(),children:r("revocation")},"toggle-modal"),o(L,{"data-testid":"logout-all",component:"button",isDisabled:b,onClick:C,children:r("signOutAllActiveSessions")},"delete-role")];return y(D,{children:[o(R,{}),o($,{dropdownItems:F,titleKey:"titleSessions",subKey:"sessionExplain",helpUrl:P.sessionsUrl}),y(M,{variant:"light",className:"pf-u-p-0",children:[l&&o(Z,{handleModalToggle:m,save:()=>{m()}}),o(Q,{loader:B,isSearching:c!=="ALL",isPaginated:!0,filter:o(ee,{filterType:c,onChange:t=>{w(t),s()}})},i)]})]})}export{Re as default};
//# sourceMappingURL=SessionsSection-JukRn5aO.js.map
