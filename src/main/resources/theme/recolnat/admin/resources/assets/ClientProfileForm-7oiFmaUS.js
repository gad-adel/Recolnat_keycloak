import{jsx as e,jsxs as a,Fragment as p}from"react/jsx-runtime";import{useState as x,useMemo as X,Fragment as Y}from"react";import{u as Z,d as _,g as ee,aI as te,f as ie,a4 as re,r as oe,m as ae,j as h,A as T,dq as N,dm as y,O as le,p as se,K as ne,P as ce,F as w,V as L,B as d,L as P,z as V,D as A,i as K,dC as de,a6 as me,dD as ue,a5 as fe}from"./index-sihFV1NS.js";import{u as pe}from"./ConfirmDialog-WMVurgkl.js";import{F as xe}from"./FormAccess-EK-4wbwg.js";import{K as he}from"./KeycloakTextArea-NBwG1p2x.js";import{K as Pe}from"./KeycloakTextInput--S1SG2UN.js";import{V as Ce}from"./ViewHeader-xo54NRb6.js";import{u as be}from"./useParams-OD1jI_R2.js";/* empty css                               */import{A as ge}from"./Form-bfj-xQZn.js";import{F as ke}from"./Flex-W2FoLD7u.js";import{F as S}from"./FlexItem-Mxf6oLng.js";import{e as ve,D as Te,a as ye,c as Ee,d as De}from"./DataListItemRow-te2VcAoi.js";import{T as Ie}from"./trash-icon-c1moCUVC.js";import"react-dom";import"./Modal-uOAPm2rX.js";import"./copy-icon-WaWzxYgU.js";import"./ToolbarContent-46I9Yg7h.js";import"./data-list-CDN1kyj9.js";import"./grip-vertical-icon-accuSWkz.js";const Fe={name:"",description:"",executors:[]};function Xe(){const{t}=Z(),C=_(),{handleSubmit:B,setValue:b,getValues:G,register:E,formState:{isDirty:D,errors:H},control:R}=ee({defaultValues:Fe,mode:"onChange"}),{fields:g,remove:q}=te({name:"executors",control:R}),{addAlert:k,addError:v}=ie(),[m,O]=x(),[o,j]=x(!1),{realm:n,profileName:l}=be(),z=re(),M=X(()=>z.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[]),[u,$]=x(),c=!!l,[I,J]=x(0),Q=()=>J(I+1);oe(()=>h.clientPolicies.listProfiles({includeGlobalProfiles:!0}),i=>{O({globalProfiles:i.globalProfiles,profiles:i.profiles?.filter(f=>f.name!==l)});const s=i.globalProfiles?.find(f=>f.name===l),r=i.profiles?.find(f=>f.name===l);j(s!==void 0),b("name",s?.name??r?.name??""),b("description",s?.description??r?.description??""),b("executors",s?.executors??r?.executors??[])},[I]);const U=async i=>{const s=i;try{await h.clientPolicies.createProfiles({...m,profiles:[...m?.profiles||[],s]}),k(t(c?"updateClientProfileSuccess":"createClientProfileSuccess"),T.success),C(N({realm:n,profileName:i.name}))}catch(r){v(c?"updateClientProfileError":"createClientProfileError",r)}},[F,W]=pe({titleKey:u?.name?t("deleteExecutorProfileConfirmTitle"):t("deleteClientProfileConfirmTitle"),messageKey:u?.name?t("deleteExecutorProfileConfirm",{executorName:u.name}):t("deleteClientProfileConfirm",{profileName:l}),continueButtonLabel:t("delete"),continueButtonVariant:ae.danger,onConfirm:async()=>{if(u?.name){q(u.idx);try{await h.clientPolicies.createProfiles({...m,profiles:[...m.profiles||[],G()]}),k(t("deleteExecutorSuccess"),T.success),C(N({realm:n,profileName:l}))}catch(i){v(t("deleteExecutorError"),i)}}else try{await h.clientPolicies.createProfiles(m),k(t("deleteClientSuccess"),T.success),C(y({realm:n,tab:"profiles"}))}catch(i){v(t("deleteClientError"),i)}}});return m?a(p,{children:[e(W,{}),e(Ce,{titleKey:c?l:t("newClientProfile"),badges:[{id:"global-client-profile-badge",text:o?e(se,{color:"blue",children:t("global")}):""}],divider:!0,dropdownItems:c&&!o?[e(ne,{value:"delete",onClick:F,"data-testid":"deleteClientProfileDropdown",children:t("deleteClientProfile")},"delete")]:void 0}),e(ce,{variant:"light",children:a(xe,{isHorizontal:!0,role:"view-realm",className:"pf-u-mt-lg",children:[e(w,{label:t("newClientProfileName"),fieldId:"kc-name",helperText:t("createClientProfileNameHelperText"),isRequired:!0,helperTextInvalid:t("required"),validated:H.name?L.error:L.default,children:e(Pe,{id:"kc-name","data-testid":"client-profile-name",isReadOnly:o,...E("name",{required:!0})})}),e(w,{label:t("description"),fieldId:"kc-description",children:e(he,{id:"kc-description","data-testid":"client-profile-description",isReadOnly:o,...E("description")})}),a(ge,{children:[!o&&e(d,{variant:"primary",onClick:()=>B(U)(),"data-testid":"saveCreateProfile",isDisabled:!D,children:t("save")}),c&&!o&&e(d,{id:"reloadProfile",variant:"link","data-testid":"reloadProfile",isDisabled:!D,onClick:Q,children:t("reload")}),!c&&!o&&e(d,{id:"cancelCreateProfile",variant:"link",component:i=>e(P,{...i,to:y({realm:n,tab:"profiles"})}),"data-testid":"cancelCreateProfile",children:t("cancel")})]}),c&&a(p,{children:[a(ke,{children:[e(S,{children:a(V,{className:"kc-executors",component:A.h1,children:[t("executors"),e(K,{helpText:t("executorsHelpText"),fieldLabelId:"executors"})]})}),!o&&e(S,{align:{default:"alignRight"},children:e(d,{id:"addExecutor",component:i=>e(P,{...i,to:de({realm:n,profileName:l})}),variant:"link",className:"kc-addExecutor","data-testid":"addExecutor",icon:e(me,{}),children:t("addExecutor")})})]}),g.length>0&&a(p,{children:[e(ve,{"aria-label":t("executors"),isCompact:!0,children:g.map((i,s)=>e(Te,{"aria-labelledby":"executors-list-item",id:i.executor,children:e(ye,{"data-testid":"executors-list-row",children:e(Ee,{dataListCells:[a(De,{"data-testid":"executor-type",children:[i.configuration?e(d,{component:r=>e(P,{...r,to:ue({realm:n,profileName:l,executorName:i.executor})}),variant:"link","data-testid":"editExecutor",children:i.executor}):e("span",{className:"kc-unclickable-executor",children:i.executor}),M?.filter(r=>r.id===i.executor).map(r=>a(Y,{children:[e(K,{helpText:r.helpText,fieldLabelId:"executorTypeTextHelpText"},r.id),!o&&e(d,{variant:"link",isInline:!0,icon:e(Ie,{className:"kc-executor-trash-icon","data-testid":"deleteExecutor"},`executorType-trash-icon-${r.id}`),onClick:()=>{F(),$({idx:s,name:r.id})},"aria-label":t("remove")})]},r.id))]},"executor")]})})},i.executor))}),o&&e(d,{id:"backToClientPolicies",component:i=>e(P,{...i,to:y({realm:n,tab:"profiles"})}),variant:"primary",className:"kc-backToPolicies","data-testid":"backToClientPolicies",children:t("back")})]}),g.length===0&&a(p,{children:[e(fe,{}),e(V,{className:"kc-emptyExecutors",component:A.h2,children:t("emptyExecutors")})]})]})]})})]}):e(le,{})}export{Xe as default};
//# sourceMappingURL=ClientProfileForm-7oiFmaUS.js.map
