import{jsx as e,jsxs as v}from"react/jsx-runtime";import{useState as a}from"react";import{u as L,f as M,d as R,e as $,M as q,a4 as J,g as K,r as Q,P as U,a_ as W,F as X,i as Y,C as Z,S as ii,b as oi,c as ti,h as ni,B as S,dl as b,j as A,A as ei}from"./index-sihFV1NS.js";import{D as ri}from"./DynamicComponents-f6aNOnzT.js";import{F as si}from"./FormAccess-EK-4wbwg.js";import{c as F}from"./camelCase-1QzwORZ_.js";import{A as ci}from"./Form-bfj-xQZn.js";import"react-dom";import"./ClientSelect-sh5SEoBO.js";import"./FileUpload-LIezXv7x.js";import"./CodeEditor-7uqvO0EK.js";import"./copy-icon-WaWzxYgU.js";import"./EmptyStateBody-jnnI7hpP.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./GroupPickerDialog-gC2-xBPw.js";import"./PaginatingTableToolbar--Dt3wwL6.js";import"./TableToolbar-vuixsfwd.js";import"./ToolbarContent-46I9Yg7h.js";import"./useToggle-mZS4AEtR.js";import"./KeycloakTextInput--S1SG2UN.js";import"./Modal-uOAPm2rX.js";import"./ConfirmDialog-WMVurgkl.js";import"./DataListItemRow-te2VcAoi.js";import"./data-list-CDN1kyj9.js";import"./grip-vertical-icon-accuSWkz.js";import"./_baseRest-lI6NnEVt.js";import"./ActionListItem-1jrwMZdM.js";import"./Flex-W2FoLD7u.js";import"./FlexItem-Mxf6oLng.js";import"./MultiLineInput-MBnUzZD_.js";import"./PasswordInput-P6txGPqu.js";import"./AddRoleMappingModal-uxjjMt5W.js";import"./useLocaleSort-K-jL4v2R.js";import"./KeycloakDataTable-Q3kZYP9q.js";import"./Td-uwYquKT4.js";import"./resource-BRtaBrSc.js";import"./filter-icon-0B3gA_nj.js";import"./KeycloakTextArea-NBwG1p2x.js";import"./capitalize-msOXuIMv.js";function Ki(){const{t}=L(),{addAlert:x,addError:D}=M(),C=R(),{realm:f}=$(),[I,g]=a(!1),[N,y]=a([]),[k,w]=a([]),[B,V]=a(),[d,j]=a(""),[h,P]=a([]),{policyName:l,conditionName:o}=q(),E=J(),p=K(),T=E.componentTypes?.["org.keycloak.services.clientpolicy.condition.ClientPolicyConditionProvider"],H=s=>{p.reset({config:s.configuration||{}})};Q(()=>A.clientPolicies.listPolicies(),s=>{if(y(s.policies??[]),o){const r=s.policies?.find(i=>i.name===l)?.conditions?.find(i=>i.condition===o),m=T?.find(i=>i.id===o);V(r),P(m?.properties),H(r)}},[]);const O=async s=>{const n=s.config,r=()=>h.reduce((i,c)=>(i[c.name]=n[c.name],i),{}),m=N.map(i=>{if(i.name!==l)return i;let c=i.conditions??[];if(o){const G={condition:B?.condition,configuration:r()},u=c.findIndex(z=>o===z.condition);if(u===-1)return;const _=[...c.slice(0,u),G,...c.slice(u+1)];return{...i,conditions:_}}return c=c.concat({condition:k[0].condition,configuration:r()}),{...i,conditions:c}});try{await A.clientPolicies.updatePolicy({policies:m}),y(m),C(b({realm:f,policyName:l})),x(t(o?"updateClientConditionSuccess":"createClientConditionSuccess"),ei.success)}catch(i){D("createClientConditionError",i)}};return e(U,{variant:"light",children:e(W,{className:"kc-login-screen",title:t(o?"editCondition":"addCondition"),children:v(si,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:p.handleSubmit(O),children:[e(X,{label:t("conditionType"),fieldId:"conditionType",labelIcon:e(Y,{helpText:d?`${F(d.replace(/-/g," "))}Help`:"conditionsHelp",fieldLabelId:"conditionType"}),children:e(Z,{name:"conditions",defaultValue:"any-client",control:p.control,render:({field:s})=>e(ii,{placeholderText:t("selectACondition"),className:"kc-conditionType-select","data-testid":"conditionType-select",toggleId:"provider",isDisabled:!!o,onToggle:n=>g(n),onSelect:(n,r)=>{s.onChange(r),P(r.properties),j(r.id),w([{condition:r.id}]),g(!1)},selections:o||d,variant:oi.single,"aria-label":t("conditionType"),isOpen:I,children:T?.map(n=>e(ti,{selected:n.id===s.value,description:t(F(n.id.replace(/-/g," "))),value:n,children:n.id},n.id))})})}),e(ni,{...p,children:e(ri,{properties:h})}),v(ci,{children:[e(S,{variant:"primary",type:"submit","data-testid":"addCondition-saveBtn",isDisabled:d===""&&!o,children:t(o?"save":"add")}),e(S,{variant:"link","data-testid":"addCondition-cancelBtn",onClick:()=>C(b({realm:f,policyName:l})),children:t("cancel")})]})]})})})}export{Ki as default};
//# sourceMappingURL=NewClientPolicyCondition-RfO3FvDW.js.map
