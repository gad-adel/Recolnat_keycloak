import{jsxs as d,jsx as e,Fragment as Z}from"react/jsx-runtime";import*as ze from"react";import{useState as f,useEffect as ye,useMemo as $t}from"react";import{d5 as ma,aM as qt,l as pa,cT as Nt,cp as It,r as Se,j as K,u as V,e as se,f as de,g as fe,Z as Le,P as te,a_ as oe,F as g,dg as ft,i as E,C as w,bo as vt,Q,af as st,dh as ha,L as be,b3 as fa,B as A,A as ae,ao as at,S as ce,b as he,c as ie,h as Lt,ac as Ot,G as Pe,m as le,V as pe,di as Ce,a4 as He,b9 as Mt,dj as Kt,a5 as qe,X as pt,aN as Wt,z as Ke,aB as et,aA as ba,p as nt,d as We,O as De,T as Jt,R as rt,dk as Vt,dl as ga,dm as yt,dn as va,dp as ya,dq as Ta,aD as Ca,D as Sa,a7 as ka,W as Ia,dr as Ft,I as La,ai as Pa,K as it,aj as _e,de as Tt,df as Pt,Y as Ea,ds as xa,a as Xt,dt as Ht,du as wa,bP as Aa,dv as Da,dw as Ut,dx as Bt,dy as Qt,bF as bt,E as Gt,aG as Ra,ba as Na,bz as Oa,a8 as Ma,aR as Ka,H as Va}from"./index-sihFV1NS.js";import{u as Fa}from"./useParams-OD1jI_R2.js";import{u as me}from"./ConfirmDialog-WMVurgkl.js";import{R as ot,u as ct}from"./RoutableTabs-a7VqIL_I.js";import{F as Ct,V as Ha}from"./ViewHeader-xo54NRb6.js";import{u as Et,F as dt}from"./useIsFeatureEnabled-qmmJPqO8.js";import{F as Y,b as Ua,S as Yt,a as we}from"./FormAccess-EK-4wbwg.js";import{K as re}from"./KeycloakTextInput--S1SG2UN.js";import{P as Ba}from"./PasswordInput-P6txGPqu.js";import{u as Ve}from"./useToggle-mZS4AEtR.js";/* empty css                               */import{A as ge,F as xt}from"./Form-bfj-xQZn.js";import{a as gt}from"./ActionListItem-1jrwMZdM.js";import{K as Ga}from"./KeyValueInput-CbiNnu-2.js";import{P as za,L as Ae}from"./PaginatingTableToolbar--Dt3wwL6.js";import{u as _a,m as ja}from"./useLocaleSort-K-jL4v2R.js";import{M as Fe,a as $e}from"./Modal-uOAPm2rX.js";import{a6 as zt,X as $a,ai as qa,aj as Wa,ak as Ja,N as Me}from"./Td-uwYquKT4.js";import{i as Zt}from"./isEqual-guRJoAyD.js";import{b as ve,T as ea,c as Xa,a as Qa}from"./ToolbarContent-46I9Yg7h.js";import{T as Ya,m as Za,n as el,K as Ue}from"./KeycloakDataTable-Q3kZYP9q.js";import{J as tl}from"./JsonFileUpload-vH-C_c0p.js";import{e as ta,D as aa,a as la,c as na,d as St}from"./DataListItemRow-te2VcAoi.js";import{F as ia}from"./Flex-W2FoLD7u.js";import{F as je}from"./FlexItem-Mxf6oLng.js";import{C as wt,L as At}from"./CodeEditor-7uqvO0EK.js";import{T as q,t as al}from"./TimeSelector-UGEjvSE_.js";import{N as ut}from"./NumberInput-QtFengwl.js";import{R as ll}from"./AddRoleMappingModal-uxjjMt5W.js";import{G as nl}from"./GroupPickerDialog-gC2-xBPw.js";import{T as mt}from"./Trans-1cjg0ImV.js";import{Q as il}from"./question-circle-icon-0KWACECW.js";import{T as Dt,a as B,b as G}from"./Tabs-wiayO8Tk.js";import{u as sl}from"./useFormatDate-kyFeutIw.js";import{F as sa}from"./filter-icon-0B3gA_nj.js";import{D as ra}from"./DraggableTable-ZpdKj1kF.js";import{KeyProviderForm as rl}from"./KeyProviderForm-7CT79z_O.js";import{u as Rt,U as ol}from"./UserProfileContext-1YYbbzWi.js";import"react-dom";import"./copy-icon-WaWzxYgU.js";import"./minus-icon-3MARcJXf.js";import"./EmptyStateBody-jnnI7hpP.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./TableToolbar-vuixsfwd.js";import"./grip-vertical-icon-accuSWkz.js";import"./_baseRest-lI6NnEVt.js";import"./FileUploadForm-NPdolxQM.js";import"./FileUpload-LIezXv7x.js";import"./data-list-CDN1kyj9.js";import"./plus-icon-zbmNbCLY.js";import"./resource-BRtaBrSc.js";import"./MenuList-82IaVNxu.js";import"./DynamicComponents-f6aNOnzT.js";import"./ClientSelect-sh5SEoBO.js";import"./MultiLineInput-MBnUzZD_.js";import"./KeycloakTextArea-NBwG1p2x.js";function cl(a,l){return l=typeof l=="function"?l:void 0,a&&a.length?ma(a,void 0,l):[]}const kt=({value:a,rowIndex:l,cellIndex:t,props:n,handleTextInputChange:i,inputAriaLabel:r,isDisabled:u=!1})=>ze.createElement(ze.Fragment,null,ze.createElement("div",{className:zt.inlineEditValue},a),ze.createElement("div",{className:zt.inlineEditInput},ze.createElement(qt,{isDisabled:u,value:n.editableValue!==void 0?n.editableValue:a,validated:n.isValid!==!1?"default":"error",type:"text",onChange:(o,v)=>{i(o,v,l,t)},"aria-label":r}),ze.createElement("div",{className:pa(Nt.formHelperText,Nt.modifiers.error),"aria-live":"polite"},n.errorText)));kt.displayName="EditableTextCell";function dl(){const{whoAmI:a}=It(),[l,t]=f(),n=a.getUserId();return Se(()=>K.users.findOne({id:n}),t,[n]),l}const ul=({realm:a,save:l})=>{const{t}=V(),{realm:n}=se(),{addAlert:i,addError:r}=de(),u=dl(),{register:o,control:v,handleSubmit:c,watch:p,reset:b,getValues:L,formState:{errors:h}}=fe({defaultValues:a}),y=()=>b(a),P=p("smtpServer.from",""),s=p("smtpServer.host",""),[m,C]=Ve(),I=Le({control:v,name:"smtpServer.auth",defaultValue:""}),N=async()=>{const R=F=>Number(F),k=F=>F===(!0).toString(),D=new Map([["port",R],["ssl",k],["starttls",k],["auth",k]]),H={...L().smtpServer};for(const[F,S]of D.entries())H[F]=S(H[F]);H.port===0&&(H.port=null);try{C(),await K.realms.testSMTPConnection({realm:a.realm},H),i(t("testConnectionSuccess"),ae.success)}catch(F){r("testConnectionError",F)}C()};return d(te,{variant:"light",children:[e(oe,{title:t("template"),className:"kc-email-template",children:d(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:c(l),children:[e(g,{label:t("from"),fieldId:"kc-display-name",isRequired:!0,validated:h.smtpServer?.from?"error":"default",helperTextInvalid:t("emailInvalid"),children:e(re,{type:"email",id:"kc-sender-email-address","data-testid":"sender-email-address",placeholder:"Sender email address",validated:h.smtpServer?.from?"error":"default",...o("smtpServer.from",{pattern:ft,required:!0})})}),e(g,{label:t("fromDisplayName"),fieldId:"kc-from-display-name",labelIcon:e(E,{helpText:t("fromDisplayNameHelp"),fieldLabelId:"authentication"}),children:e(re,{id:"kc-from-display-name","data-testid":"from-display-name",placeholder:"Display name for Sender email address",...o("smtpServer.fromDisplayName")})}),e(g,{label:t("replyTo"),fieldId:"kc-reply-to",validated:h.smtpServer?.replyTo?"error":"default",helperTextInvalid:t("emailInvalid"),children:e(re,{type:"email",id:"kc-reply-to",placeholder:"Reply to email address",validated:h.smtpServer?.replyTo?"error":"default",...o("smtpServer.replyTo",{pattern:ft})})}),e(g,{label:t("replyToDisplayName"),fieldId:"kc-reply-to-display-name",labelIcon:e(E,{helpText:t("replyToDisplayNameHelp"),fieldLabelId:"replyToDisplayName"}),children:e(re,{id:"kc-reply-to-display-name",placeholder:'Display name for "reply to" email address',...o("smtpServer.replyToDisplayName")})}),e(g,{label:t("envelopeFrom"),fieldId:"kc-envelope-from",labelIcon:e(E,{helpText:t("envelopeFromHelp"),fieldLabelId:"envelopeFrom"}),children:e(re,{id:"kc-envelope-from",placeholder:"Sender envelope email address",...o("smtpServer.envelopeFrom")})})]})}),e(oe,{className:"kc-email-connection",title:t("connectionAndAuthentication"),children:d(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:c(l),children:[e(g,{label:t("host"),fieldId:"kc-host",isRequired:!0,validated:h.smtpServer?.host?"error":"default",helperTextInvalid:t("required"),children:e(re,{id:"kc-host",placeholder:"SMTP host",validated:h.smtpServer?.host?"error":"default",...o("smtpServer.host",{required:!0})})}),e(g,{label:t("port"),fieldId:"kc-port",children:e(re,{id:"kc-port",placeholder:"SMTP port (defaults to 25)",...o("smtpServer.port")})}),d(g,{label:t("encryption"),fieldId:"kc-html-display-name",children:[e(w,{name:"smtpServer.ssl",control:v,defaultValue:"false",render:({field:R})=>e(vt,{id:"kc-enable-ssl","data-testid":"enable-ssl",label:t("enableSSL"),isChecked:R.value==="true",onChange:k=>R.onChange(""+k)})}),e(w,{name:"smtpServer.starttls",control:v,defaultValue:"false",render:({field:R})=>e(vt,{id:"kc-enable-start-tls","data-testid":"enable-start-tls",label:t("enableStartTLS"),isChecked:R.value==="true",onChange:k=>R.onChange(""+k)})})]}),e(g,{hasNoPaddingTop:!0,label:t("authentication"),fieldId:"kc-authentication",children:e(w,{name:"smtpServer.auth",control:v,defaultValue:"",render:({field:R})=>e(Q,{id:"kc-authentication-switch","data-testid":"email-authentication-switch",label:t("enabled"),labelOff:t("disabled"),isChecked:R.value==="true",onChange:k=>{R.onChange(""+k)},"aria-label":t("authentication")})})}),I==="true"&&d(Z,{children:[e(g,{label:t("username"),fieldId:"kc-username",isRequired:!0,validated:h.smtpServer?.user?"error":"default",helperTextInvalid:t("required"),children:e(re,{id:"kc-username","data-testid":"username-input",placeholder:"Login username",validated:h.smtpServer?.user?"error":"default",...o("smtpServer.user",{required:!0})})}),e(g,{label:t("password"),fieldId:"kc-username",isRequired:!0,validated:h.smtpServer?.password?"error":"default",helperTextInvalid:t("required"),labelIcon:e(E,{helpText:t("passwordHelp"),fieldLabelId:"password"}),children:e(Ba,{id:"kc-password","data-testid":"password-input","aria-label":t("password"),validated:h.smtpServer?.password?"error":"default",...o("smtpServer.password",{required:!0})})})]}),u&&e(g,{id:"descriptionTestConnection",children:u.email?e(st,{variant:"info",isInline:!0,title:t("testConnectionHint.withEmail",{email:u.email})}):e(st,{variant:"warning",component:"h2",isInline:!0,title:t("testConnectionHint.withoutEmail",{userName:u.username}),actionLinks:e(ha,{component:R=>e(be,{...R,to:fa({realm:n,id:u.id,tab:"settings"})}),children:t("testConnectionHint.withoutEmailAction")})})}),d(ge,{children:[e(gt,{children:e(A,{variant:"primary",type:"submit","data-testid":"email-tab-save",children:t("save")})}),e(gt,{children:e(A,{variant:"secondary",onClick:()=>N(),"data-testid":"test-connection-button",isDisabled:!(ft.test(P)&&s)||!u?.email,"aria-describedby":"descriptionTestConnection",isLoading:m,spinnerAriaValueText:t("testingConnection"),children:t("testConnection")})}),e(gt,{children:e(A,{variant:"link",onClick:y,"data-testid":"email-tab-revert",children:t("revert")})})]})]})})]})},ml=({realm:a,save:l})=>{const{t}=V(),{realm:n}=se(),i=fe(),{register:r,control:u,handleSubmit:o,setValue:v,formState:{isDirty:c,errors:p}}=i,b=Et(),[L,h]=f(!1),y=["all","external","none"],P=()=>{if(Pe(a,v),a.attributes?.["acr.loa.map"]){const s=Object.entries(JSON.parse(a.attributes["acr.loa.map"])).flatMap(([m,C])=>({key:m,value:C}));s.concat({key:"",value:""}),v(at("attributes.acr.loa.map"),s)}};return ye(P,[]),e(te,{variant:"light",children:d(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:o(l),children:[e(g,{label:t("realmId"),fieldId:"kc-realm-id",isRequired:!0,validated:p.realm?"error":"default",helperTextInvalid:p.realm?.message,children:e(w,{name:"realm",control:u,rules:{required:{value:!0,message:t("required")},pattern:{value:/^[a-zA-Z0-9-_]+$/,message:t("invalidRealmName")}},defaultValue:"",render:({field:s})=>e(Ua,{"data-testid":"realmName",onChange:s.onChange,children:s.value})})}),e(g,{label:t("displayName"),fieldId:"kc-display-name",children:e(re,{id:"kc-display-name",...r("displayName")})}),e(g,{label:t("htmlDisplayName"),fieldId:"kc-html-display-name",children:e(re,{id:"kc-html-display-name",...r("displayNameHtml")})}),e(g,{label:t("frontendUrl"),fieldId:"kc-frontend-url",labelIcon:e(E,{helpText:t("frontendUrlHelp"),fieldLabelId:"frontendUrl"}),children:e(re,{type:"url",id:"kc-frontend-url",...r(at("attributes.frontendUrl"))})}),e(g,{label:t("requireSsl"),fieldId:"kc-require-ssl",labelIcon:e(E,{helpText:t("requireSslHelp"),fieldLabelId:"requireSsl"}),children:e(w,{name:"sslRequired",defaultValue:"none",control:u,render:({field:s})=>e(ce,{toggleId:"kc-require-ssl",onToggle:()=>h(!L),onSelect:(m,C)=>{s.onChange(C),h(!1)},selections:s.value,variant:he.single,"aria-label":t("requireSsl"),isOpen:L,children:y.map(m=>e(ie,{selected:m===s.value,value:m,children:t(`sslType.${m}`)},m))})})}),e(g,{label:t("acrToLoAMapping"),fieldId:"acrToLoAMapping",labelIcon:e(E,{helpText:t("acrToLoAMappingHelp"),fieldLabelId:"acrToLoAMapping"}),children:e(Lt,{...i,children:e(Ga,{name:at("attributes.acr.loa.map")})})}),e(g,{hasNoPaddingTop:!0,label:t("userManagedAccess"),labelIcon:e(E,{helpText:t("userManagedAccessHelp"),fieldLabelId:"userManagedAccess"}),fieldId:"kc-user-managed-access",children:e(w,{name:"userManagedAccessAllowed",control:u,defaultValue:!1,render:({field:s})=>e(Q,{id:"kc-user-managed-access","data-testid":"user-managed-access-switch",label:t("on"),labelOff:t("off"),isChecked:s.value,onChange:s.onChange,"aria-label":t("userManagedAccess")})})}),b(dt.DeclarativeUserProfile)&&e(g,{hasNoPaddingTop:!0,label:t("userProfileEnabled"),labelIcon:e(E,{helpText:t("userProfileEnabledHelp"),fieldLabelId:"userProfileEnabled"}),fieldId:"kc-user-profile-enabled",children:e(w,{name:at("attributes.userProfileEnabled"),control:u,defaultValue:"false",render:({field:s})=>e(Q,{id:"kc-user-profile-enabled","data-testid":"user-profile-enabled-switch",label:t("on"),labelOff:t("off"),isChecked:s.value==="true",onChange:m=>s.onChange(m.toString()),"aria-label":t("userProfileEnabled")})})}),e(g,{label:t("endpoints"),labelIcon:e(E,{helpText:t("endpointsHelp"),fieldLabelId:"endpoints"}),fieldId:"kc-endpoints",children:d(Yt,{children:[e(we,{children:e(Ct,{href:`${Ot(K.baseUrl)}realms/${n}/.well-known/openid-configuration`,title:t("openIDEndpointConfiguration")})}),e(we,{children:e(Ct,{href:`${Ot(K.baseUrl)}realms/${n}/protocol/saml/descriptor`,title:t("samlIdentityProviderMetadata")})})]})}),d(ge,{children:[e(A,{variant:"primary",type:"submit","data-testid":"general-tab-save",isDisabled:!c,children:t("save")}),e(A,{"data-testid":"general-tab-revert",variant:"link",onClick:P,children:t("revert")})]})]})})},pl=({handleModalToggle:a,save:l,form:{register:t,handleSubmit:n,formState:{errors:i}}})=>{const{t:r}=V();return e(Fe,{variant:$e.small,title:r("addMessageBundle"),isOpen:!0,onClose:a,actions:[e(A,{"data-testid":"add-bundle-confirm-button",variant:"primary",type:"submit",form:"bundle-form",children:r("create")},"confirm"),e(A,{id:"modal-cancel","data-testid":"cancel",variant:le.link,onClick:()=>{a()},children:r("cancel")},"cancel")],children:d(xt,{id:"bundle-form",isHorizontal:!0,onSubmit:n(l),children:[e(g,{label:r("key"),name:"key",fieldId:"key-id",helperTextInvalid:r("required"),validated:i.key?pe.error:pe.default,isRequired:!0,children:e(re,{"data-testid":"key-input",autoFocus:!0,id:"key-id",validated:i.key?pe.error:pe.default,...t("key",{required:!0})})}),e(g,{label:r("value"),name:"add-value",fieldId:"value-id",helperTextInvalid:r("required"),validated:i.value?pe.error:pe.default,isRequired:!0,children:e(re,{"data-testid":"value-input",id:"value-id",validated:i.value?pe.error:pe.default,...t("value",{required:!0})})})]})})},Ee=a=>{try{return new Intl.DisplayNames([a],{type:"language"}).of(a)}catch{return a}},hl=({save:a,realm:l})=>{const{t}=V(),[n,i]=f(!1),[r,u]=f(!1),[o,v]=f(!1),[c,p]=f(!1),[b,L]=f(Ce),{setValue:h,getValues:y,control:P,handleSubmit:s,formState:m}=fe(),[C,I]=f(!1),[N,R]=f([]),[k,D]=f([]),H=He().themes,F=$t(()=>{const x=Object.values(H).flatMap(M=>M.flatMap(({locales:X})=>X||[]));return Array.from(new Set(x))},[H]),S=fe({mode:"onChange"}),{addAlert:U,addError:W}=de(),{realm:O}=se(),{whoAmI:$}=It(),J=_a(),ue=l.supportedLocales?.length?l.supportedLocales:[Ce],Te=()=>{Pe(l,h),h("supportedLocales",ue)};ye(Te,[]);const _=Le({control:P,name:"supportedLocales",defaultValue:ue}),Je=Le({control:P,name:"internationalizationEnabled",defaultValue:l.internationalizationEnabled}),[ee,Xe]=f(0),[Be,tt]=f(10),[Re,Ge]=f(0),[Ne,ht]=f(""),Qe=()=>{Xe(ee+1)};Se(async()=>{let x=await K.realms.getRealmLocalizationTexts({first:Re,max:Be,realm:l.realm,selectedLocale:b||y("defaultLocale")||$.getLocale()}).catch(()=>[]);const M=X=>Object.entries(x).filter(z=>z[X].includes(Ne));if(Ne){const X=cl(M(0).concat(M(1)),Zt);x=Object.fromEntries(X)}return{result:x}},({result:x})=>{const M=J(Object.entries(x).map(([z,ne])=>({key:z,value:ne})),ja("key")).slice(Re,Re+Be+1);R(M);const X=M.map(z=>({rowEditBtnAriaLabel:()=>t("rowEditBtnAriaLabel",{messageBundle:z.value}),rowSaveBtnAriaLabel:()=>t("rowSaveBtnAriaLabel",{messageBundle:z.value}),rowCancelBtnAriaLabel:()=>t("rowCancelBtnAriaLabel",{messageBundle:z.value}),cells:[{title:(ne,Ie,Oe,Ye)=>e(kt,{value:ne,rowIndex:Ie,cellIndex:Oe,props:Ye,isDisabled:!0,handleTextInputChange:T,inputAriaLabel:z.key}),props:{value:z.key}},{title:(ne,Ie,Oe,Ye)=>e(kt,{value:ne,rowIndex:Ie,cellIndex:Oe,props:Ye,handleTextInputChange:T,inputAriaLabel:z.value}),props:{value:z.value}}]}));return D(X),M},[ee,Ne,Re,Be]);const T=(x,M,X,z)=>{D(ne=>{const Ie=Mt(ne),Oe=Ie[X]?.cells?.[z];return Oe.props.editableValue=x,Ie})},j=async(x,M,X)=>{if(M===void 0)return;const z=Mt(k);let ne;const Ie=!!X&&Object.keys(X).length>0;if(Ie?ne=qa(z[M],x,X):x==="cancel"?ne=Wa(z[M]):ne=Ja(z[M],x),z[M]=ne,!Ie&&x==="save"){const Oe=(ne.cells?.[0]).props.value,Ye=(ne.cells?.[1]).props.value;try{await K.realms.addLocalization({realm:l.realm,selectedLocale:b||y("defaultLocale")||Ce,key:Oe},Ye),U(t("updateMessageBundleSuccess"),ae.success)}catch{U(t("updateMessageBundleError"),ae.danger)}}D(z)},ke=()=>{i(!n)},ca=[e(Kt,{label:t("defaultLocale"),children:e(ie,{value:Ce,children:Ee(Ce)},Ce)},"group1"),e(qe,{},"divider"),e(Kt,{label:t("supportedLocales"),children:_.map(x=>e(ie,{value:x,children:Ee(x)},x))},"group2")],da=async x=>{try{await K.realms.addLocalization({realm:O,selectedLocale:b||y("defaultLocale")||Ce,key:x.key},x.value),K.setConfig({realmName:O}),Qe(),U(t("addMessageBundleSuccess"),ae.success)}catch(M){W(t("addMessageBundleError"),M)}},ua=async x=>{try{await K.realms.deleteRealmLocalizationTexts({realm:O,selectedLocale:b,key:x}),Qe(),U(t("deleteMessageBundleSuccess"))}catch(M){W("deleteMessageBundleError",M)}};return d(Z,{children:[n&&e(pl,{handleModalToggle:ke,save:x=>{da(x),ke()},form:S}),d(te,{variant:"light",children:[d(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:s(a),children:[e(g,{label:t("internationalization"),fieldId:"kc-internationalization",labelIcon:e(E,{helpText:t("internationalizationHelp"),fieldLabelId:"internationalization"}),children:e(w,{name:"internationalizationEnabled",control:P,defaultValue:l.internationalizationEnabled,render:({field:x})=>e(Q,{id:"kc-l-internationalization",label:t("enabled"),labelOff:t("disabled"),isChecked:x.value,"data-testid":x.value?"internationalization-enabled":"internationalization-disabled",onChange:x.onChange,"aria-label":t("internationalization")})})}),Je&&d(Z,{children:[e(g,{label:t("supportedLocales"),fieldId:"kc-l-supported-locales",children:e(w,{name:"supportedLocales",control:P,defaultValue:ue,render:({field:x})=>e(ce,{toggleId:"kc-l-supported-locales",onToggle:M=>{u(M)},onSelect:(M,X)=>{const z=X;x.value.includes(z)?x.onChange(x.value.filter(ne=>ne!==z)):x.onChange([...x.value,z])},onClear:()=>{x.onChange([])},selections:x.value,variant:he.typeaheadMulti,"aria-label":t("supportedLocales"),isOpen:r,placeholderText:t("selectLocales"),children:F.map(M=>e(ie,{selected:x.value.includes(M),value:M,children:Ee(M)},M))})})}),e(g,{label:t("defaultLocale"),fieldId:"kc-l-default-locale",children:e(w,{name:"defaultLocale",control:P,defaultValue:Ce,render:({field:x})=>e(ce,{toggleId:"kc-default-locale",onToggle:()=>v(!o),onSelect:(M,X)=>{x.onChange(X),v(!1)},selections:x.value?Ee(x.value):l.defaultLocale!==""?Ee(l.defaultLocale||Ce):t("placeholderText"),variant:he.single,"aria-label":t("defaultLocale"),isOpen:o,placeholderText:t("placeholderText"),"data-testid":"select-default-locale",children:_.map((M,X)=>e(ie,{value:M,children:Ee(M)},`default-locale-${X}`))})})})]}),d(ge,{children:[e(A,{variant:"primary",isDisabled:!m.isDirty,type:"submit","data-testid":"localization-tab-save",children:t("save")}),e(A,{variant:"link",onClick:Te,children:t("revert")})]})]}),d(oe,{className:"kc-message-bundles",title:"Edit message bundles",children:[e(pt,{className:"messageBundleDescription",children:t("messageBundleDescription")}),e("div",{className:"tableBorder",children:d(za,{count:N.length,first:Re,max:Be,onNextClick:Ge,onPreviousClick:Ge,onPerPageSelect:(x,M)=>{Ge(x),tt(M)},inputGroupName:"search",inputGroupOnEnter:x=>{ht(x),Ge(0),tt(10)},inputGroupPlaceholder:t("searchForMessageBundle"),toolbarItem:e(A,{"data-testid":"add-bundle-button",onClick:()=>i(!0),children:t("addMessageBundle")}),searchTypeComponent:e(ve,{children:e(ce,{width:180,"data-testid":"filter-by-locale-select",isOpen:c,className:"kc-filter-by-locale-select",variant:he.single,isDisabled:!Je,onToggle:x=>p(x),onSelect:(x,M)=>{L(M.toString()),I(!0),Qe(),p(!1)},selections:C?Ee(b):l.defaultLocale!==""?Ee(Ce):t("placeholderText"),children:ca})}),children:[N.length===0&&!Ne&&e(Ae,{hasIcon:!0,message:t("noMessageBundles"),instructions:t("noMessageBundlesInstructions"),onPrimaryAction:ke}),N.length===0&&Ne&&e(Ae,{hasIcon:!0,icon:Wt,isSearchVariant:!0,message:t("noSearchResults"),instructions:t("noSearchResultsInstructions")}),N.length!==0&&d(Ya,{"aria-label":t("editableRowsTable"),"data-testid":"editable-rows-table",variant:$a.compact,cells:[t("key"),t("value")],rows:k,onRowEdit:(x,M,X,z,ne)=>j(M,z,ne),actions:[{title:t("delete"),onClick:(x,M)=>ua((k[M].cells?.[0]).props.value)}],children:[e(Za,{}),e(el,{})]})]})})]})]})]})},fl=({realm:a,refresh:l})=>{const{t}=V(),{addAlert:n,addError:i}=de(),{realm:r}=se(),u=async o=>{const v=Array.isArray(o)?Object.keys(o[0])[0]:Object.keys(o)[0];try{await K.realms.update({realm:r},Array.isArray(o)?o.reduce((c,p)=>Object.assign(c,p),a):Object.assign(a,o)),n(t("enableSwitchSuccess",{switch:t(v)})),l()}catch(c){i(t("enableSwitchError"),c)}};return d(te,{variant:"light",children:[e(oe,{className:"kc-login-screen",title:t("loginScreenCustomization"),children:d(Y,{isHorizontal:!0,role:"manage-realm",children:[e(g,{label:t("registrationAllowed"),fieldId:"kc-user-reg",labelIcon:e(E,{helpText:t("userRegistrationHelpText"),fieldLabelId:"registrationAllowed"}),hasNoPaddingTop:!0,children:e(Q,{id:"kc-user-reg-switch","data-testid":"user-reg-switch",value:a.registrationAllowed?"on":"off",label:t("on"),labelOff:t("off"),isChecked:a.registrationAllowed,onChange:o=>{u({registrationAllowed:o})},"aria-label":t("registrationAllowed")})}),e(g,{label:t("resetPasswordAllowed"),fieldId:"kc-forgot-pw",labelIcon:e(E,{helpText:t("forgotPasswordHelpText"),fieldLabelId:"resetPasswordAllowed"}),hasNoPaddingTop:!0,children:e(Q,{id:"kc-forgot-pw-switch","data-testid":"forgot-pw-switch",name:"resetPasswordAllowed",value:a.resetPasswordAllowed?"on":"off",label:t("on"),labelOff:t("off"),isChecked:a.resetPasswordAllowed,onChange:o=>{u({resetPasswordAllowed:o})},"aria-label":t("resetPasswordAllowed")})}),e(g,{label:t("rememberMe"),fieldId:"kc-remember-me",labelIcon:e(E,{helpText:t("rememberMeHelpText"),fieldLabelId:"rememberMe"}),hasNoPaddingTop:!0,children:e(Q,{id:"kc-remember-me-switch","data-testid":"remember-me-switch",value:a.rememberMe?"on":"off",label:t("on"),labelOff:t("off"),isChecked:a.rememberMe,onChange:o=>{u({rememberMe:o})},"aria-label":t("rememberMe")})})]})}),e(oe,{className:"kc-email-settings",title:t("emailSettings"),children:d(Y,{isHorizontal:!0,role:"manage-realm",children:[e(g,{label:t("registrationEmailAsUsername"),fieldId:"kc-email-as-username",labelIcon:e(E,{helpText:t("emailAsUsernameHelpText"),fieldLabelId:"registrationEmailAsUsername"}),hasNoPaddingTop:!0,children:e(Q,{id:"kc-email-as-username-switch","data-testid":"email-as-username-switch",value:a.registrationEmailAsUsername?"on":"off",label:t("on"),labelOff:t("off"),isChecked:a.registrationEmailAsUsername,onChange:o=>{u([{registrationEmailAsUsername:o},{duplicateEmailsAllowed:!1}])},"aria-label":t("registrationEmailAsUsername")})}),e(g,{label:t("loginWithEmailAllowed"),fieldId:"kc-login-with-email",labelIcon:e(E,{helpText:t("loginWithEmailHelpText"),fieldLabelId:"loginWithEmailAllowed"}),hasNoPaddingTop:!0,children:e(Q,{id:"kc-login-with-email-switch","data-testid":"login-with-email-switch",value:a.loginWithEmailAllowed?"on":"off",label:t("on"),labelOff:t("off"),isChecked:a.loginWithEmailAllowed,onChange:o=>{u([{loginWithEmailAllowed:o},{duplicateEmailsAllowed:!1}])},"aria-label":t("loginWithEmailAllowed")})}),e(g,{label:t("duplicateEmailsAllowed"),fieldId:"kc-duplicate-emails",labelIcon:e(E,{helpText:t("duplicateEmailsHelpText"),fieldLabelId:"duplicateEmailsAllowed"}),hasNoPaddingTop:!0,children:e(Q,{id:"kc-duplicate-emails-switch","data-testid":"duplicate-emails-switch",label:t("on"),labelOff:t("off"),isChecked:a.duplicateEmailsAllowed||a.loginWithEmailAllowed&&a.registrationEmailAsUsername,onChange:o=>{u({duplicateEmailsAllowed:o})},isDisabled:a.loginWithEmailAllowed||a.registrationEmailAsUsername,"aria-label":t("duplicateEmailsAllowed")})}),e(g,{label:t("verifyEmail"),fieldId:"kc-verify-email",labelIcon:e(E,{helpText:t("verifyEmailHelpText"),fieldLabelId:"verifyEmail"}),hasNoPaddingTop:!0,children:e(Q,{id:"kc-verify-email-switch","data-testid":"verify-email-switch",name:"verifyEmail",value:a.verifyEmail?"on":"off",label:t("on"),labelOff:t("off"),isChecked:a.verifyEmail,onChange:o=>{u({verifyEmail:o})},"aria-label":t("verifyEmail")})})]})}),e(oe,{className:"kc-user-info-settings",title:t("userInfoSettings"),children:e(Y,{isHorizontal:!0,role:"manage-realm",children:e(g,{label:t("editUsernameAllowed"),fieldId:"kc-edit-username",labelIcon:e(E,{helpText:t("editUsernameHelp"),fieldLabelId:"editUsernameAllowed"}),hasNoPaddingTop:!0,children:e(Q,{id:"kc-edit-username-switch","data-testid":"edit-username-switch",value:a.editUsernameAllowed?"on":"off",label:t("on"),labelOff:t("off"),isChecked:a.editUsernameAllowed,onChange:o=>{u({editUsernameAllowed:o})},"aria-label":t("editUsernameAllowed")})})})})]})},bl=({isOpen:a,onClose:l})=>{const{t}=V(),{realm:n}=se(),{addAlert:i,addError:r}=de(),[u,o]=f(!1),[v,c]=f(!1),[p,b]=f(!1),L=u||v;async function h(){b(!0);try{const y=await K.realms.export({realm:n,exportClients:v,exportGroupsAndRoles:u});ba.saveAs(new Blob([et(y)],{type:"application/json"}),"realm-export.json"),i(t("exportSuccess"),ae.success),l()}catch(y){r("exportFail",y)}b(!1)}return d(Fe,{variant:$e.small,title:t("partialExport"),isOpen:a,onClose:l,actions:[e(A,{"data-testid":"export-button",isDisabled:p,onClick:h,children:t("export")},"export"),e(A,{"data-testid":"cancel-button",variant:le.link,onClick:l,children:t("cancel")},"cancel")],children:[e(pt,{children:e(Ke,{children:t("partialExportHeaderText")})}),d(xt,{isHorizontal:!0,className:"keycloak__realm-settings__partial-import_form",children:[e(g,{label:t("includeGroupsAndRoles"),fieldId:"include-groups-and-roles-check",hasNoPaddingTop:!0,children:e(Q,{id:"include-groups-and-roles-check","data-testid":"include-groups-and-roles-check",isChecked:u,onChange:o,label:t("on"),labelOff:t("off"),"aria-label":t("includeGroupsAndRoles")})}),e(g,{label:t("includeClients"),fieldId:"include-clients-check",hasNoPaddingTop:!0,children:e(Q,{id:"include-clients-check","data-testid":"include-clients-check",onChange:c,isChecked:v,label:t("on"),labelOff:t("off"),"aria-label":t("includeClients")})})]}),L&&e(st,{"data-testid":"warning-message",variant:"warning",title:t("exportWarningTitle"),isInline:!0,children:t("exportWarningDescription")})]})},_t={users:!1,clients:!1,groups:!1,identityProviders:!1,realmRoles:!1,clientRoles:!1},gl=a=>{const{t:l}=V(),{realm:t}=se(),[n,i]=f(),r=!!n,[u,o]=f(!1),[v,c]=f(!1),[p,b]=f(!1),[L,h]=f("FAIL"),[y,P]=f({}),[s,m]=f(),{addError:C}=de(),[I,N]=f(_t),R=Object.values(I).some(T=>T),k=()=>{N(_t)},D=()=>{i(void 0),P({}),h("FAIL"),k()};ye(()=>{b(!1),m(void 0),D()},[a.open]);const H=T=>{D(),i(T),Array.isArray(T)?T.length>0&&P(T[0]):P(T)},F=T=>{P(T),o(!1),k()},S=(T,j)=>{const ke=j.currentTarget.name;N({...I,[ke]:T})},U=T=>T.map(j=>e(ie,{value:j,"data-testid":j.id+"-select-option",children:j.realm||j.id},j.id)),W=(T,j)=>{h(j),c(!1)},O=()=>[e(ie,{value:"FAIL",children:l("FAIL")},"fail"),e(ie,{value:"SKIP",children:l("SKIP")},"skip"),e(ie,{value:"OVERWRITE",children:l("OVERWRITE")},"overwrite")],$=()=>J("users")||J("groups")||J("clients")||J("identityProviders")||ue()||Te(),J=T=>{const j=y[T];return j!==void 0&&j.length>0},ue=()=>{const T=y.roles?.realm;return T!==void 0&&T.length>0},Te=()=>{const T=y.roles?.client;return T!==void 0&&Object.keys(T).length>0},_=T=>r?T==="realmRoles"?y.roles?.realm?.length??0:T==="clientRoles"?Te()?Je(y.roles.client):0:y[T]?.length??0:0,Je=T=>Object.values(T).reduce((j,ke)=>j+ke.length,0),ee=(T,j)=>e(aa,{"aria-labelledby":`${T}-list-item`,children:e(la,{children:e(na,{dataListCells:[e(St,{children:e(vt,{id:`${T}-checkbox`,label:`${_(T)} ${j}`,"aria-labelledby":`${T}-checkbox`,name:T,isChecked:I[T],onChange:S,"data-testid":T+"-checkbox"})},T)]})})}),Xe=()=>{const T={ifResourceExists:L,id:y.id,realm:y.realm};return I.users&&(T.users=y.users),I.groups&&(T.groups=y.groups),I.identityProviders&&(T.identityProviders=y.identityProviders),I.clients&&(T.clients=y.clients),(I.realmRoles||I.clientRoles)&&(T.roles=y.roles,I.realmRoles||delete T.roles?.realm,I.clientRoles||delete T.roles?.client),T};async function Be(){if(!p){b(!0);try{const T=await K.realms.partialImport({realm:t,rep:Xe()});m(T)}catch(T){C("importFail",T)}b(!1)}}const tt=()=>e(Fe,{variant:$e.medium,title:l("partialImport"),isOpen:a.open,onClose:a.toggleDialog,actions:[e(A,{id:"modal-import","data-testid":"import-button",isDisabled:!R,onClick:()=>{Be()},children:l("import")},"import"),e(A,{id:"modal-cancel","data-testid":"cancel-button",variant:le.link,onClick:()=>{a.toggleDialog()},children:l("cancel")},"cancel")],children:d(Yt,{hasGutter:!0,children:[e(we,{children:e(pt,{children:e(Ke,{children:l("partialImportHeaderText")})})}),e(we,{children:e(tl,{id:"partial-import-file",allowEditingUploadedText:!0,onChange:H})}),r&&$()&&d(Z,{children:[e(we,{children:e(qe,{})}),Array.isArray(n)&&n.length>1&&d(we,{children:[d(Ke,{children:[l("selectRealm"),":"]}),e(ce,{toggleId:"realm-selector",isOpen:u,onToggle:()=>o(!u),onSelect:(T,j)=>F(j),placeholderText:y.realm||y.id,children:U(n)})]}),d(we,{children:[d(Ke,{children:[l("chooseResources"),":"]}),d(ta,{"aria-label":l("resourcesToImport"),isCompact:!0,children:[J("users")&&ee("users",l("users")),J("groups")&&ee("groups",l("groups")),J("clients")&&ee("clients",l("clients")),J("identityProviders")&&ee("identityProviders",l("identityProviders")),ue()&&ee("realmRoles",l("realmRoles")),Te()&&ee("clientRoles",l("clientRoles"))]})]}),d(we,{children:[d(Ke,{children:[l("selectIfResourceExists"),":"]}),e(ce,{isOpen:v,direction:"up",onToggle:()=>{c(!v)},onSelect:W,placeholderText:l(L),children:O()})]})]})]})}),Re=()=>`${l("importAdded",{count:s?.added})}  ${l("importSkipped",{count:s?.skipped})} ${l("importOverwritten",{count:s?.overwritten})}`,Ge=async(T=0,j=15)=>{if(!s)return[];const ke=Math.min(T+j,s.results.length);return s.results.slice(T,ke)},Ne=T=>{switch(T.action){case"ADDED":return e(nt,{color:"green",children:l("added")},T.id);case"SKIPPED":return e(nt,{color:"orange",children:l("skipped")},T.id);case"OVERWRITTEN":return e(nt,{color:"purple",children:l("overwritten")},T.id);default:return""}},ht=T=>{const j=new Map([["CLIENT",l("clients")],["REALM_ROLE",l("realmRoles")],["USER",l("users")],["CLIENT_ROLE",l("clientRoles")],["IDP",l("identityProviders")],["GROUP",l("groups")]]);return e("span",{children:j.get(T.resourceType)})},Qe=()=>d(Fe,{variant:$e.medium,title:l("partialImport"),isOpen:a.open,onClose:a.toggleDialog,actions:[e(A,{id:"modal-close","data-testid":"close-button",variant:le.primary,onClick:()=>{a.toggleDialog()},children:l("close")},"close")],children:[e(st,{variant:"success",isInline:!0,title:Re()}),e(Ue,{loader:Ge,isPaginated:!0,ariaLabelKey:"partialImport",columns:[{name:"action",displayKey:"action",cellRenderer:Ne},{name:"resourceType",displayKey:"type",cellRenderer:ht},{name:"resourceName",displayKey:"name"},{name:"id",displayKey:"id"}]})]});return s?Qe():tt()},vl=()=>{const{t:a}=V(),{addAlert:l,addError:t}=de(),{realm:n}=se(),i=We(),[r,u]=f(!1),[o,v]=f(),[c,p]=f(),[b,L]=f(0),[h,y]=f(),[P,s]=f(),m=()=>L(b+1),C=fe({mode:"onChange"});Se(()=>K.clientPolicies.listPolicies(),S=>{v(S.policies),s(S.policies||[]),y(et(S.policies))},[b]);const I=async()=>o??[],N=async()=>{const S=C.getValues(),U=o?.map(W=>{const O=S[W.name];return{...W,enabled:O}});try{await K.clientPolicies.updatePolicy({policies:U}),i(yt({realm:n,tab:"policies"})),l(a("updateClientPolicySuccess"),ae.success)}catch(W){t("updateClientPolicyError",W)}},R=({name:S})=>e(be,{to:ga({realm:n,policyName:S}),children:S}),k=({clientPolicy:S})=>{const[U,W]=me({titleKey:"disablePolicyConfirmTitle",messageKey:"disablePolicyConfirm",continueButtonLabel:"disable",onConfirm:()=>{C.setValue(S.name,!1),N()}});return d(Z,{children:[e(W,{}),e(w,{name:S.name,"data-testid":`${S.name}-switch`,defaultValue:S.enabled,control:C.control,render:({field:O})=>e(Q,{label:a("enabled"),labelOff:a("disabled"),isChecked:O.value,onChange:$=>{$?(O.onChange($),N()):U()},"aria-label":S.name})})]})},D=async()=>{if(h)try{const S=JSON.parse(h);try{await K.clientPolicies.updatePolicy({policies:S}),l(a("updateClientPoliciesSuccess"),ae.success),m()}catch(U){t("updateClientPoliciesError",U)}}catch(S){console.warn("Invalid json, ignoring value using {}"),t("updateClientPoliciesError",S)}},[H,F]=me({titleKey:a("deleteClientPolicyConfirmTitle"),messageKey:a("deleteClientPolicyConfirm",{policyName:c?.name}),continueButtonLabel:a("delete"),continueButtonVariant:le.danger,onConfirm:async()=>{const S=o?.filter(U=>U.name!==c?.name);try{await K.clientPolicies.updatePolicy({policies:S}),l(a("deleteClientPolicySuccess"),ae.success),m()}catch(U){t(a("deleteClientPolicyError"),U)}}});return o?d(Z,{children:[e(F,{}),e(te,{children:d(ia,{className:"kc-policies-config-section",children:[e(je,{children:e(Jt,{headingLevel:"h1",size:"md",children:a("policiesConfigType")})}),e(je,{children:e(rt,{isChecked:!r,name:"policiesView",onChange:()=>u(!1),label:a("policiesConfigTypes.formView"),id:"formView-policiesView","data-testid":"formView-policiesView",className:"kc-form-radio-btn pf-u-mr-sm pf-u-ml-sm"})}),e(je,{children:e(rt,{isChecked:r,name:"policiesView",onChange:()=>u(!0),label:a("policiesConfigTypes.jsonEditor"),id:"jsonEditor-policiesView","data-testid":"jsonEditor-policiesView",className:"kc-editor-radio-btn"})})]})}),e(qe,{}),r?d(Z,{children:[e("div",{className:"pf-u-mt-md pf-u-ml-lg",children:e(wt,{isLineNumbersVisible:!0,isLanguageLabelVisible:!0,isReadOnly:!1,code:h,language:At.json,height:"30rem",onChange:y})}),d("div",{className:"pf-u-mt-md",children:[e(A,{variant:le.primary,className:"pf-u-mr-md pf-u-ml-lg","data-testid":"jsonEditor-policies-saveBtn",onClick:D,children:a("save")}),e(A,{variant:le.link,"data-testid":"jsonEditor-reloadBtn",onClick:()=>{y(et(P))},children:a("reload")})]})]}):e(Ue,{emptyState:e(Ae,{message:a("noClientPolicies"),instructions:a("noClientPoliciesInstructions"),primaryActionText:a("createClientPolicy"),onPrimaryAction:()=>i(Vt({realm:n}))}),ariaLabelKey:"clientPolicies",searchPlaceholderKey:"clientPolicySearch",loader:I,toolbarItem:e(ve,{children:e(A,{id:"createPolicy",component:S=>e(be,{...S,to:Vt({realm:n})}),"data-testid":"createPolicy",children:a("createClientPolicy")})}),actions:[{title:a("delete"),onRowClick:S=>{H(),p(S)}}],columns:[{name:"name",cellRenderer:R},{name:"enabled",displayKey:"status",cellRenderer:S=>e(k,{clientPolicy:S})},{name:"description"}]},o.length)]}):e(De,{})};function yl(){const{t:a}=V(),{realm:l}=se(),{addAlert:t,addError:n}=de(),[i,r]=f(),[u,o]=f(),[v,c]=f(),[p,b]=f(!1),[L,h]=f(),[y,P]=f(0);Se(()=>K.clientPolicies.listProfiles({includeGlobalProfiles:!0}),k=>{o(k.globalProfiles);const D=k.globalProfiles?.map(S=>({...S,global:!0})),H=k.profiles?.map(S=>({...S,global:!1})),F=D?.concat(H??[]);r(F||[]),h(JSON.stringify(F,null,2))},[y]);const s=async()=>i??[],m=k=>ya(k,"global"),[C,I]=me({titleKey:a("deleteClientProfileConfirmTitle"),messageKey:a("deleteClientProfileConfirm",{profileName:v?.name}),continueButtonLabel:a("delete"),continueButtonVariant:le.danger,onConfirm:async()=>{const k=i?.filter(D=>D.name!==v?.name&&!D.global).map(D=>m(D));try{await K.clientPolicies.createProfiles({profiles:k,globalProfiles:u}),t(a("deleteClientSuccess"),ae.success),P(y+1)}catch(D){n(a("deleteClientError"),D)}}}),N=k=>d(be,{to:Ta({realm:l,profileName:k.name}),children:[k.name," ",k.global&&e(nt,{color:"blue",children:a("global")})]},k.name);if(!i)return e(De,{});const R=async()=>{if(L)try{const k=JSON.parse(L),D=k.filter(F=>!F.global).map(F=>m(F)),H=k.filter(F=>F.global).map(F=>m(F));try{await K.clientPolicies.createProfiles({profiles:D,globalProfiles:H}),t(a("updateClientProfilesSuccess"),ae.success),P(y+1)}catch(F){n("updateClientProfilesError",F)}}catch{console.warn("Invalid json, ignoring value using {}")}};return d(Z,{children:[e(I,{}),e(te,{children:d(ia,{className:"kc-profiles-config-section",children:[e(je,{children:e(Jt,{headingLevel:"h1",size:"md",children:a("profilesConfigType")})}),e(je,{children:e(rt,{isChecked:!p,name:"profilesView",onChange:()=>b(!1),label:a("profilesConfigTypes.formView"),id:"formView-profilesView",className:"kc-form-radio-btn pf-u-mr-sm pf-u-ml-sm","data-testid":"formView-profilesView"})}),e(je,{children:e(rt,{isChecked:p,name:"profilesView",onChange:()=>b(!0),label:a("profilesConfigTypes.jsonEditor"),id:"jsonEditor-profilesView",className:"kc-editor-radio-btn","data-testid":"jsonEditor-profilesView"})})]})}),e(qe,{}),p?d(g,{fieldId:"jsonEditor",children:[e("div",{className:"pf-u-mt-md pf-u-ml-lg",children:e(wt,{isLineNumbersVisible:!0,isLanguageLabelVisible:!0,isReadOnly:!1,code:L,language:At.json,height:"30rem",onChange:k=>{h(k??"")}})}),e(ge,{children:d("div",{className:"pf-u-mt-md",children:[e(A,{variant:le.primary,className:"pf-u-mr-md pf-u-ml-lg",onClick:R,"data-testid":"jsonEditor-saveBtn",children:a("save")}),e(A,{variant:le.link,onClick:()=>{h(et(i))},"data-testid":"jsonEditor-reloadBtn",children:a("reload")})]})})]}):e(Ue,{ariaLabelKey:"profiles",searchPlaceholderKey:"clientProfileSearch",loader:s,toolbarItem:e(ve,{children:e(A,{id:"createProfile",component:k=>e(be,{...k,to:va({realm:l,tab:"profiles"})}),"data-testid":"createProfile",children:a("createClientProfile")})}),isRowDisabled:k=>k.global,actions:[{title:a("delete"),onRowClick:k=>{c(k),C()}}],columns:[{name:"name",displayKey:a("name"),cellRenderer:N},{name:"description",displayKey:a("clientProfileDescription")}],emptyState:e(Ae,{message:a("emptyClientProfiles"),instructions:a("emptyClientProfilesInstructions")})},i.length)]})}const Tl=({realm:a,save:l})=>{const{t}=V(),{setValue:n,control:i,handleSubmit:r,formState:u}=fe(),o=Le({control:i,name:"offlineSessionMaxLifespanEnabled"}),v=()=>{Pe(a,n)};return ye(v,[]),d(te,{variant:"light",children:[e(oe,{title:t("SSOSessionSettings"),className:"kc-sso-session-template",children:d(Y,{isHorizontal:!0,role:"manage-realm",onSubmit:r(l),children:[e(g,{label:t("SSOSessionIdle"),fieldId:"SSOSessionIdle",labelIcon:e(E,{helpText:t("ssoSessionIdle"),fieldLabelId:"SSOSessionIdle"}),children:e(w,{name:"ssoSessionIdleTimeout",defaultValue:a.ssoSessionIdleTimeout,control:i,render:({field:c})=>e(q,{className:"kc-sso-session-idle","data-testid":"sso-session-idle-input",value:c.value,onChange:c.onChange,units:["minute","hour","day"]})})}),e(g,{label:t("SSOSessionMax"),fieldId:"SSOSessionMax",labelIcon:e(E,{helpText:t("ssoSessionMax"),fieldLabelId:"SSOSessionMax"}),children:e(w,{name:"ssoSessionMaxLifespan",control:i,render:({field:c})=>e(q,{className:"kc-sso-session-max","data-testid":"sso-session-max-input",value:c.value,onChange:c.onChange,units:["minute","hour","day"]})})}),e(g,{label:t("SSOSessionIdleRememberMe"),fieldId:"SSOSessionIdleRememberMe",labelIcon:e(E,{helpText:t("ssoSessionIdleRememberMe"),fieldLabelId:"SSOSessionIdleRememberMe"}),children:e(w,{name:"ssoSessionIdleTimeoutRememberMe",control:i,render:({field:c})=>e(q,{className:"kc-sso-session-idle-remember-me","data-testid":"sso-session-idle-remember-me-input",value:c.value,onChange:c.onChange,units:["minute","hour","day"]})})}),e(g,{label:t("SSOSessionMaxRememberMe"),fieldId:"SSOSessionMaxRememberMe",labelIcon:e(E,{helpText:t("ssoSessionMaxRememberMe"),fieldLabelId:"SSOSessionMaxRememberMe"}),children:e(w,{name:"ssoSessionMaxLifespanRememberMe",control:i,render:({field:c})=>e(q,{className:"kc-sso-session-max-remember-me","data-testid":"sso-session-max-remember-me-input",value:c.value,onChange:c.onChange,units:["minute","hour","day"]})})})]})}),e(oe,{title:t("clientSessionSettings"),className:"kc-client-session-template",children:d(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:r(l),children:[e(g,{label:t("clientSessionIdle"),fieldId:"clientSessionIdle",labelIcon:e(E,{helpText:t("clientSessionIdleHelp"),fieldLabelId:"clientSessionIdle"}),children:e(w,{name:"clientSessionIdleTimeout",control:i,render:({field:c})=>e(q,{className:"kc-client-session-idle","data-testid":"client-session-idle-input",value:c.value,onChange:c.onChange,units:["minute","hour","day"]})})}),e(g,{label:t("clientSessionMax"),fieldId:"clientSessionMax",labelIcon:e(E,{helpText:t("clientSessionMaxHelp"),fieldLabelId:"clientSessionMax"}),children:e(w,{name:"clientSessionMaxLifespan",control:i,render:({field:c})=>e(q,{className:"kc-client-session-max","data-testid":"client-session-max-input",value:c.value,onChange:c.onChange,units:["minute","hour","day"]})})})]})}),e(oe,{title:t("offlineSessionSettings"),className:"kc-offline-session-template",children:d(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:r(l),children:[e(g,{label:t("offlineSessionIdle"),fieldId:"offlineSessionIdle",labelIcon:e(E,{helpText:t("offlineSessionIdleHelp"),fieldLabelId:"offlineSessionIdle"}),children:e(w,{name:"offlineSessionIdleTimeout",control:i,render:({field:c})=>e(q,{className:"kc-offline-session-idle","data-testid":"offline-session-idle-input","aria-label":"offline-session-idle-input",value:c.value,onChange:c.onChange,units:["minute","hour","day"]})})}),e(g,{hasNoPaddingTop:!0,label:t("offlineSessionMaxLimited"),fieldId:"kc-offlineSessionMaxLimited",labelIcon:e(E,{helpText:t("offlineSessionMaxLimitedHelp"),fieldLabelId:"offlineSessionMaxLimited"}),children:e(w,{name:"offlineSessionMaxLifespanEnabled",control:i,defaultValue:!1,render:({field:c})=>e(Q,{id:"kc-offline-session-max","data-testid":"offline-session-max-switch","aria-label":t("offlineSessionMaxLimited"),label:t("enabled"),labelOff:t("disabled"),isChecked:c.value,onChange:c.onChange})})}),o&&e(g,{label:t("offlineSessionMax"),fieldId:"offlineSessionMax",id:"offline-session-max-label",labelIcon:e(E,{helpText:t("offlineSessionMaxHelp"),fieldLabelId:"offlineSessionMax"}),children:e(w,{name:"offlineSessionMaxLifespan",control:i,render:({field:c})=>e(q,{className:"kc-offline-session-max","data-testid":"offline-session-max-input",value:c.value,onChange:c.onChange,units:["minute","hour","day"]})})})]})}),e(oe,{className:"kc-login-settings-template",title:t("loginSettings"),children:d(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:r(l),children:[e(g,{label:t("loginTimeout"),id:"kc-login-timeout-label",fieldId:"offlineSessionIdle",labelIcon:e(E,{helpText:t("loginTimeoutHelp"),fieldLabelId:"loginTimeout"}),children:e(w,{name:"accessCodeLifespanLogin",control:i,render:({field:c})=>e(q,{className:"kc-login-timeout","data-testid":"login-timeout-input","aria-label":"login-timeout-input",value:c.value,onChange:c.onChange,units:["minute","hour","day"]})})}),e(g,{label:t("loginActionTimeout"),fieldId:"loginActionTimeout",id:"login-action-timeout-label",labelIcon:e(E,{helpText:t("loginActionTimeoutHelp"),fieldLabelId:"loginActionTimeout"}),children:e(w,{name:"accessCodeLifespanUserAction",control:i,render:({field:c})=>e(q,{className:"kc-login-action-timeout","data-testid":"login-action-timeout-input",value:c.value,onChange:c.onChange,units:["minute","hour","day"]})})}),d(ge,{children:[e(A,{variant:"primary",type:"submit","data-testid":"sessions-tab-save",isDisabled:!u.isDirty,children:t("save")}),e(A,{variant:"link",onClick:v,children:t("revert")})]})]})})]})},Cl=({realm:a,save:l})=>{const{t}=V(),[n,i]=f(!1),[r,u]=f(!1),[o,v]=f(!1),[c,p]=f(!1),{control:b,handleSubmit:L,setValue:h}=fe(),y=He().themes,P=()=>{Pe(a,h)};return ye(P,[]),e(te,{variant:"light",children:d(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:L(l),children:[e(g,{label:t("loginTheme"),fieldId:"kc-login-theme",labelIcon:e(E,{helpText:t("loginThemeHelp"),fieldLabelId:"loginTheme"}),children:e(w,{name:"loginTheme",control:b,defaultValue:"",render:({field:s})=>e(ce,{toggleId:"kc-login-theme",onToggle:()=>i(!n),onSelect:(m,C)=>{s.onChange(C),i(!1)},selections:s.value,variant:he.single,isOpen:n,placeholderText:t("selectATheme"),"data-testid":"select-login-theme",children:y.login.map((m,C)=>e(ie,{selected:m.name===s.value,value:m.name,children:t(`${m.name}`)},`login-theme-${C}`))})})}),e(g,{label:t("accountTheme"),fieldId:"kc-account-theme",labelIcon:e(E,{helpText:t("accountThemeHelp"),fieldLabelId:"accountTheme"}),children:e(w,{name:"accountTheme",control:b,defaultValue:"",render:({field:s})=>e(ce,{toggleId:"kc-account-theme",onToggle:()=>u(!r),onSelect:(m,C)=>{s.onChange(C),u(!1)},selections:s.value,variant:he.single,"aria-label":t("accountTheme"),isOpen:r,placeholderText:t("selectATheme"),"data-testid":"select-account-theme",children:y.account.filter(m=>m.name!=="base").map((m,C)=>e(ie,{selected:m.name===s.value,value:m.name,children:t(`${m.name}`)},`account-theme-${C}`))})})}),e(g,{label:t("adminTheme"),fieldId:"kc-admin-ui-theme",labelIcon:e(E,{helpText:t("adminThemeHelp"),fieldLabelId:"adminTheme"}),children:e(w,{name:"adminTheme",control:b,defaultValue:"",render:({field:s})=>e(ce,{toggleId:"kc-admin-ui-theme",onToggle:()=>v(!o),onSelect:(m,C)=>{s.onChange(C),v(!1)},selections:s.value,variant:he.single,isOpen:o,placeholderText:t("selectATheme"),"data-testid":"select-admin-theme",children:y.admin.filter(m=>m.name!=="base").map((m,C)=>e(ie,{selected:m.name===s.value,value:m.name,children:t(`${m.name}`)},`admin-theme-${C}`))})})}),e(g,{label:t("emailTheme"),fieldId:"kc-email-theme",labelIcon:e(E,{helpText:t("emailThemeHelp"),fieldLabelId:"emailTheme"}),children:e(w,{name:"emailTheme",control:b,defaultValue:"",render:({field:s})=>e(ce,{toggleId:"kc-email-theme",onToggle:()=>p(!c),onSelect:(m,C)=>{s.onChange(C),p(!1)},selections:s.value,variant:he.single,isOpen:c,placeholderText:t("selectATheme"),"data-testid":"select-email-theme",children:y.email.map((m,C)=>e(ie,{selected:m.name===s.value,value:m.name,children:t(`${m.name}`)},`email-theme-${C}`))})})}),d(ge,{children:[e(A,{variant:"primary",type:"submit","data-testid":"themes-tab-save",children:t("save")}),e(A,{variant:"link",onClick:P,children:t("revert")})]})]})})},Sl=({realm:a,reset:l,save:t})=>{const{t:n}=V(),i=He(),r=Et(),{whoAmI:u}=It(),[o,v]=f(!1),c=Ca(i.providers.signature.providers),p=fe(),{setValue:b,control:L}=p,h=Le({control:L,name:"offlineSessionMaxLifespanEnabled",defaultValue:a.offlineSessionMaxLifespanEnabled}),y=Le({control:L,name:"ssoSessionIdleTimeout",defaultValue:36e3}),P=Le({control:L,name:"revokeRefreshToken",defaultValue:!1});return ye(()=>{Pe(a,b)},[]),d(te,{variant:"light",children:[e(oe,{title:n("general"),className:"kc-sso-session-template",children:d(Y,{isHorizontal:!0,role:"manage-realm",onSubmit:p.handleSubmit(t),children:[e(g,{label:n("defaultSigAlg"),fieldId:"kc-default-signature-algorithm",labelIcon:e(E,{helpText:n("defaultSigAlgHelp"),fieldLabelId:"algorithm"}),children:e(w,{name:"defaultSignatureAlgorithm",defaultValue:"RS256",control:p.control,render:({field:s})=>e(ce,{toggleId:"kc-default-sig-alg",onToggle:()=>v(!o),onSelect:(m,C)=>{s.onChange(C.toString()),v(!1)},selections:[s.value?.toString()],variant:he.single,"aria-label":n("defaultSigAlg"),isOpen:o,"data-testid":"select-default-sig-alg",children:c.map((m,C)=>e(ie,{selected:m===s.value,value:m},`default-sig-alg-${C}`))})})}),r(dt.DeviceFlow)&&d(Z,{children:[e(g,{label:n("oAuthDeviceCodeLifespan"),fieldId:"oAuthDeviceCodeLifespan",labelIcon:e(E,{helpText:n("oAuthDeviceCodeLifespanHelp"),fieldLabelId:"oAuthDeviceCodeLifespan"}),children:e(w,{name:"oauth2DeviceCodeLifespan",defaultValue:0,control:p.control,render:({field:s})=>e(q,{id:"oAuthDeviceCodeLifespan","data-testid":"oAuthDeviceCodeLifespan",value:s.value||0,onChange:s.onChange,units:["minute","hour","day"]})})}),e(g,{label:n("oAuthDevicePollingInterval"),fieldId:"oAuthDevicePollingInterval",labelIcon:e(E,{helpText:n("oAuthDevicePollingIntervalHelp"),fieldLabelId:"oAuthDevicePollingInterval"}),children:e(w,{name:"oauth2DevicePollingInterval",defaultValue:0,control:p.control,render:({field:s})=>e(ut,{id:"oAuthDevicePollingInterval",value:s.value,min:0,onPlus:()=>s.onChange(s.value||0+1),onMinus:()=>s.onChange(s.value||0-1),onChange:m=>{const C=Number(m.currentTarget.value);s.onChange(isNaN(C)?0:C)},placeholder:n("oAuthDevicePollingInterval")})})}),e(g,{label:n("shortVerificationUri"),fieldId:"shortVerificationUri",labelIcon:e(E,{helpText:n("shortVerificationUriTooltipHelp"),fieldLabelId:"shortVerificationUri"}),children:e(re,{id:"shortVerificationUri",placeholder:n("shortVerificationUri"),...p.register("attributes.shortVerificationUri")})})]})]})}),e(oe,{title:n("refreshTokens"),className:"kc-client-session-template",children:d(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:p.handleSubmit(t),children:[e(g,{hasNoPaddingTop:!0,label:n("revokeRefreshToken"),fieldId:"kc-revoke-refresh-token",labelIcon:e(E,{helpText:n("revokeRefreshTokenHelp"),fieldLabelId:"revokeRefreshToken"}),children:e(w,{name:"revokeRefreshToken",control:p.control,defaultValue:!1,render:({field:s})=>e(Q,{id:"kc-revoke-refresh-token","data-testid":"revoke-refresh-token-switch","aria-label":n("revokeRefreshToken"),label:n("enabled"),labelOff:n("disabled"),isChecked:s.value,onChange:s.onChange})})}),P&&e(g,{label:n("refreshTokenMaxReuse"),labelIcon:e(E,{helpText:n("refreshTokenMaxReuseHelp"),fieldLabelId:"refreshTokenMaxReuse"}),fieldId:"refreshTokenMaxReuse",children:e(w,{name:"refreshTokenMaxReuse",defaultValue:0,control:p.control,render:({field:s})=>e(ut,{type:"text",id:"refreshTokenMaxReuseMs",value:s.value,onPlus:()=>s.onChange(s.value+1),onMinus:()=>s.onChange(s.value-1),onChange:m=>s.onChange(Number(m.target.value))})})})]})}),e(oe,{title:n("accessTokens"),className:"kc-offline-session-template",children:d(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:p.handleSubmit(t),children:[e(g,{label:n("accessTokenLifespan"),fieldId:"accessTokenLifespan",helperText:n("recommendedSsoTimeout",{time:al(y,u.getLocale())}),labelIcon:e(E,{helpText:n("accessTokenLifespanHelp"),fieldLabelId:"accessTokenLifespan"}),children:e(w,{name:"accessTokenLifespan",control:p.control,render:({field:s})=>e(q,{validated:s.value>y?"warning":"default",className:"kc-access-token-lifespan","data-testid":"access-token-lifespan-input","aria-label":"access-token-lifespan",value:s.value,onChange:s.onChange,units:["minute","hour","day"]})})}),e(g,{label:n("accessTokenLifespanImplicitFlow"),fieldId:"accessTokenLifespanImplicitFlow",labelIcon:e(E,{helpText:n("accessTokenLifespanImplicitFlow"),fieldLabelId:"accessTokenLifespanImplicitFlow"}),children:e(w,{name:"accessTokenLifespanForImplicitFlow",control:p.control,render:({field:s})=>e(q,{className:"kc-access-token-lifespan-implicit","data-testid":"access-token-lifespan-implicit-input",value:s.value,onChange:s.onChange,units:["minute","hour","day"]})})}),e(g,{label:n("clientLoginTimeout"),fieldId:"clientLoginTimeout",labelIcon:e(E,{helpText:n("clientLoginTimeoutHelp"),fieldLabelId:"clientLoginTimeout"}),children:e(w,{name:"accessCodeLifespan",control:p.control,render:({field:s})=>e(q,{className:"kc-client-login-timeout","data-testid":"client-login-timeout-input","aria-label":"client-login-timeout",value:s.value,onChange:s.onChange,units:["minute","hour","day"]})})}),h&&e(g,{label:n("offlineSessionMax"),fieldId:"offlineSessionMax",id:"offline-session-max-label",labelIcon:e(E,{helpText:n("offlineSessionMaxHelp"),fieldLabelId:"offlineSessionMax"}),children:e(w,{name:"offlineSessionMaxLifespan",control:p.control,render:({field:s})=>e(q,{className:"kc-offline-session-max","data-testid":"offline-session-max-input",value:s.value,onChange:s.onChange,units:["minute","hour","day"]})})})]})}),e(oe,{className:"kc-login-settings-template",title:n("actionTokens"),children:d(Y,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:p.handleSubmit(t),children:[e(g,{label:n("userInitiatedActionLifespan"),id:"kc-user-initiated-action-lifespan",fieldId:"userInitiatedActionLifespan",labelIcon:e(E,{helpText:n("userInitiatedActionLifespanHelp"),fieldLabelId:"userInitiatedActionLifespan"}),children:e(w,{name:"actionTokenGeneratedByUserLifespan",control:p.control,render:({field:s})=>e(q,{className:"kc-user-initiated-action-lifespan","data-testid":"user-initiated-action-lifespan","aria-label":"user-initiated-action-lifespan",value:s.value,onChange:s.onChange,units:["minute","hour","day"]})})}),e(g,{label:n("defaultAdminInitiated"),fieldId:"defaultAdminInitiated",id:"default-admin-initiated-label",labelIcon:e(E,{helpText:n("defaultAdminInitiatedActionLifespanHelp"),fieldLabelId:"defaultAdminInitiated"}),children:e(w,{name:"actionTokenGeneratedByAdminLifespan",control:p.control,render:({field:s})=>e(q,{className:"kc-default-admin-initiated","data-testid":"default-admin-initated-input","aria-label":"default-admin-initated-input",value:s.value,onChange:s.onChange,units:["minute","hour","day"]})})}),e(Ke,{className:"kc-override-action-tokens-subtitle",component:Sa.h1,children:n("overrideActionTokens")}),e(g,{label:n("emailVerification"),fieldId:"emailVerification",id:"email-verification",children:e(w,{name:"attributes.actionTokenGeneratedByUserLifespan-verify-email",defaultValue:"",control:p.control,render:({field:s})=>e(q,{className:"kc-email-verification","data-testid":"email-verification-input",value:s.value,onChange:m=>s.onChange(m.toString()),units:["minute","hour","day"]})})}),e(g,{label:n("idpAccountEmailVerification"),fieldId:"idpAccountEmailVerification",id:"idp-acct-label",children:e(w,{name:"attributes.actionTokenGeneratedByUserLifespan-idp-verify-account-via-email",defaultValue:"",control:p.control,render:({field:s})=>e(q,{className:"kc-idp-email-verification","data-testid":"idp-email-verification-input",value:s.value,onChange:s.onChange,units:["minute","hour","day"]})})}),e(g,{label:n("forgotPassword"),fieldId:"forgotPassword",id:"forgot-password-label",children:e(w,{name:"attributes.actionTokenGeneratedByUserLifespan-reset-credentials",defaultValue:"",control:p.control,render:({field:s})=>e(q,{className:"kc-forgot-pw","data-testid":"forgot-pw-input",value:s.value,onChange:s.onChange,units:["minute","hour","day"]})})}),e(g,{label:n("executeActions"),fieldId:"executeActions",id:"execute-actions",children:e(w,{name:"attributes.actionTokenGeneratedByUserLifespan-execute-actions",defaultValue:"",control:p.control,render:({field:s})=>e(q,{className:"kc-execute-actions","data-testid":"execute-actions-input",value:s.value,onChange:s.onChange,units:["minute","hour","day"]})})}),d(ge,{children:[e(A,{variant:"primary",type:"submit","data-testid":"tokens-tab-save",isDisabled:!p.formState.isDirty,children:n("save")}),e(A,{variant:"link",onClick:l,children:n("revert")})]})]})})]})},kl=()=>{const{t:a}=V(),[l,t]=Ve(),[n,i]=Ve(),[r,u]=f(),[o,v]=f([]),[c,p]=f(0),[b,L]=f(0),h=()=>L(b+1),{realm:y}=se(),{addAlert:P,addError:s}=de(),{enabled:m}=ka();Se(()=>K.realms.getDefaultGroups({realm:y}),D=>{u(D),p(c+1)},[b]);const C=()=>Promise.resolve(r),I=async()=>{try{await Promise.all(o.map(D=>K.realms.removeDefaultGroup({realm:y,id:D.id}))),P(a("groupRemove",{count:o.length}),ae.success),v([])}catch(D){s("groupRemoveError",D)}h()},N=async D=>{try{await Promise.all(D.map(H=>K.realms.addDefaultGroup({realm:y,id:H.id}))),P(a("defaultGroupAdded",{count:D.length}),ae.success)}catch(H){s("defaultGroupAddedError",H)}h()},[R,k]=me({titleKey:a("removeConfirmTitle",{count:o.length}),messageKey:a("removeConfirm",{count:o.length}),continueButtonLabel:"delete",continueButtonVariant:le.danger,onConfirm:I});return r?d(Z,{children:[e(k,{}),n&&e(nl,{type:"selectMany",text:{title:"addDefaultGroups",ok:"add"},onConfirm:D=>{N(D||[]),i()},onClose:i}),m&&e(Ia,{bodyContent:d(mt,{i18nKey:"defaultGroups",children:[" ",e(be,{to:Ft({realm:y})}),"."]}),children:e(pt,{className:"keycloak__section_intro__help",style:{paddingLeft:"var(--pf-c-page__main-section--PaddingLeft)"},children:d(Ke,{children:[e(il,{})," ",a("whatIsDefaultGroups")]})})}),e(Ue,{canSelectAll:!0,onSelect:D=>v([...D]),loader:C,ariaLabelKey:"defaultGroups",searchPlaceholderKey:"searchForGroups",toolbarItem:d(Z,{children:[e(ve,{children:e(A,{"data-testid":"openCreateGroupModal",variant:"primary",onClick:i,children:a("addGroups")})}),e(ve,{children:e(La,{toggle:e(Pa,{onToggle:t,isDisabled:o.length===0}),isOpen:l,isPlain:!0,dropdownItems:[e(it,{component:"button",onClick:()=>{R(),t()},children:a("remove")},"action")]})})]}),actions:[{title:a("remove"),onRowClick:D=>(v([D]),R(),Promise.resolve(!1))}],columns:[{name:"name",displayKey:"groupName"},{name:"path",displayKey:"path"}],emptyState:e(Ae,{hasIcon:!0,message:a("noDefaultGroups"),instructions:d(mt,{i18nKey:"noDefaultGroupsInstructions",children:[" ",e(be,{className:"pf-u-font-weight-light",to:Ft({realm:y})}),"Add groups..."]}),primaryActionText:a("addGroups"),onPrimaryAction:i})},c)]}):e(De,{})},Il=()=>{const{t:a}=V(),[l,t]=f(),[n,i]=f(10),[r,u]=f(0),{addAlert:o,addError:v}=de(),{realm:c}=se();if(Se(()=>K.realms.findOne({realm:c}),t,[]),!l)return e(De,{});const p=async b=>{const L=b;try{await K.roles.createComposite({roleId:l.defaultRole.id,realm:c},L),u(r+1),o(a("addAssociatedRolesSuccess"),ae.success)}catch(h){v("addAssociatedRolesError",h)}};return d(Dt,{activeKey:n,onSelect:(b,L)=>i(L),children:[e(B,{id:"roles",eventKey:10,title:e(G,{children:a("defaultRoles")}),children:e(ll,{name:l.defaultRole.name,id:l.defaultRole.id,type:"roles",isManager:!0,save:b=>p(b.map(L=>L.role))})},r),e(B,{id:"groups",eventKey:20,title:e(G,{children:a("defaultGroups")}),children:e(kl,{})})]})};function oa({ariaLabelKey:a="userEventsRegistered",eventTypes:l,addTypes:t,onSelect:n,onDelete:i}){const{t:r}=V(),u=l.map(o=>({id:o,name:r(`eventTypes.${o}.name`),description:r(`eventTypes.${o}.description`)}));return e(Ue,{ariaLabelKey:a,searchPlaceholderKey:"searchEventType",loader:u,onSelect:n||void 0,canSelectAll:!!n,toolbarItem:t&&e(ve,{children:e(A,{id:"addTypes",onClick:t,"data-testid":"addTypes",children:r("addSavedTypes")})}),actions:i?[{title:r("remove"),onRowClick:i}]:[],columns:[{name:"name",displayKey:"eventType"},{name:"description",displayKey:"description"}],emptyState:e(Ae,{message:r("emptyEvents"),instructions:r("emptyEventsInstructions")})})}const Ll=({onConfirm:a,onClose:l,configured:t})=>{const{t:n}=V(),{enums:i}=He(),[r,u]=f([]);return e(Fe,{variant:$e.medium,title:n("addTypes"),isOpen:!0,onClose:l,actions:[e(A,{"data-testid":"addEventTypeConfirm",variant:"primary",onClick:()=>a(r),children:n("add")},"confirm"),e(A,{"data-testid":"moveCancel",variant:"link",onClick:l,children:n("cancel")},"cancel")],children:e(oa,{ariaLabelKey:"addTypes",onSelect:o=>u(o),eventTypes:i.eventType.filter(o=>!t.includes(o))})})},jt=({type:a,form:l,reset:t,clear:n})=>{const{t:i}=V(),{control:r,watch:u,setValue:o,formState:{isDirty:v}}=l,c=a==="admin"?"adminEventsEnabled":"eventsEnabled",p=u(c),[b,L]=me({titleKey:"events-disable-title",messageKey:"events-disable-confirm",continueButtonLabel:"confirm",onConfirm:()=>o(c,!1,{shouldDirty:!0})});return d(Z,{children:[e(L,{}),e(g,{hasNoPaddingTop:!0,label:i("saveEvents"),fieldId:c,labelIcon:e(E,{helpText:i(`save-${a}-eventsHelp`),fieldLabelId:"saveEvents"}),children:e(w,{name:c,defaultValue:!1,control:r,render:({field:h})=>e(Q,{"data-testid":c,id:`${c}-switch`,label:i("on"),labelOff:i("off"),isChecked:h.value,onChange:y=>{y?h.onChange(y):b()},"aria-label":i("saveEvents")})})}),p&&d(Z,{children:[a==="admin"&&e(g,{hasNoPaddingTop:!0,label:i("includeRepresentation"),fieldId:"includeRepresentation",labelIcon:e(E,{helpText:i("includeRepresentationHelp"),fieldLabelId:"includeRepresentation"}),children:e(w,{name:"adminEventsDetailsEnabled",defaultValue:!1,control:r,render:({field:h})=>e(Q,{"data-testid":"includeRepresentation",id:"includeRepresentation",label:i("on"),labelOff:i("off"),isChecked:h.value,onChange:h.onChange,"aria-label":i("includeRepresentation")})})}),e(g,{label:i("expiration"),fieldId:"expiration",labelIcon:e(E,{helpText:i("expirationHelp"),fieldLabelId:"expiration"}),children:e(w,{name:a==="user"?"eventsExpiration":"adminEventsExpiration",defaultValue:"",control:r,render:({field:h})=>e(q,{value:h.value,onChange:h.onChange,units:["minute","hour","day"]})})})]}),d(ge,{children:[e(A,{variant:"primary",type:"submit",id:`save-${a}`,"data-testid":`save-${a}`,isDisabled:!v,children:i("save")}),e(A,{variant:"link",onClick:t,children:i("revert")})]}),e(qe,{}),e(g,{label:i(a==="user"?"clearUserEvents":"clearAdminEvents"),fieldId:`clear-${a}-events`,labelIcon:e(E,{helpText:i(`${a}-clearEventsHelp`),fieldLabelId:`clear-${a}-events`}),children:e(A,{variant:"danger",id:`clear-${a}-events`,"data-testid":`clear-${a}-events`,onClick:()=>n(),children:i(a==="user"?"clearUserEvents":"clearAdminEvents")})})]})},Pl=({form:a,reset:l})=>{const{t}=V(),{control:n,formState:{isDirty:i}}=a,[r,u]=f(!1),v=He().providers?.eventsListener.providers;return d(Z,{children:[e(g,{hasNoPaddingTop:!0,label:t("eventListeners"),fieldId:"kc-eventListeners",labelIcon:e(E,{helpText:t("eventListenersHelpTextHelp"),fieldLabelId:"eventListeners"}),children:e(w,{name:"eventsListeners",defaultValue:"",control:n,render:({field:c})=>e(ce,{name:"eventsListeners",className:"kc_eventListeners_select","data-testid":"eventListeners-select",chipGroupProps:{numChips:3,expandedText:t("hide"),collapsedText:t("showRemaining")},variant:he.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:p=>u(p),selections:c.value,onSelect:(p,b)=>{const L=b.toString(),h=c.value.includes(L)?c.value.filter(y=>y!==L):[...c.value,L];c.onChange(h)},onClear:p=>{p.stopPropagation(),c.onChange([])},isOpen:r,"aria-labelledby":"eventsListeners",children:Object.keys(v).map(p=>e(ie,{value:p},p))})})}),d(ge,{children:[e(A,{variant:"primary",type:"submit","data-testid":"saveEventListenerBtn",isDisabled:!i,children:t("save")}),e(A,{variant:"link","data-testid":"revertEventListenerBtn",onClick:l,children:t("revert")})]})]})},El=({realm:a})=>{const{t:l}=V(),t=fe(),{setValue:n,handleSubmit:i}=t,[r,u]=f(0),o=()=>u(new Date().getTime()),[v,c]=f(0),p=()=>c(new Date().getTime()),[b,L]=f("event"),[h,y]=f(),[P,s]=f(),[m,C]=f(!1),{addAlert:I,addError:N}=de(),{realm:R}=se(),k=O=>{y(O),Pe(O||{},n)},D=async O=>{s(O),H()},[H,F]=me({titleKey:"deleteEvents",messageKey:"deleteEventsConfirm",continueButtonLabel:"clear",continueButtonVariant:le.danger,onConfirm:async()=>{try{switch(P){case"admin":await K.realms.clearAdminEvents({realm:R});break;case"user":await K.realms.clearEvents({realm:R});break}I(l(`${P}-events-cleared`),ae.success)}catch(O){N(`${P}-events-cleared-error`,O)}}});Se(()=>K.realms.getConfigEvents({realm:R}),O=>{k({...O,adminEventsExpiration:a.attributes?.adminEventsExpiration}),p()},[r]);const S=async O=>{const $=!Zt(h?.eventsListeners,O.eventsListeners),{adminEventsExpiration:J,...ue}=O;a.attributes?.adminEventsExpiration!==J&&await K.realms.update({realm:R},{...a,attributes:{...a.attributes||{},adminEventsExpiration:J}});try{await K.realms.updateConfigEvents({realm:R},ue),k({...h,...ue,adminEventsExpiration:J}),I(l($?"saveEventListenersSuccess":"eventConfigSuccessfully"),ae.success)}catch(Te){N(l($?"saveEventListenersError":"eventConfigError"),Te)}},U=async O=>{const $=O.map(ue=>ue.id),J=h.enabledEventTypes?.concat($);await W(J)},W=async(O=[])=>{const $={...t.getValues(),enabledEventTypes:O};await S($),C(!1),o()};return d(Z,{children:[e(F,{}),m&&e(Ll,{onConfirm:O=>U(O),configured:h?.enabledEventTypes||[],onClose:()=>C(!1)}),d(Dt,{activeKey:b,onSelect:(O,$)=>L($),children:[e(B,{eventKey:"event",title:e(G,{children:l("eventListeners")}),"data-testid":"rs-event-listeners-tab",children:e(te,{children:e(Y,{role:"manage-events",isHorizontal:!0,onSubmit:i(S),children:e(Pl,{form:t,reset:()=>k(h)})})})}),d(B,{eventKey:"user",title:e(G,{children:l("userEventsSettings")}),"data-testid":"rs-events-tab",children:[e(te,{children:e(Y,{role:"manage-events",isHorizontal:!0,onSubmit:i(S),children:e(jt,{type:"user",form:t,reset:()=>k(h),clear:()=>D("user")})})}),e(te,{children:e(oa,{addTypes:()=>C(!0),eventTypes:h?.enabledEventTypes||[],onDelete:O=>{const $=h?.enabledEventTypes?.filter(J=>J!==O.id);W($),y({...h,enabledEventTypes:$})}},v)})]}),e(B,{eventKey:"admin",title:e(G,{children:l("adminEventsSettings")}),"data-testid":"rs-admin-events-tab",children:e(te,{children:e(Y,{role:"manage-events",isHorizontal:!0,onSubmit:i(S),children:e(jt,{type:"admin",form:t,reset:()=>k(h),clear:()=>D("admin")})})})})]})]})},Ze=["ACTIVE","PASSIVE","DISABLED"],xl=({onFilter:a})=>{const{t:l}=V(),[t,n]=f(Ze[0]),[i,r]=Ve();return e(ce,{width:300,"data-testid":"filter-type-select",isOpen:i,className:"kc-filter-type-select",variant:he.single,onToggle:r,toggleIcon:e(sa,{}),onSelect:(u,o)=>{const v=Ze.find(c=>c===o.toString())||Ze[0];n(v),a(v),r()},selections:t,children:Ze.map(u=>e(ie,{"data-testid":`${u}-option`,value:u,children:l(`keysFilter.${u}`)},u))})},wl=({realmComponents:a})=>{const{t:l}=V(),t=We(),n=sl(),[i,r]=f(""),[u,o]=f(""),{realm:v}=se(),[c,p]=f(),[b,L]=f();Se(async()=>(await K.realms.getKeys({realm:v})).keys?.map(C=>{const I=a.find(N=>N.id===C.providerId);return{...C,provider:I?.name}}),p,[]);const[h,y]=me({titleKey:l("publicKeys").slice(0,-1),messageKey:i,continueButtonLabel:"close",continueButtonVariant:le.primary,onConfirm:()=>Promise.resolve()}),[P,s]=me({titleKey:l("certificate"),messageKey:u,continueButtonLabel:"close",continueButtonVariant:le.primary,onConfirm:()=>Promise.resolve()});return c?d(te,{variant:"light",padding:{default:"noPadding"},children:[e(y,{}),e(s,{}),e(Ue,{isNotCompact:!0,className:"kc-keys-list",loader:b||c,ariaLabelKey:"keysList",searchPlaceholderKey:"searchKey",searchTypeComponent:e(xl,{onFilter:m=>L(m!==Ze[0]?c.filter(({status:C})=>C===m):void 0)}),canSelectAll:!0,columns:[{name:"algorithm",displayKey:"algorithm",cellFormatters:[_e()],transforms:[Me(15)]},{name:"type",displayKey:"type",cellFormatters:[_e()],transforms:[Me(10)]},{name:"kid",displayKey:"kid",cellFormatters:[_e()],transforms:[Me(10)]},{name:"use",displayKey:"use",cellFormatters:[_e()],transforms:[Me(10)]},{name:"provider",displayKey:"provider",cellRenderer:({provider:m})=>m||"",cellFormatters:[_e()],transforms:[Me(10)]},{name:"validTo",displayKey:"validTo",cellRenderer:({validTo:m})=>m?n(new Date(m)):"",cellFormatters:[_e()],transforms:[Me(10)]},{name:"publicKeys",displayKey:"publicKeys",cellRenderer:({type:m,publicKey:C,certificate:I})=>m==="EC"?e(A,{onClick:()=>{h(),r(C)},variant:"secondary",id:"kc-public-key",children:l("publicKeys").slice(0,-1)}):m==="RSA"?d("div",{className:"button-wrapper",children:[e(A,{onClick:()=>{h(),r(C)},variant:"secondary",id:C,children:l("publicKeys").slice(0,-1)}),e(A,{onClick:()=>{P(),o(I)},variant:"secondary",id:I,className:"kc-certificate",children:l("certificate")})]}):"",cellFormatters:[],transforms:[Me(20)]}],isSearching:!!b,emptyState:e(Ae,{hasIcon:!0,message:l("noKeys"),instructions:l("noKeysDescription"),primaryActionText:l("addProvider"),onPrimaryAction:()=>t(Tt({realm:v,tab:"providers"}))})})]}):e(De,{})},Al=({providerType:a,onClose:l})=>{const{t}=V();return e(Fe,{className:"add-provider-modal",variant:$e.medium,title:t("addProvider"),isOpen:!0,onClose:l,children:e(rl,{providerType:a,onClose:l})})},Dl=({onConfirm:a,onClose:l})=>{const{t}=V(),i=He().componentTypes?.[Pt]??[];return e(Fe,{variant:"medium",title:t("addProvider"),isOpen:!0,onClose:l,children:e(ta,{onSelectDataListItem:r=>{a(r)},"aria-label":t("addPredefinedMappers"),isCompact:!0,children:i.map(r=>e(aa,{"aria-label":r.id,id:r.id,children:e(la,{children:e(na,{dataListCells:[e(St,{"data-testid":`option-${r.id}`,children:r.id},`name-${r.id}`),e(St,{width:2,children:r.helpText},`helpText-${r.helpText}`)]})})},r.id))})})},Rl=({realmComponents:a,refresh:l})=>{const{t}=V(),{addAlert:n,addError:i}=de(),{realm:r}=se(),[u,o]=f(""),[v,c]=f([]),[p,b]=Ve(),h=He().componentTypes?.[Pt]??[],[y,P]=Ve(),[s,m]=f(),[C,I]=f(),N=$t(()=>a.map(S=>{const U=h.find(W=>S.providerId===W.id);return{...S,providerDescription:U?.helpText}}),[a]),[R,k]=me({titleKey:"deleteProviderTitle",messageKey:t("deleteProviderConfirm",{provider:C?.name}),continueButtonLabel:"delete",continueButtonVariant:le.danger,onConfirm:async()=>{try{await K.components.del({id:C.id,realm:r}),l(),n(t("deleteProviderSuccess"),ae.success)}catch(S){i("deleteProviderError",S)}}}),D=()=>{if(u!==""){o(u);const S=N.filter(U=>U.name?.includes(u)||U.providerId?.includes(u));c(S)}else o(""),c(N)},H=S=>{S.key==="Enter"&&D()},F=S=>{o(S)};return d(Z,{children:[y&&e(Dl,{onClose:()=>P(),onConfirm:S=>{b(),m(S),P()}}),p&&s&&e(Al,{providerType:s,onClose:()=>{b(),l()}}),e(k,{}),d(te,{variant:"light",padding:{default:"noPadding"},children:[e(ea,{children:d(Xa,{className:"providers-toolbar",children:[e(ve,{children:d(Ea,{children:[e(qt,{name:"inputGroupName",id:"inputGroupName","data-testid":"provider-search-input",type:"search","aria-label":t("search"),placeholder:t("search"),onChange:F,onKeyDown:H}),e(A,{variant:le.control,"aria-label":t("search"),onClick:D,children:e(Wt,{})})]})}),e(ve,{children:e(A,{"data-testid":"addProviderDropdown",className:"add-provider-dropdown",onClick:()=>P(),children:t("addProvider")})})]})}),e(ra,{variant:"compact",className:"kc-draggable-table",keyField:"id",data:v.length===0?N:v,onDragFinish:async(S,U)=>{const W=N.map(O=>{const $={...O};return delete $.providerDescription,K.components.update({id:O.id},{...$,config:{priority:[(U.length-U.indexOf(O.id)+100).toString()]}})});try{await Promise.all(W),l(),n(t("saveProviderListSuccess"),ae.success)}catch(O){i("saveProviderError",O)}},columns:[{name:"name",displayKey:"name",cellRenderer:S=>e(be,{"data-testid":"provider-name-link",to:xa({realm:r,id:S.id,providerType:S.providerId}),children:S.name},S.name)},{name:"providerId",displayKey:"provider"},{name:"providerDescription",displayKey:"providerDescription"}],actions:[{title:t("delete"),onClick:(S,U,W)=>{I(W),R()}}]})]})]})},Nl=a=>[...a].sort((t,n)=>{const i=Number(t.config?.priority),r=Number(n.config?.priority);return(isNaN(r)?0:r)-(isNaN(i)?0:i)}),Ol=()=>{const{t:a}=V(),{realm:l}=se(),[t,n]=f(),[i,r]=f(0),u=()=>{r(i+1)};Se(()=>K.components.find({type:Pt,realm:l}),p=>n(Nl(p)),[i]);const o=p=>ct(Tt({realm:l,tab:p})),v=o("list"),c=o("providers");return t?d(ot,{mountOnEnter:!0,unmountOnExit:!0,defaultLocation:Tt({realm:l,tab:"list"}),children:[e(B,{id:"keysList","data-testid":"rs-keys-list-tab","aria-label":"keys-list-subtab",title:e(G,{children:a("keysList")}),...v,children:e(wl,{realmComponents:t})}),e(B,{id:"providers","data-testid":"rs-providers-tab","aria-label":"rs-providers-tab",title:e(G,{children:a("providers")}),...c,children:e(Rl,{realmComponents:t,refresh:u})})]}):e(De,{})},xe=({fieldName:a,url:l})=>{const{t}=V(),{register:n}=Xt(),i=a.substr(a.indexOf(".")+1);return e(g,{label:t(i),fieldId:i,labelIcon:e(E,{helpText:d(mt,{i18nKey:`${i}Help`,children:["Default value prevents pages from being included",e(Ct,{href:l,title:t("learnMore")})]}),fieldLabelId:i}),children:e(re,{id:i,...n(a)})})},Ml=({realm:a,save:l})=>{const{t}=V(),n=fe(),{setValue:i,formState:{isDirty:r},handleSubmit:u}=n,o=()=>Pe(a,i);return ye(o,[]),e(Lt,{...n,children:d(Y,{isHorizontal:!0,role:"manage-realm",className:"keycloak__security-defences__form",onSubmit:u(l),children:[e(xe,{fieldName:"browserSecurityHeaders.xFrameOptions",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options"}),e(xe,{fieldName:"browserSecurityHeaders.contentSecurityPolicy",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy"}),e(xe,{fieldName:"browserSecurityHeaders.contentSecurityPolicyReportOnly",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy-Report-Only"}),e(xe,{fieldName:"browserSecurityHeaders.xContentTypeOptions",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options"}),e(xe,{fieldName:"browserSecurityHeaders.xRobotsTag",url:"https://developers.google.com/search/docs/advanced/robots/robots_meta_tag"}),e(xe,{fieldName:"browserSecurityHeaders.xXSSProtection",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection"}),e(xe,{fieldName:"browserSecurityHeaders.strictTransportSecurity",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security"}),e(xe,{fieldName:"browserSecurityHeaders.referrerPolicy",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy"}),d(ge,{children:[e(A,{variant:"primary",type:"submit","data-testid":"headers-form-tab-save",isDisabled:!r,children:t("save")}),e(A,{variant:"link",onClick:o,children:t("revert")})]})]})})},lt=({name:a,style:l})=>{const{t}=V(),{control:n,formState:{errors:i}}=Xt();return e(g,{style:l,label:t(a),fieldId:a,labelIcon:e(E,{helpText:t(`${a}Help`),fieldLabelId:a}),validated:i[a]?pe.error:pe.default,helperTextInvalid:t("required"),children:e(w,{name:a,defaultValue:"",control:n,rules:{required:!0},render:({field:r})=>e(q,{"data-testid":a,value:r.value,onChange:r.onChange,validated:i[a]?pe.error:pe.default})})})},Kl=({realm:a,save:l})=>{const{t}=V(),n=fe(),{setValue:i,handleSubmit:r,control:u,formState:{isDirty:o}}=n,v=Le({control:u,name:"bruteForceProtected"}),c=Le({control:u,name:"permanentLockout"}),p=()=>Pe(a,i);return ye(p,[]),e(Lt,{...n,children:d(Y,{role:"manage-realm",isHorizontal:!0,onSubmit:r(l),children:[e(g,{label:t("enabled"),fieldId:"bruteForceProtected",hasNoPaddingTop:!0,children:e(w,{name:"bruteForceProtected",defaultValue:!1,control:u,render:({field:b})=>e(Q,{id:"bruteForceProtected",label:t("on"),labelOff:t("off"),isChecked:b.value,onChange:b.onChange})})}),v&&d(Z,{children:[e(g,{label:t("failureFactor"),labelIcon:e(E,{helpText:t("failureFactorHelp"),fieldLabelId:"failureFactor"}),fieldId:"failureFactor",children:e(w,{name:"failureFactor",defaultValue:0,control:u,rules:{required:!0},render:({field:b})=>e(ut,{type:"text",id:"failureFactor",value:b.value,onPlus:()=>b.onChange(b.value+1),onMinus:()=>b.onChange(b.value-1),onChange:L=>b.onChange(Number(L.target.value))})})}),e(g,{label:t("permanentLockout"),fieldId:"permanentLockout",hasNoPaddingTop:!0,children:e(w,{name:"permanentLockout",defaultValue:!1,control:u,render:({field:b})=>e(Q,{id:"permanentLockout",label:t("on"),labelOff:t("off"),isChecked:b.value,onChange:b.onChange,"aria-label":t("permanentLockout")})})}),!c&&d(Z,{children:[e(lt,{name:"waitIncrementSeconds"}),e(lt,{name:"maxFailureWaitSeconds"}),e(lt,{name:"maxDeltaTimeSeconds"})]}),e(g,{label:t("quickLoginCheckMilliSeconds"),labelIcon:e(E,{helpText:t("quickLoginCheckMilliSecondsHelp"),fieldLabelId:"quickLoginCheckMilliSeconds"}),fieldId:"quickLoginCheckMilliSeconds",children:e(w,{name:"quickLoginCheckMilliSeconds",defaultValue:0,control:u,render:({field:b})=>e(ut,{type:"text",id:"quickLoginCheckMilliSeconds",value:b.value,onPlus:()=>b.onChange(b.value+1),onMinus:()=>b.onChange(b.value-1),onChange:L=>b.onChange(Number(L.target.value))})})}),e(lt,{name:"minimumQuickLoginWaitSeconds"})]}),d(ge,{children:[e(A,{variant:"primary",type:"submit","data-testid":"brute-force-tab-save",isDisabled:!o,children:t("save")}),e(A,{variant:"link",onClick:p,children:t("revert")})]})]})})},Vl=({realm:a,save:l})=>{const{t}=V(),[n,i]=f(10);return d(Dt,{activeKey:n,onSelect:(r,u)=>i(u),children:[e(B,{id:"headers",eventKey:10,title:e(G,{children:t("headers")}),children:e(te,{variant:"light",children:e(Ml,{realm:a,save:l})})}),e(B,{id:"bruteForce",eventKey:20,title:e(G,{children:t("bruteForceDetection")}),children:e(te,{variant:"light",children:e(Kl,{realm:a,save:l})})})]})},Fl=()=>{const{config:a,save:l}=Rt(),{t}=V(),n=We(),{realm:i}=se(),[r,u]=f(0),[o,v]=f();ye(()=>u(h=>h+1),[a]);async function c(){return a?.groups??[]}const[p,b]=me({titleKey:"deleteDialogTitle",children:d(mt,{i18nKey:"deleteDialogDescription",children:[" ",e("strong",{children:{group:o?.name}}),"."]}),continueButtonLabel:"delete",continueButtonVariant:le.danger,onConfirm(){const h=(a?.groups??[]).filter(y=>y!==o);l({...a,groups:h},{successMessageKey:"deleteSuccess",errorMessageKey:"deleteAttributeGroupError"})}});function L(h){v(h),p()}return d(te,{variant:"light",className:"pf-u-p-0",children:[e(b,{}),e(Ue,{loader:c,ariaLabelKey:"tableTitle",toolbarItem:e(ve,{children:e(A,{component:h=>e(be,{...h,to:Ht({realm:i})}),children:t("createGroupText")})}),columns:[{name:"name",displayKey:"columnName",cellRenderer:h=>e(be,{to:wa({realm:i,name:h.name}),children:h.name})},{name:"displayHeader",displayKey:"columnDisplayName"},{name:"displayDescription",displayKey:"columnDisplayDescription"}],actions:[{title:t("delete"),onRowClick:L}],emptyState:e(Ae,{message:t("emptyStateMessage"),instructions:t("emptyStateInstructions"),primaryActionText:t("createGroupText"),onPrimaryAction:()=>n(Ht({realm:i}))})},r)]})},Hl=["username","email"],Ul=()=>{const{config:a,save:l}=Rt(),{realm:t}=se(),{t:n}=V(),i=We(),[r,u]=f("allGroups"),[o,v]=Ve(),[c,p]=f(a?.attributes),[b,L]=f(""),[h,y]=me({titleKey:n("deleteAttributeConfirmTitle"),messageKey:n("deleteAttributeConfirm",{attributeName:b}),continueButtonLabel:n("delete"),continueButtonVariant:le.danger,onConfirm:async()=>{if(!a?.attributes)return;const I=a.attributes.filter(N=>N.name!==b);l({attributes:I,groups:a.groups},{successMessageKey:"deleteAttributeSuccess",errorMessageKey:"deleteAttributeError"}),L("")}});if(!a)return e(De,{});const P=a.attributes??[],s=a.groups??[],m=async(I,N)=>{const R=P.findIndex(D=>D.name===I.name);let k={};k=P[R],P.splice(R,1),P.splice(N,0,k),l({attributes:P,groups:s},{successMessageKey:"updatedUserProfileSuccess",errorMessageKey:"updatedUserProfileError"})},C=I=>e(be,{to:Ut({realm:t,attributeName:I.name}),children:I.name},I.name);return d(Z,{children:[e(ea,{children:d(Qa,{children:[e(ve,{children:e(ce,{width:200,"data-testid":"filter-select",isOpen:o,variant:he.single,onToggle:v,toggleIcon:e(sa,{}),onSelect:(I,N)=>{const R=N.toString();u(R),p(R==="allGroups"?P:P.filter(k=>k.group===R)),v()},selections:r==="allGroups"?n(r):r,children:[e(ie,{"data-testid":"all-groups",value:"allGroups",children:n("allGroups")},"allGroups"),...Aa(P.filter(I=>!!I.group),"group").map(I=>e(ie,{"data-testid":`${I.group}-option`,value:I.group},I.group))]})}),e(ve,{className:"kc-toolbar-attributesTab",children:e(A,{"data-testid":"createAttributeBtn",variant:"primary",component:I=>e(be,{...I,to:Da({realm:t})}),children:n("createAttribute")})})]})}),e(qe,{}),e(y,{}),e(ra,{keyField:"name",onDragFinish:async(I,N)=>{const R=P.map(F=>F.name),k=N.indexOf(I),D=R.indexOf(I),H=P[D];H.name&&m(H,k)},actions:[{title:n("edit"),onClick:(I,N,R)=>{i(Ut({realm:t,attributeName:R.name}))}},{title:n("delete"),isActionable:({name:I})=>!Hl.includes(I),onClick:(I,N,R)=>{L(R.name),h()}}],columns:[{name:"name",displayKey:n("attributeName"),cellRenderer:C},{name:"displayName",displayKey:n("attributeDisplayName")},{name:"group",displayKey:n("attributeGroup")}],data:c??P})]})},Bl=()=>{const{config:a,save:l,isSaving:t}=Rt(),{t:n}=V(),{addError:i}=de(),[r,u]=f();ye(()=>o(),[a,r]);function o(){r?.setValue(a?et(a):"")}async function v(){const c=r?.getValue();if(c)try{await l(JSON.parse(c))}catch(p){i("invalidJsonError",p);return}}return d(te,{variant:"light",children:[e(wt,{language:At.json,height:"30rem",onEditorDidMount:c=>u(c),isLanguageLabelVisible:!0}),e(xt,{children:d(ge,{children:[e(A,{"data-testid":"save",variant:"primary",onClick:v,isDisabled:t,children:n("save")}),e(A,{variant:"link",onClick:o,isDisabled:t,children:n("revert")})]})})]})},Gl=()=>{const{realm:a}=se(),{t:l}=V(),t=u=>ct(Bt({realm:a,tab:u})),n=t("attributes"),i=t("attributes-group"),r=t("json-editor");return e(ol,{children:d(ot,{defaultLocation:Bt({realm:a,tab:"attributes"}),mountOnEnter:!0,children:[e(B,{title:e(G,{children:l("attributes")}),"data-testid":"attributesTab",...n,children:e(Ul,{})}),e(B,{title:e(G,{children:l("attributesGroup")}),"data-testid":"attributesGroupTab",...i,children:e(Fl,{})}),e(B,{title:e(G,{children:l("jsonEditor")}),"data-testid":"jsonEditorTab",...r,children:e(Bl,{})})]})})},zl=({save:a,onChange:l,value:t,realmName:n,refresh:i})=>{const{t:r}=V(),{refresh:u}=Qt(),{addAlert:o,addError:v}=de(),c=We(),[p,b]=f(!1),[L,h]=f(!1),{hasAccess:y}=Ra(),P=y("manage-realm"),[s,m]=me({titleKey:"disableConfirmTitle",messageKey:"disableConfirmRealm",continueButtonLabel:"disable",onConfirm:()=>{l(!t),a()}}),[C,I]=me({titleKey:"deleteConfirmTitle",messageKey:"deleteConfirmRealmSetting",continueButtonLabel:"delete",continueButtonVariant:le.danger,onConfirm:async()=>{try{await K.realms.del({realm:n}),o(r("deletedSuccessRealmSetting"),ae.success),await u(),c(Oa({realm:Na.masterRealm})),i()}catch(N){v("deleteErrorRealmSetting",N)}}});return d(Z,{children:[e(m,{}),e(I,{}),e(gl,{open:p,toggleDialog:()=>b(!p)}),e(bl,{isOpen:L,onClose:()=>h(!1)}),e(Ha,{titleKey:n,subKey:"realmSettingsExplain",helpUrl:Ma.realmSettingsUrl,divider:!1,dropdownItems:[e(it,{"data-testid":"openPartialImportModal",isDisabled:!P,onClick:()=>{b(!0)},children:r("partialImport")},"import"),e(it,{"data-testid":"openPartialExportModal",isDisabled:!P,onClick:()=>h(!0),children:r("partialExport")},"export"),e(Ka,{},"separator"),e(it,{isDisabled:!P,onClick:C,children:r("delete")},"delete")],isEnabled:t,isReadOnly:!P,onToggle:N=>{N?(l(N),a()):s()}})]})},_l=({realm:a,refresh:l})=>{const{t}=V(),{addAlert:n,addError:i}=de(),{realm:r}=se(),{refresh:u}=Qt(),o=We(),v=Et(),{control:c,setValue:p,getValues:b}=fe({mode:"onChange"}),[L,h]=f(0),y=()=>{h(L+1)};ye((_=a)=>{Pe(_,p)},[p,a]);const s=async _=>{_=Va(_),_.attributes?.["acr.loa.map"]&&typeof _.attributes["acr.loa.map"]!="string"&&(_.attributes["acr.loa.map"]=JSON.stringify(Object.fromEntries(_.attributes["acr.loa.map"].filter(({key:ee})=>ee!=="").map(({key:ee,value:Xe})=>[ee,Xe]))));try{const ee={...a,..._,id:_.realm};ee.smtpServer?.port===""&&(ee.smtpServer={...ee.smtpServer,port:null}),await K.realms.update({realm:r},ee),n(t("realmSaveSuccess"),ae.success)}catch(ee){i("realmSaveError",ee)}r!==(_.realm||a.realm)&&(await u(),o(bt({realm:_.realm,tab:"general"}))),l()},m=_=>ct(bt({realm:r,tab:_})),C=m("general"),I=m("login"),N=m("email"),R=m("themes"),k=m("keys"),D=m("events"),H=m("localization"),F=m("security-defenses"),S=m("sessions"),U=m("tokens"),W=m("client-policies"),O=m("user-profile"),$=m("user-registration"),J=_=>ct(yt({realm:r,tab:_})),ue=J("profiles"),Te=J("policies");return d(Z,{children:[e(w,{name:"enabled",defaultValue:!0,control:c,render:({field:_})=>e(zl,{value:_.value,onChange:_.onChange,realmName:r,refresh:y,save:()=>s(b())})}),e(te,{variant:"light",className:"pf-u-p-0",children:d(ot,{isBox:!0,mountOnEnter:!0,"aria-label":"realm-settings-tabs",defaultLocation:bt({realm:r,tab:"general"}),children:[e(B,{title:e(G,{children:t("general")}),"data-testid":"rs-general-tab",...C,children:e(ml,{realm:a,save:s})}),e(B,{title:e(G,{children:t("login")}),"data-testid":"rs-login-tab",...I,children:e(fl,{refresh:l,realm:a})}),e(B,{title:e(G,{children:t("email")}),"data-testid":"rs-email-tab",...N,children:e(ul,{realm:a,save:s})}),e(B,{title:e(G,{children:t("themes")}),"data-testid":"rs-themes-tab",...R,children:e(Cl,{realm:a,save:s})}),e(B,{title:e(G,{children:t("keys")}),"data-testid":"rs-keys-tab",...k,children:e(Ol,{})}),e(B,{title:e(G,{children:t("events")}),"data-testid":"rs-realm-events-tab",...D,children:e(El,{realm:a})}),e(B,{title:e(G,{children:t("localization")}),"data-testid":"rs-localization-tab",...H,children:e(hl,{refresh:l,save:s,realm:a},L)}),e(B,{title:e(G,{children:t("securityDefences")}),"data-testid":"rs-security-defenses-tab",...F,children:e(Vl,{realm:a,save:s})}),e(B,{title:e(G,{children:t("sessions")}),"data-testid":"rs-sessions-tab",...S,children:e(Tl,{realm:a,save:s},L)}),e(B,{title:e(G,{children:t("tokens")}),"data-testid":"rs-tokens-tab",...U,children:e(Sl,{save:s,realm:a})}),v(dt.ClientPolicies)&&e(B,{title:e(G,{children:t("clientPolicies")}),"data-testid":"rs-clientPolicies-tab",...W,children:d(ot,{mountOnEnter:!0,defaultLocation:yt({realm:r,tab:"profiles"}),children:[e(B,{id:"profiles","data-testid":"rs-policies-clientProfiles-tab","aria-label":t("clientProfilesSubTab"),title:e(G,{children:t("profiles")}),tooltip:e(Gt,{content:t("clientPoliciesProfilesHelpText")}),...ue,children:e(yl,{})}),e(B,{id:"policies","data-testid":"rs-policies-clientPolicies-tab","aria-label":t("clientPoliciesSubTab"),...Te,title:e(G,{children:t("policies")}),tooltip:e(Gt,{content:t("clientPoliciesPoliciesHelpText")}),children:e(vl,{})})]})}),v(dt.DeclarativeUserProfile)&&a.attributes?.userProfileEnabled==="true"&&e(B,{title:e(G,{children:t("userProfile")}),"data-testid":"rs-user-profile-tab",...O,children:e(Gl,{})}),e(B,{title:e(G,{children:t("userRegistration")}),"data-testid":"rs-userRegistration-tab",...$,children:e(Il,{})})]})})]})};function Qn(){const{realm:a}=Fa(),[l,t]=f(),[n,i]=f(0),r=()=>{i(n+1),t(void 0)};return Se(()=>K.realms.findOne({realm:a}),t,[n]),l?e(_l,{realm:l,refresh:r}):e(De,{})}export{Qn as default};
//# sourceMappingURL=RealmSettingsSection-2S7HK03F.js.map
