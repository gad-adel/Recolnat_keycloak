import{jsx as e,jsxs as f,Fragment as $}from"react/jsx-runtime";import{_ as _e,l as Re,N as fe,u as _,g as j,f as U,e as L,B as E,m as q,F as T,C as N,S as K,b as W,c as D,j as w,A as F,d as We,h as me,k as Ne,r as he,O as be,Q as X,U as ee,W as ke,q as Xe,X as xe,z as ce,D as Qe,P as G,i as C,Y as ge,G as Oe,H as Fe,Z as Ze,R as Ae,V as x,$ as Je,a0 as et,a as Le,a1 as tt,a2 as ve,a3 as at,a4 as Me,a5 as it,a6 as nt,T as lt,a7 as ot,a8 as rt,t as Ie,L as He,a9 as st,p as ct,aa as dt,ab as ut,ac as pt}from"./index-sihFV1NS.js";import*as Ve from"react";import{useEffect as J,useState as k,useMemo as De}from"react";import{u as mt}from"./ConfirmDialog-WMVurgkl.js";import{L as ht}from"./PaginatingTableToolbar--Dt3wwL6.js";import{R as bt,u as yt}from"./RoutableTabs-a7VqIL_I.js";import{K as $e}from"./KeycloakDataTable-Q3kZYP9q.js";import{V as ft}from"./ViewHeader-xo54NRb6.js";import{u as Ue,m as gt}from"./useLocaleSort-K-jL4v2R.js";import{u as Q}from"./useToggle-mZS4AEtR.js";import{N as At}from"./NameDescription-OqiBXUTh.js";import{M as ye,a as qe}from"./Modal-uOAPm2rX.js";import{F as Be,A as ae}from"./Form-bfj-xQZn.js";import{D as vt}from"./DraggableTable-ZpdKj1kF.js";import{f as It}from"./resource-BRtaBrSc.js";import{F as ie}from"./FormAccess-EK-4wbwg.js";import{K as Z}from"./KeycloakTextInput--S1SG2UN.js";import{T as Ke}from"./TimeSelector-UGEjvSE_.js";import{N as de}from"./NumberInput-QtFengwl.js";import{s as Pt,E as wt,a as Tt}from"./EmptyStateBody-jnnI7hpP.js";import{T as Ct,a as St,b as Ge}from"./ToolbarContent-46I9Yg7h.js";import{E as Et}from"./EmptyStateSecondaryActions-G5doWCZ5.js";import{M as Pe}from"./MultiLineInput-MBnUzZD_.js";import{Q as _t}from"./question-circle-icon-0KWACECW.js";import{T as Rt,a as H,b as V}from"./Tabs-wiayO8Tk.js";import{T as Nt}from"./Trans-1cjg0ImV.js";import{s as kt}from"./sortBy-zPScg0cx.js";var te;(function(t){t.default="default",t.plain="plain"})(te||(te={}));const ue=t=>{var{className:n="",component:a="span",children:i,variant:c=te.default}=t,r=_e(t,["className","component","children","variant"]);const h=a;return Ve.createElement(h,Object.assign({className:Re(fe.inputGroupText,c===te.plain&&fe.modifiers.plain,n)},r),i)};ue.displayName="InputGroupText";const je=t=>{var{children:n,className:a=""}=t,i=_e(t,["children","className"]);return Ve.createElement("div",Object.assign({className:Re(Pt.emptyStatePrimary,a)},i),n)};je.displayName="EmptyStatePrimary";const xt=({flowAlias:t,onClose:n})=>{const{t:a}=_(),{control:i,handleSubmit:c}=j(),{addAlert:r,addError:h}=U(),{realm:d}=L(),[m,b]=Q(),A=async({bindingType:l})=>{const p=await w.realms.findOne({realm:d});try{await w.realms.update({realm:d},{...p,[l]:t}),r(a("updateFlowSuccess"),F.success)}catch(u){h("updateFlowError",u)}n()};return e(ye,{title:a("bindFlow"),variant:"small",onClose:n,actions:[e(E,{"data-testid":"save",type:"submit",form:"bind-form",children:a("save")},"confirm"),e(E,{"data-testid":"cancel",variant:q.link,onClick:n,children:a("cancel")},"cancel")],isOpen:!0,children:e(Be,{id:"bind-form",isHorizontal:!0,onSubmit:c(A),children:e(T,{label:a("chooseBindingType"),fieldId:"chooseBindingType",children:e(N,{name:"bindingType",defaultValue:"browserFlow",control:i,render:({field:l})=>e(K,{toggleId:"chooseBindingType",onToggle:b,onSelect:(p,u)=>{l.onChange(u.toString()),b()},selections:l.value,variant:W.single,isOpen:m,menuAppendTo:"parent",children:[...Y.keys()].filter(p=>p!=="dockerAuthenticationFlow").map(p=>{const u=Y.get(p);return e(D,{selected:p===Y.get(p),value:p,children:a(`flow.${u}`)},p)})})})})})})},Ot=({name:t,description:n,toggleDialog:a,onComplete:i})=>{const{t:c}=_(),r=j({mode:"onChange"}),{setValue:h,getValues:d,handleSubmit:m}=r,{addAlert:b,addError:A}=U(),l=We(),{realm:p}=L();J(()=>{h("alias",c("copyOf",{name:t})),h("description",n)},[t,n]);const u=async()=>{const g=d();try{await w.authenticationManagement.copyFlow({flow:t,newName:g.alias});const y=(await w.authenticationManagement.getFlows()).find(S=>S.alias===g.alias);g.description!==n&&(y.description=g.description,await w.authenticationManagement.updateFlow({flowId:y.id},y)),b(c("copyFlowSuccess"),F.success),l(Ne({realm:p,id:y.id,usedBy:"notInUse",builtIn:y.builtIn?"builtIn":void 0}))}catch(y){A("copyFlowError",y)}i()};return e(ye,{title:c("duplicateFlow"),onClose:a,variant:qe.small,actions:[e(E,{"data-testid":"confirm",type:"submit",form:"duplicate-flow-form",children:c("duplicate")},"confirm"),e(E,{"data-testid":"cancel",variant:q.link,onClick:a,children:c("cancel")},"cancel")],isOpen:!0,children:e(me,{...r,children:e(Be,{id:"duplicate-flow-form",onSubmit:m(u),isHorizontal:!0,children:e(At,{})})})})},Ft=()=>{const{t}=_(),{addAlert:n,addError:a}=U(),[i,c]=k(),[r,h]=k(0),d=()=>h(r+1);he(async()=>{const[l,p]=await Promise.all([w.authenticationManagement.getRequiredActions(),w.authenticationManagement.getUnregisteredRequiredActions()]);return[...l.map(u=>({name:u.name,enabled:u.enabled,defaultAction:u.defaultAction,data:u})),...p.map(u=>({name:u.name,enabled:!1,defaultAction:!1,data:u}))]},l=>c(l),[r]);const m=l=>!("alias"in l),b=async(l,p)=>{try{p in l?(l[p]=!l[p],await w.authenticationManagement.updateRequiredAction({alias:l.alias},l)):m(l)&&await w.authenticationManagement.registerRequiredAction({name:l.name,providerId:l.providerId}),d(),n(t("updatedRequiredActionSuccess"),F.success)}catch(u){a("updatedRequiredActionError",u)}},A=async(l,p)=>{try{const u=l.alias;for(let g=0;g<Math.abs(p);g++)p>0?await w.authenticationManagement.lowerRequiredActionPriority({alias:u}):await w.authenticationManagement.raiseRequiredActionPriority({alias:u});d(),n(t("updatedRequiredActionSuccess"),F.success)}catch(u){a("updatedRequiredActionError",u)}};return i?e(vt,{keyField:"name",onDragFinish:async(l,p)=>{const u=i.map(P=>P.name),g=p.indexOf(l),y=u.indexOf(l),S=i[y].data;if(!S.alias)return;const v=g-y;A(S,v)},columns:[{name:"name",displayKey:"requiredActions"},{name:"enabled",displayKey:"enabled",cellRenderer:l=>e(X,{id:`enable-${ee(l.name)}`,label:t("on"),labelOff:t("off"),isChecked:l.enabled,onChange:()=>{b(l.data,"enabled")},"aria-label":ee(l.name)})},{name:"default",displayKey:"setAsDefaultAction",thTooltipText:"authDefaultActionTooltip",cellRenderer:l=>e(X,{id:`default-${ee(l.name)}`,label:t("on"),isDisabled:!l.enabled,labelOff:l.enabled?t("off"):t("disabledOff"),isChecked:l.defaultAction,onChange:()=>{b(l.data,"defaultAction")},"aria-label":ee(l.name)})}],data:i}):e(be,{})},Lt="_label_1r9ky_1",pe={label:Lt},ne=({label:t})=>f($,{children:[e(Xe,{className:pe.label})," ",t]}),Mt=({id:t,isSpecificClient:n,onClose:a})=>{const{t:i}=_(),c=async(r,h,d)=>(await It({id:t,type:n?"clients":"idp",first:r||0,max:h||10,search:d})).map(b=>({name:b}));return e(ye,{header:f(xe,{children:[e(ce,{component:Qe.h1,children:i("flowUsedBy")}),e(ce,{children:i("flowUsedByDescription",{value:i(n?"clients":"identiyProviders")})})]}),variant:qe.medium,isOpen:!0,onClose:a,actions:[e(E,{"data-testid":"cancel",id:"modal-cancel",onClick:a,children:i("close")},"cancel")],children:e($e,{loader:c,isPaginated:!0,ariaLabelKey:"usedBy",searchPlaceholderKey:"search",columns:[{name:"name"}]})})},Ht=({authType:{id:t,usedBy:n},realm:a})=>{const{t:i}=_(),[c,r]=Q(),h=Object.entries(a).find(d=>d[1]===n?.values[0])?.[0];return f($,{children:[c&&e(Mt,{id:t,onClose:r,isSpecificClient:n?.type==="SPECIFIC_CLIENTS"}),(n?.type==="SPECIFIC_PROVIDERS"||n?.type==="SPECIFIC_CLIENTS")&&(n.values.length<=8?e(ke,{"aria-label":i("usedBy"),bodyContent:f("div",{children:[i("appliedBy"+(n.type==="SPECIFIC_CLIENTS"?"Clients":"Providers"))," ",n.values.map((d,m)=>f($,{children:[e("strong",{children:d}),m<n.values.length-1?", ":""]}))]},`usedBy-${t}-${n.values}`),children:e(E,{variant:"link",className:pe.label,children:e(ne,{label:i(`used.${n.type}`)})})},t):e(E,{variant:"link",className:pe.label,onClick:r,children:e(ne,{label:i(`used.${n.type}`)})})),n?.type==="DEFAULT"&&e(ne,{label:i(`flow.${Y.get(h)}`)}),!n?.type&&i("used.notInUse")]})},we=["poll","ping"],le=10,oe=600,re=0,se=600,Vt=({realm:t,realmUpdated:n})=>{const{t:a}=_(),{control:i,register:c,handleSubmit:r,setValue:h,formState:{errors:d,isValid:m,isDirty:b}}=j({mode:"onChange"}),{realm:A}=L(),{addAlert:l,addError:p}=U(),[u,g]=k(!1),[y,S]=k(!1),v=o=>Oe(o,h);return J(()=>v(t),[]),e(G,{variant:"light",children:f(ie,{role:"manage-realm",isHorizontal:!0,onSubmit:r(async o=>{try{await w.realms.update({realm:A},Fe(o));const s=await w.realms.findOne({realm:A});n(s),v(s),l(a("updateCibaSuccess"),F.success)}catch(s){p("updateCibaError",s)}}),children:[e(T,{fieldId:"cibaBackchannelTokenDeliveryMode",label:a("cibaBackchannelTokenDeliveryMode"),labelIcon:e(C,{helpText:a("cibaBackchannelTokenDeliveryModeHelp"),fieldLabelId:"cibaBackchannelTokenDeliveryMode"}),children:e(N,{name:"attributes.cibaBackchannelTokenDeliveryMode",defaultValue:we[0],control:i,render:({field:o})=>e(K,{toggleId:"cibaBackchannelTokenDeliveryMode",onSelect:(s,R)=>{g(!1),o.onChange(R.toString())},selections:o.value,variant:W.single,isOpen:u,onToggle:s=>g(s),children:we.map(s=>e(D,{value:s,selected:s===o.value,children:a(`cibaBackhannelTokenDeliveryModes.${s}`)},s))})})}),e(T,{fieldId:"cibaExpiresIn",label:a("cibaExpiresIn"),labelIcon:e(C,{helpText:a("cibaExpiresInHelp"),fieldLabelId:"cibaExpiresIn"}),validated:d.attributes?.cibaExpiresIn?"error":"default",helperTextInvalid:d.attributes?.cibaExpiresIn?.message,isRequired:!0,children:f(ge,{children:[e(Z,{id:"cibaExpiresIn",type:"number",min:le,max:oe,...c("attributes.cibaExpiresIn",{min:{value:le,message:a("greaterThan",{value:le})},max:{value:oe,message:a("lessThan",{value:oe})},required:{value:!0,message:a("required")}}),validated:d.attributes?.cibaExpiresIn?"error":"default"}),e(ue,{variant:"plain",children:a("times:seconds")})]})}),e(T,{fieldId:"cibaInterval",label:a("cibaInterval"),labelIcon:e(C,{helpText:a("cibaIntervalHelp"),fieldLabelId:"cibaInterval"}),validated:d.attributes?.cibaInterval?"error":"default",helperTextInvalid:d.attributes?.cibaInterval?.message,isRequired:!0,children:f(ge,{children:[e(Z,{id:"cibaInterval",type:"number",min:re,max:se,...c("attributes.cibaInterval",{min:{value:re,message:a("greaterThan",{value:re})},max:{value:se,message:a("lessThan",{value:se})},required:{value:!0,message:a("required")}}),validated:d.attributes?.cibaInterval?"error":"default"}),e(ue,{variant:"plain",children:a("times:seconds")})]})}),e(T,{fieldId:"cibaAuthRequestedUserHint",label:a("cibaAuthRequestedUserHint"),labelIcon:e(C,{helpText:a("cibaAuthRequestedUserHintHelp"),fieldLabelId:"cibaAuthRequestedUserHint"}),children:f(K,{toggleId:"cibaAuthRequestedUserHint",selections:"login_hint",isOpen:y,onToggle:o=>S(o),isDisabled:!0,children:[e(D,{value:"login_hint",children:"login_hint"}),e(D,{value:"id_token_hint",children:"id_token_hint"}),e(D,{value:"login_hint_token",children:"login_hint_token"})]})}),f(ae,{children:[e(E,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!m||!b,children:a("save")}),e(E,{"data-testid":"reload",variant:q.link,onClick:()=>v({...t}),children:a("reload")})]})]})})},B=["totp","hotp"],Te=["SHA1","SHA256","SHA512"],Ce=[6,8],Dt=({realm:t,realmUpdated:n})=>{const{t:a}=_(),{control:i,reset:c,handleSubmit:r,formState:{isValid:h,isDirty:d,errors:m}}=j({mode:"onChange",defaultValues:t}),{realm:b}=L(),{addAlert:A,addError:l}=U(),p=Ue(),[u,g]=Q(),y=Ze({name:"otpPolicyType",control:i,defaultValue:B[0]}),S=o=>c(o);J(()=>S(t),[]);const v=De(()=>{const o=(t.otpSupportedApplications??[]).map(s=>a(`otpSupportedApplications.${s}`));return p(o,s=>s)},[t.otpSupportedApplications]);return e(G,{variant:"light",children:f(ie,{role:"manage-realm",isHorizontal:!0,onSubmit:r(async o=>{try{await w.realms.update({realm:b},o);const s=await w.realms.findOne({realm:b});n(s),S(s),A(a("updateOtpSuccess"),F.success)}catch(s){l("updateOtpError",s)}}),className:"keycloak__otp_policies_authentication__form",children:[e(T,{label:a("otpType"),labelIcon:e(C,{helpText:a("otpTypeHelp"),fieldLabelId:"otpType"}),hasNoPaddingTop:!0,children:e(N,{name:"otpPolicyType","data-testid":"otpPolicyType",defaultValue:B[0],control:i,render:({field:o})=>e($,{children:B.map(s=>e(Ae,{id:s,"data-testid":s,isChecked:o.value===s,name:"otpPolicyType",onChange:()=>o.onChange(s),label:a(`policyType.${s}`),className:"keycloak__otp_policies_authentication__policy-type"},s))})})}),e(T,{label:a("otpHashAlgorithm"),labelIcon:e(C,{helpText:a("otpHashAlgorithmHelp"),fieldLabelId:"otpHashAlgorithm"}),fieldId:"otpHashAlgorithm",children:e(N,{name:"otpPolicyAlgorithm",defaultValue:`Hmac${Te[0]}`,control:i,render:({field:o})=>e(K,{toggleId:"otpHashAlgorithm",onToggle:g,onSelect:(s,R)=>{o.onChange(R.toString()),g()},selections:o.value,variant:W.single,isOpen:u,children:Te.map(s=>e(D,{selected:`Hmac${s}`===o.value,value:`Hmac${s}`,children:s},s))})})}),e(T,{label:a("otpPolicyDigits"),labelIcon:e(C,{helpText:a("otpPolicyDigitsHelp"),fieldLabelId:"otpPolicyDigits"}),hasNoPaddingTop:!0,children:e(N,{name:"otpPolicyDigits","data-testid":"otpPolicyDigits",defaultValue:Ce[0],control:i,render:({field:o})=>e($,{children:Ce.map(s=>e(Ae,{id:`digit-${s}`,"data-testid":`digit-${s}`,isChecked:o.value===s,name:"otpPolicyDigits",onChange:()=>o.onChange(s),label:s,className:"keycloak__otp_policies_authentication__number-of-digits"},s))})})}),e(T,{label:a("lookAround"),labelIcon:e(C,{helpText:a("lookAroundHelp"),fieldLabelId:"lookAround"}),fieldId:"lookAround",children:e(N,{name:"otpPolicyLookAheadWindow",defaultValue:1,control:i,render:({field:o})=>{const R=o.value??1,O=I=>o.onChange(Math.max(I,0));return e(de,{id:"lookAround",value:R,min:0,onPlus:()=>O(R+1),onMinus:()=>O(R-1),onChange:I=>{const M=Number(I.currentTarget.value);O(isNaN(M)?0:M)}})}})}),y===B[0]&&e(T,{label:a("otpPolicyPeriod"),fieldId:"otpPolicyPeriod",helperTextInvalid:a("otpPolicyPeriodErrorHint"),validated:m.otpPolicyPeriod?x.error:x.default,labelIcon:e(C,{helpText:a("otpPolicyPeriodHelp"),fieldLabelId:"otpPolicyPeriod"}),children:e(N,{name:"otpPolicyPeriod",defaultValue:30,control:i,rules:{min:1,max:120},render:({field:o})=>{const s=o.value??30;return e(Ke,{id:"otpPolicyPeriod","data-testid":"otpPolicyPeriod",value:s,onChange:o.onChange,units:["second","minute"],validated:m.otpPolicyPeriod?x.error:x.default})}})}),y===B[1]&&e(T,{label:a("initialCounter"),fieldId:"initialCounter",helperTextInvalid:a("initialCounterErrorHint"),validated:m.otpPolicyInitialCounter?x.error:x.default,labelIcon:e(C,{helpText:a("initialCounterHelp"),fieldLabelId:"initialCounter"}),children:e(N,{name:"otpPolicyInitialCounter",defaultValue:30,control:i,rules:{min:1,max:120},render:({field:o})=>{const R=o.value??30,O=I=>o.onChange(Math.max(I,1));return e(de,{id:"initialCounter",value:R,min:1,onPlus:()=>O(R+1),onMinus:()=>O(R-1),onChange:I=>{const M=Number(I.currentTarget.value);O(isNaN(M)?30:M)}})}})}),e(T,{label:a("supportedApplications"),labelIcon:e(C,{helpText:a("supportedApplicationsHelp"),fieldLabelId:"supportedApplications"}),children:e(Je,{"data-testid":"supportedApplications",children:v.map(o=>e(et,{isReadOnly:!0,children:o},o))})}),y===B[0]&&e(T,{label:a("otpPolicyCodeReusable"),fieldId:"otpPolicyCodeReusable",labelIcon:e(C,{helpText:a("otpPolicyCodeReusableHelp"),fieldLabelId:"otpPolicyCodeReusable"}),children:e(N,{name:"otpPolicyCodeReusable",defaultValue:!0,control:i,render:({field:o})=>e(X,{id:"otpPolicyCodeReusable",label:a("on"),labelOff:a("off"),isChecked:o.value,onChange:o.onChange})})}),f(ae,{children:[e(E,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!h||!d,children:a("save")}),e(E,{"data-testid":"reload",variant:q.link,onClick:()=>c({...t}),children:a("reload")})]})]})})},$t=({policy:{id:t,configType:n,defaultValue:a,displayName:i},onRemove:c})=>{const{t:r}=_(),{control:h,register:d,formState:{errors:m}}=Le();return e(T,{label:i,fieldId:t,isRequired:!0,helperTextInvalid:r("required"),validated:m[t]?x.error:x.default,labelIcon:e(C,{helpText:r(`passwordPoliciesHelp.${t}`),fieldLabelId:t}),children:f(tt,{children:[f(ve,{isFilled:!0,children:[n&&n!=="int"&&e(Z,{id:t,"data-testid":t,...d(t,{required:!0}),defaultValue:a,validated:m[t]?x.error:x.default}),n==="int"&&e(N,{name:t,defaultValue:Number.parseInt(a||"0"),control:h,render:({field:b})=>{const l=u=>b.onChange(Math.max(u,0)),p=Number(b.value);return e(de,{id:t,value:p,min:0,onPlus:()=>l(p+1),onMinus:()=>l(p-1),onChange:u=>{const g=Number(u.currentTarget.value);l(isNaN(g)?0:g)},className:"keycloak__policies_authentication__number-field"})}}),!n&&e(X,{id:t,label:r("on"),labelOff:r("off"),isChecked:!0,isDisabled:!0,"aria-label":i})]}),e(ve,{children:e(E,{"data-testid":`remove-${t}`,variant:"link",className:"keycloak__policies_authentication__minus-icon",onClick:()=>c(t),"aria-label":r("remove"),children:e(at,{})})})]})})},ze=" and ",Ut=(t,n)=>t.map(a=>`${a.id}(${n[a.id]})`).join(ze),qt=(t,n)=>t.split(ze).map(Bt).reduce((a,{id:i,value:c})=>{const r=n.find(h=>h.id===i);return r?a.concat({...r,value:c}):a},[]);function Bt(t){const n=t.indexOf("(");if(n===-1)return{id:t.trim()};const a=t.substring(0,n).trim(),i=t.lastIndexOf(")");if(i===-1)return{id:a};const c=t.substring(n+1,i).trim();return{id:a,value:c}}const Se=({onSelect:t,selectedPolicies:n})=>{const{t:a}=_(),{passwordPolicies:i}=Me(),[c,r]=k(!1),h=De(()=>i?.filter(d=>n.find(m=>m.id===d.id)===void 0),[n]);return e(K,{width:300,onSelect:(d,m)=>{t(m),r(!1)},onToggle:d=>r(d),isOpen:c,selections:a("addPolicy"),isDisabled:h?.length===0,children:h?.map(d=>e(D,{value:d,children:d.displayName},d.id))})},Kt=({realm:t,realmUpdated:n})=>{const{t:a}=_(),{passwordPolicies:i}=Me(),{addAlert:c,addError:r}=U(),{realm:h}=L(),[d,m]=k([]),b=v=>{m([...d,v]),p(v.id,v.defaultValue,{shouldDirty:!0})},A=j({defaultValues:{}}),{handleSubmit:l,setValue:p,reset:u,formState:{isDirty:g}}=A,y=v=>{u();const P=qt(v.passwordPolicy||"",i);P.forEach(o=>{p(o.id,o.value)}),m(P)};J(()=>y(t),[]);const S=async v=>{const P={...t,passwordPolicy:Ut(d,v)};try{await w.realms.update({realm:h},P),n(P),y(P),c(a("updatePasswordPolicySuccess"),F.success)}catch(o){r("updatePasswordPolicyError",o)}};return f(G,{variant:"light",className:"pf-u-p-0",children:[(d.length!==0||t.passwordPolicy)&&f($,{children:[e(Ct,{children:e(St,{children:e(Ge,{children:e(Se,{onSelect:b,selectedPolicies:d})})})}),e(it,{}),e(G,{variant:"light",children:e(me,{...A,children:f(ie,{className:"keycloak__policies_authentication__form",role:"manage-realm",isHorizontal:!0,onSubmit:l(S),children:[d.map((v,P)=>e($t,{policy:v,onRemove:o=>{m(d.filter(s=>s.id!==o)),p(v.id,"",{shouldDirty:!0})}},`${v.id}-${P}`)),f(ae,{children:[e(E,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!g,children:a("save")}),e(E,{"data-testid":"reload",variant:q.link,onClick:()=>y(t),children:a("reload")})]})]})})})]}),!d.length&&!t.passwordPolicy&&f(wt,{"data-testid":"empty-state",variant:"large",children:[e(Et,{icon:nt}),e(lt,{headingLevel:"h1",size:"lg",children:a("noPasswordPolicies")}),e(Tt,{children:a("noPasswordPoliciesInstructions")}),e(je,{children:e(Se,{onSelect:b,selectedPolicies:[]})})]})]})},Gt=["ES256","ES384","ES512","RS256","RS384","RS512","RS1"],jt=["not specified","none","indirect","direct"],zt=["not specified","platform","cross-platform"],Yt=["not specified","Yes","No"],Wt=["not specified","required","preferred","discouraged"],z=({name:t,label:n,options:a,labelPrefix:i,isMultiSelect:c=!1})=>{const{t:r}=_(),{control:h}=Le(),[d,m]=k(!1);return e(T,{label:r(n),labelIcon:e(C,{helpText:r(`${n}Help`),fieldLabelId:n}),fieldId:t,children:e(N,{name:t,defaultValue:a[0],control:h,render:({field:b})=>e(K,{toggleId:t,onToggle:m,onSelect:(A,l)=>{if(c){const p=b.value.find(u=>u===l)?b.value.filter(u=>u!==l):[...b.value,l];b.onChange(p)}else b.onChange(l.toString()),m(!1)},selections:i?r(`${i}.${b.value}`):b.value,variant:c?W.typeaheadMulti:W.single,"aria-label":r(t),typeAheadAriaLabel:r(t),isOpen:d,children:a.map(A=>e(D,{selected:A===b.value,value:A,children:i?r(`${i}.${A}`):A},A))})})})},Ee=({realm:t,realmUpdated:n,isPasswordLess:a=!1})=>{const{t:i}=_(),{addAlert:c,addError:r}=U(),{realm:h}=L(),{enabled:d}=ot(),m=j({mode:"onChange"}),{control:b,register:A,setValue:l,handleSubmit:p,formState:{isDirty:u,errors:g}}=m,y=a?"webAuthnPolicyPasswordless":"webAuthnPolicy",S=P=>Oe(P,l);J(()=>S(t),[]);const v=async P=>{const o=Fe(P);try{await w.realms.update({realm:h},o),n(o),S(o),c(i("webAuthnUpdateSuccess"),F.success)}catch(s){r("webAuthnUpdateError",s)}};return f(G,{variant:"light",children:[d&&e(ke,{bodyContent:i(`${y}FormHelp`),children:e(xe,{className:"keycloak__section_intro__help",children:f(ce,{children:[e(_t,{})," ",i("webauthnIntro")]})})}),f(ie,{role:"manage-realm",isHorizontal:!0,onSubmit:p(v),className:"keycloak__webauthn_policies_authentication__form",children:[e(T,{label:i("webAuthnPolicyRpEntityName"),fieldId:"webAuthnPolicyRpEntityName",helperTextInvalid:i("required"),validated:g.webAuthnPolicyRpEntityName?"error":"default",isRequired:!0,labelIcon:e(C,{helpText:i("webAuthnPolicyRpEntityNameHelp"),fieldLabelId:"webAuthnPolicyRpEntityName"}),children:e(Z,{id:"webAuthnPolicyRpEntityName","data-testid":"webAuthnPolicyRpEntityName",validated:g.webAuthnPolicyRpEntityName?"error":"default",...A(`${y}RpEntityName`,{required:!0})})}),f(me,{...m,children:[e(z,{name:`${y}SignatureAlgorithms`,label:"webAuthnPolicySignatureAlgorithms",options:Gt,isMultiSelect:!0}),e(T,{label:i("webAuthnPolicyRpId"),labelIcon:e(C,{helpText:i("webAuthnPolicyRpIdHelp"),fieldLabelId:"webAuthnPolicyRpId"}),fieldId:"webAuthnPolicyRpId",children:e(Z,{id:"webAuthnPolicyRpId","data-testid":"webAuthnPolicyRpId",...A(`${y}RpId`)})}),e(z,{name:`${y}AttestationConveyancePreference`,label:"webAuthnPolicyAttestationConveyancePreference",options:jt,labelPrefix:"attestationPreference"}),e(z,{name:`${y}AuthenticatorAttachment`,label:"webAuthnPolicyAuthenticatorAttachment",options:zt,labelPrefix:"authenticatorAttachment"}),e(z,{name:`${y}RequireResidentKey`,label:"webAuthnPolicyRequireResidentKey",options:Yt,labelPrefix:"residentKey"}),e(z,{name:`${y}UserVerificationRequirement`,label:"webAuthnPolicyUserVerificationRequirement",options:Wt,labelPrefix:"userVerify"}),e(T,{label:i("webAuthnPolicyCreateTimeout"),fieldId:"webAuthnPolicyCreateTimeout",helperTextInvalid:i("webAuthnPolicyCreateTimeoutHint"),validated:g.webAuthnPolicyCreateTimeout?"error":"default",labelIcon:e(C,{helpText:i("webAuthnPolicyCreateTimeoutHelp"),fieldLabelId:"webAuthnPolicyCreateTimeout"}),children:e(N,{name:`${y}CreateTimeout`,defaultValue:0,control:b,rules:{min:0,max:31536},render:({field:P})=>e(Ke,{"data-testid":"webAuthnPolicyCreateTimeout","aria-label":i("webAuthnPolicyCreateTimeout"),value:P.value,onChange:P.onChange,units:["second","minute","hour"],validated:g.webAuthnPolicyCreateTimeout?"error":"default"})})}),e(T,{label:i("webAuthnPolicyAvoidSameAuthenticatorRegister"),fieldId:"webAuthnPolicyAvoidSameAuthenticatorRegister",labelIcon:e(C,{helpText:i("webAuthnPolicyAvoidSameAuthenticatorRegisterHelp"),fieldLabelId:"webAuthnPolicyAvoidSameAuthenticatorRegister"}),children:e(N,{name:`${y}AvoidSameAuthenticatorRegister`,defaultValue:!1,control:b,render:({field:P})=>e(X,{id:"webAuthnPolicyAvoidSameAuthenticatorRegister",label:i("on"),labelOff:i("off"),isChecked:P.value,onChange:P.onChange,"aria-label":i("webAuthnPolicyAvoidSameAuthenticatorRegister")})})}),e(T,{label:i("webAuthnPolicyAcceptableAaguids"),fieldId:"webAuthnPolicyAcceptableAaguids",labelIcon:e(C,{helpText:i("webAuthnPolicyAcceptableAaguidsHelp"),fieldLabelId:"webAuthnPolicyAcceptableAaguids"}),children:e(Pe,{name:`${y}AcceptableAaguids`,"aria-label":i("webAuthnPolicyAcceptableAaguids"),addButtonLabel:"addAaguids"})}),e(T,{label:i("webAuthnPolicyExtraOrigins"),fieldId:"webAuthnPolicyExtraOrigins",labelIcon:e(C,{helpText:i("webAuthnPolicyExtraOriginsHelp"),fieldLabelId:"webAuthnPolicyExtraOrigins"}),children:e(Pe,{name:`${y}ExtraOrigins`,"aria-label":i("webAuthnPolicyExtraOrigins"),addButtonLabel:"addOrigins"})})]}),f(ae,{children:[e(E,{"data-testid":"save",variant:"primary",type:"submit",isDisabled:!u,children:i("save")}),e(E,{"data-testid":"reload",variant:q.link,onClick:()=>S(t),children:i("reload")})]})]})]})},Xt=()=>{const{t}=_(),[n,a]=k(1),{realm:i}=L(),[c,r]=k();return he(async()=>{const h=await w.realms.findOne({realm:i});if(!h)throw new Error(t("notFound"));return h},h=>{r(h)},[]),c?f(Rt,{activeKey:n,onSelect:(h,d)=>a(d),mountOnEnter:!0,unmountOnExit:!0,children:[e(H,{id:"passwordPolicy",eventKey:1,title:e(V,{children:t("passwordPolicy")}),children:e(Kt,{realm:c,realmUpdated:r})}),e(H,{id:"otpPolicy",eventKey:2,title:e(V,{children:t("otpPolicy")}),children:e(Dt,{realm:c,realmUpdated:r})}),e(H,{id:"webauthnPolicy",eventKey:3,title:e(V,{children:t("webauthnPolicy")}),children:e(Ee,{realm:c,realmUpdated:r})}),e(H,{id:"webauthnPasswordlessPolicy",eventKey:4,title:e(V,{children:t("webauthnPasswordlessPolicy")}),children:e(Ee,{realm:c,realmUpdated:r,isPasswordLess:!0})}),e(H,{"data-testid":"tab-ciba-policy",eventKey:5,title:e(V,{children:t("cibaPolicy")}),children:e(Vt,{realm:c,realmUpdated:r})})]}):e(be,{})},Y=new Map([["browserFlow","browser"],["registrationFlow","registration"],["directGrantFlow","direct grant"],["resetCredentialsFlow","reset credentials"],["clientAuthenticationFlow","clients"],["dockerAuthenticationFlow","docker auth"]]),Qt=({id:t,alias:n,usedBy:a,builtIn:i})=>{const{t:c}=_(),{realm:r}=L();return f($,{children:[e(He,{to:Ne({realm:r,id:t,usedBy:a?.type||"notInUse",builtIn:i?"builtIn":void 0}),children:n},`link-${t}`)," ",i&&e(ct,{children:c("buildIn")},`label-${t}`)]})};function Zt(){const{t}=_(),{realm:n}=L(),[a,i]=k(0),c=()=>{y(void 0),i(a+1)},{addAlert:r,addError:h}=U(),d=Ue(),[m,b]=k(),[A,l]=Q(),[p,u]=Q(),[g,y]=k();he(()=>w.realms.findOne({realm:n}),y,[a]);const S=async()=>{const M=await(await dt(`${pt(w.baseUrl)}admin/realms/${n}/ui-ext/authentication-management/flows`,{method:"GET",headers:ut(await w.getAccessToken())})).json();return M?kt(d(M,gt("alias")),Ye=>Ye.usedBy?.type):[]},v=I=>yt(Ie({realm:n,tab:I})),P=v("flows"),o=v("required-actions"),s=v("policies"),[R,O]=mt({titleKey:"deleteConfirmFlow",children:f(Nt,{i18nKey:"deleteConfirmFlowMessage",children:[" ",e("strong",{children:{flow:m?m.alias:""}}),"."]}),continueButtonLabel:"delete",continueButtonVariant:q.danger,onConfirm:async()=>{try{await w.authenticationManagement.deleteFlow({flowId:m.id}),c(),r(t("deleteFlowSuccess"),F.success)}catch(I){h("deleteFlowError",I)}}});return g?f($,{children:[e(O,{}),A&&e(Ot,{name:m?m.alias:"",description:m?.description,toggleDialog:l,onComplete:()=>{c(),l()}}),p&&e(xt,{onClose:()=>{u(),c()},flowAlias:m?.alias}),e(ft,{titleKey:"titleAuthentication",subKey:"authenticationExplain",helpUrl:rt.authenticationUrl,divider:!1}),e(G,{variant:"light",className:"pf-u-p-0",children:f(bt,{isBox:!0,defaultLocation:Ie({realm:n,tab:"flows"}),children:[e(H,{"data-testid":"flows",title:e(V,{children:t("flows")}),...P,children:e($e,{loader:S,ariaLabelKey:"titleAuthentication",searchPlaceholderKey:"searchForFlow",toolbarItem:e(Ge,{children:e(E,{component:I=>e(He,{...I,to:st({realm:n})}),children:t("createFlow")})}),actionResolver:({data:I})=>[{title:t("duplicate"),onClick:()=>{l(),b(I)}},...I.usedBy?.type!=="DEFAULT"?[{title:t("bindFlow"),onClick:()=>{u(),b(I)}}]:[],...!I.builtIn&&!I.usedBy?[{title:t("delete"),onClick:()=>{b(I),R()}}]:[]],columns:[{name:"alias",displayKey:"flowName",cellRenderer:I=>e(Qt,{...I})},{name:"usedBy",displayKey:"usedBy",cellRenderer:I=>e(Ht,{authType:I,realm:g})},{name:"description",displayKey:"description"}],emptyState:e(ht,{message:t("emptyEvents"),instructions:t("emptyEventsInstructions")})},a)}),e(H,{"data-testid":"requiredActions",title:e(V,{children:t("requiredActions")}),...o,children:e(Ft,{})}),e(H,{"data-testid":"policies",title:e(V,{children:t("policies")}),...s,children:e(Xt,{})})]})})]}):e(be,{})}const Sa=Object.freeze(Object.defineProperty({__proto__:null,REALM_FLOWS:Y,default:Zt},Symbol.toStringTag,{value:"Module"}));export{Sa as A,xt as B,Ot as D};
//# sourceMappingURL=AuthenticationSection-58qp3x_M.js.map
