import{jsxs as g,Fragment as q,jsx as e}from"react/jsx-runtime";import{useState as O}from"react";import{u as B,F as C,i as F,V as p,C as w,S as x,b as A,c as D,g as N,f as G,d as R,e as _,m as $,j as M,A as k,bT as K,r as z,O as J,P as Q,K as W,h as X,B as L,L as Y,H as Z,bV as ee,G as re}from"./index-sihFV1NS.js";import{u as te}from"./ConfirmDialog-WMVurgkl.js";import{D as ae}from"./DynamicComponents-f6aNOnzT.js";import{F as ie}from"./FormAccess-EK-4wbwg.js";import{K as U}from"./KeycloakTextInput--S1SG2UN.js";import{V as oe}from"./ViewHeader-xo54NRb6.js";import{u as se,m as ne}from"./useLocaleSort-K-jL4v2R.js";import{u as de}from"./useParams-OD1jI_R2.js";import{A as pe}from"./Form-bfj-xQZn.js";import"react-dom";import"./Modal-uOAPm2rX.js";import"./ClientSelect-sh5SEoBO.js";import"./FileUpload-LIezXv7x.js";import"./CodeEditor-7uqvO0EK.js";import"./copy-icon-WaWzxYgU.js";import"./EmptyStateBody-jnnI7hpP.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./GroupPickerDialog-gC2-xBPw.js";import"./PaginatingTableToolbar--Dt3wwL6.js";import"./TableToolbar-vuixsfwd.js";import"./ToolbarContent-46I9Yg7h.js";import"./useToggle-mZS4AEtR.js";import"./DataListItemRow-te2VcAoi.js";import"./data-list-CDN1kyj9.js";import"./grip-vertical-icon-accuSWkz.js";import"./_baseRest-lI6NnEVt.js";import"./ActionListItem-1jrwMZdM.js";import"./Flex-W2FoLD7u.js";import"./FlexItem-Mxf6oLng.js";import"./MultiLineInput-MBnUzZD_.js";import"./PasswordInput-P6txGPqu.js";import"./AddRoleMappingModal-uxjjMt5W.js";import"./KeycloakDataTable-Q3kZYP9q.js";import"./Td-uwYquKT4.js";import"./resource-BRtaBrSc.js";import"./filter-icon-0B3gA_nj.js";import"./KeycloakTextArea-NBwG1p2x.js";const le=({mapperTypes:t,mapperType:l,form:V,id:h,updateMapperType:b})=>{const{t:a}=B(),{control:u,register:I,formState:{errors:P}}=V,[y,i]=O(!1),n=["inherit","import","legacy","force"],[o,f]=O(!1);return g(q,{children:[e(C,{label:a("name"),labelIcon:e(F,{helpText:a("addIdpMapperNameHelp"),fieldLabelId:"name"}),fieldId:"kc-name",isRequired:!0,validated:P.name?p.error:p.default,helperTextInvalid:a("required"),children:e(U,{id:"kc-name",isDisabled:!!h,validated:P.name?p.error:p.default,...I("name",{required:!0})})}),e(C,{label:a("syncModeOverride"),isRequired:!0,labelIcon:e(F,{helpText:a("syncModeOverrideHelp"),fieldLabelId:"syncModeOverride"}),fieldId:"syncMode",children:e(w,{name:"config.syncMode",defaultValue:n[0].toUpperCase(),control:u,render:({field:d})=>e(x,{toggleId:"syncMode","datatest-id":"syncmode-select",required:!0,direction:"down",onToggle:()=>f(!o),onSelect:(r,c)=>{d.onChange(c.toString().toUpperCase()),f(!1)},selections:a(`syncModes.${d.value.toLowerCase()}`),variant:A.single,"aria-label":a("syncMode"),isOpen:o,children:n.map(r=>e(D,{selected:r===d.value,"data-testid":r,value:r.toUpperCase(),children:a(`syncModes.${r}`)},r))})})}),e(C,{label:a("mapperType"),labelIcon:e(F,{helpText:l.helpText,fieldLabelId:"mapperType"}),fieldId:"identityProviderMapper",children:e(w,{name:"identityProviderMapper",defaultValue:t[0].id,control:u,render:({field:d})=>e(x,{toggleId:"identityProviderMapper","data-testid":"idp-mapper-select",isDisabled:!!h,required:!0,onToggle:()=>i(!y),onSelect:(r,c)=>{const S=c;b(S),d.onChange(S.id),i(!1)},selections:l.name,variant:A.single,"aria-label":a("mapperType"),isOpen:y,children:t.map(r=>e(D,{selected:r===d.value,"datatest-id":r.id,value:r,children:r.name},r.name))})})})]})};function We(){const{t}=B(),l=N({shouldUnregister:!0}),{handleSubmit:V,register:h,formState:{errors:b}}=l,{addAlert:a,addError:u}=G(),I=R(),P=se(),{realm:y}=_(),{id:i,providerId:n,alias:o}=de(),[f,d]=O(),[r,c]=O(),S=async s=>{const T=Z(s),v={...T,config:{...T.config},identityProviderAlias:o};if(i)try{await M.identityProviders.updateMapper({id:i,alias:o},{...v,id:i}),a(t("mapperSaveSuccess"),k.success)}catch(m){u(t("mapperSaveError"),m)}else try{const m=await M.identityProviders.createMapper({identityProviderMapper:v,alias:o});a(t("mapperCreateSuccess"),k.success),I(ee({realm:y,alias:o,providerId:n,id:m.id}))}catch(m){u(t("mapperCreateError"),m)}},[j,E]=te({titleKey:"deleteProviderMapper",messageKey:t("deleteMapperConfirm",{mapper:r?.name}),continueButtonLabel:"delete",continueButtonVariant:$.danger,onConfirm:async()=>{try{await M.identityProviders.delMapper({alias:o,id:i}),a(t("deleteMapperSuccess"),k.success),I(K({providerId:n,alias:o,tab:"mappers",realm:y}))}catch(s){u("deleteErrorIdentityProvider",s)}}});z(()=>Promise.all([i?M.identityProviders.findOneMapper({alias:o,id:i}):null,M.identityProviders.findMapperTypes({alias:o})]),([s,T])=>{const v=P(Object.values(T),ne("name"));s?(c(v.find(({id:m})=>m===s.identityProviderMapper)),H(s)):c(v[0]),d(v)},[]);const H=s=>{re(s,l.setValue)};return!f||!r?e(J,{}):g(Q,{variant:"light",children:[e(E,{}),e(oe,{className:"kc-add-mapper-title",titleKey:i?t("editIdPMapper",{providerId:n[0].toUpperCase()+n.substring(1)}):t("addIdPMapper",{providerId:n[0].toUpperCase()+n.substring(1)}),dropdownItems:i?[e(W,{onClick:j,children:t("delete")},"delete")]:void 0,divider:!0}),g(ie,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:V(S),className:"pf-u-mt-lg",children:[i&&e(C,{label:t("id"),fieldId:"kc-name",validated:b.name?p.error:p.default,helperTextInvalid:t("required"),children:e(U,{value:r.id,id:"kc-name",isDisabled:!!i,validated:b.name?p.error:p.default,...h("name")})}),r.properties&&g(q,{children:[e(le,{form:l,id:i,mapperTypes:f,updateMapperType:c,mapperType:r}),e(X,{...l,children:e(ae,{properties:r.properties})})]}),g(pe,{children:[e(L,{"data-testid":"new-mapper-save-button",variant:"primary",type:"submit",children:t("save")}),e(L,{"data-testid":"new-mapper-cancel-button",variant:"link",component:s=>e(Y,{...s,to:K({realm:y,providerId:n,alias:o,tab:"mappers"})}),children:t("cancel")})]})]})]})}export{We as default};
//# sourceMappingURL=AddMapper-vRp-uIau.js.map
