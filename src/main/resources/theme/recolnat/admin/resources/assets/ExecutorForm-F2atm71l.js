import{jsxs as p,Fragment as R,jsx as t}from"react/jsx-runtime";import{useState as n}from"react";import{u as _,d as J,f as Q,a4 as U,g as W,r as X,P as Y,F as Z,i as S,C as $,S as ee,b as te,c as oe,h as re,B as h,L as V,dq as P,j as k,A as ie}from"./index-sihFV1NS.js";import{D as ce}from"./DynamicComponents-f6aNOnzT.js";import{F as se}from"./FormAccess-EK-4wbwg.js";import{V as ae}from"./ViewHeader-xo54NRb6.js";import{u as F}from"./useParams-OD1jI_R2.js";import{A as le}from"./Form-bfj-xQZn.js";import"react-dom";import"./ClientSelect-sh5SEoBO.js";import"./FileUpload-LIezXv7x.js";import"./CodeEditor-7uqvO0EK.js";import"./copy-icon-WaWzxYgU.js";import"./EmptyStateBody-jnnI7hpP.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./GroupPickerDialog-gC2-xBPw.js";import"./PaginatingTableToolbar--Dt3wwL6.js";import"./TableToolbar-vuixsfwd.js";import"./ToolbarContent-46I9Yg7h.js";import"./useToggle-mZS4AEtR.js";import"./KeycloakTextInput--S1SG2UN.js";import"./Modal-uOAPm2rX.js";import"./ConfirmDialog-WMVurgkl.js";import"./DataListItemRow-te2VcAoi.js";import"./data-list-CDN1kyj9.js";import"./grip-vertical-icon-accuSWkz.js";import"./_baseRest-lI6NnEVt.js";import"./ActionListItem-1jrwMZdM.js";import"./Flex-W2FoLD7u.js";import"./FlexItem-Mxf6oLng.js";import"./MultiLineInput-MBnUzZD_.js";import"./PasswordInput-P6txGPqu.js";import"./AddRoleMappingModal-uxjjMt5W.js";import"./useLocaleSort-K-jL4v2R.js";import"./KeycloakDataTable-Q3kZYP9q.js";import"./Td-uwYquKT4.js";import"./resource-BRtaBrSc.js";import"./filter-icon-0B3gA_nj.js";import"./KeycloakTextArea-NBwG1p2x.js";const I={config:{},executor:""};function We(){const{t:c}=_(),A=J(),{realm:m,profileName:a}=F(),{executorName:l}=F(),{addAlert:C,addError:H}=Q(),[N,T]=n(!1),d=U().componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[f,O]=n([]),[B,D]=n([]),[v,G]=n([]),[L,j]=n([]),x=W({defaultValues:I}),{control:w,reset:y,handleSubmit:q}=x,r=!!l,E=e=>{const o=e.find(s=>s.name===a)?.executors?.find(s=>s.executor===l);o&&y({config:o.configuration})};X(()=>k.clientPolicies.listProfiles({includeGlobalProfiles:!0}),e=>{G(e.globalProfiles),j(e.profiles),E(e.profiles),E(e.globalProfiles)},[]);const z=async()=>{const e=x.getValues(),i=L.map(o=>{if(o.name!==a)return o;const s=(o.executors??[]).concat({executor:e.executor,configuration:e.config||{}});if(r){const u=o.executors.find(M=>M.executor===l);u.configuration={...u.configuration,...e.config}}return r?o:{...o,executors:s}});try{await k.clientPolicies.createProfiles({profiles:i,globalProfiles:v}),C(c(r?"updateExecutorSuccess":"addExecutorSuccess"),ie.success),A(P({realm:m,profileName:a}))}catch(o){H(r?"updateExecutorError":"addExecutorError",o)}},g=v.find(e=>e.name===a),b=d?.find(e=>e.id===l),K=b?.properties.map(e=>{const i=r?e.defaultValue:"";return{...e,defaultValue:i}});return p(R,{children:[t(ae,{titleKey:r?l:c("addExecutor"),divider:!0}),p(Y,{variant:"light",children:[p(se,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",isReadOnly:!!g,children:[t(Z,{label:c("executorType"),fieldId:"kc-executorType",labelIcon:f.length>0&&f[0].helpText!==""?t(S,{helpText:f[0].helpText,fieldLabelId:"executorTypeHelpText"}):r?t(S,{helpText:b?.helpText,fieldLabelId:"executorTypeHelpText"}):void 0,children:t($,{name:"executor",defaultValue:"",control:w,render:({field:e})=>t(ee,{toggleId:"kc-executor",placeholderText:"Select an executor",onToggle:i=>T(i),onSelect:(i,o)=>{y({...I,executor:o.toString()});const s=d?.filter(u=>u.id===o);O(s??[]),D(s?.[0].properties??[]),T(!1)},selections:r?l:e.value,variant:te.single,"data-testid":"executorType-select","aria-label":c("executorType"),isOpen:N,maxHeight:580,isDisabled:r,children:d?.map(i=>t(oe,{selected:i.id===e.value,value:i.id,description:i.helpText},i.id))})})}),t(re,{...x,children:t(ce,{properties:r?K:B})}),!g&&p(le,{children:[t(h,{variant:"primary",onClick:()=>q(z)(),"data-testid":"addExecutor-saveBtn",children:c(r?"save":"add")}),t(h,{variant:"link",component:e=>t(V,{...e,to:P({realm:m,profileName:a})}),"data-testid":"addExecutor-cancelBtn",children:c("cancel")})]})]}),r&&g&&t("div",{className:"kc-backToProfile",children:t(h,{component:e=>t(V,{...e,to:P({realm:m,profileName:a})}),variant:"primary",children:c("back")})})]})]})}export{We as default};
//# sourceMappingURL=ExecutorForm-F2atm71l.js.map
