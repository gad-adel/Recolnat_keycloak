import{jsx as e,Fragment as N,jsxs as y}from"react/jsx-runtime";import*as M from"react";import{useState as O,useCallback as dt,useMemo as Ye}from"react";import{av as G,_ as ut,br as pt,aM as mt,l as ae,bs as ht,Y as ft,bt as gt,o as Tt,bu as It,bv as ke,bw as vt,u as D,a as V,r as ee,j as E,F as P,i as $,C as w,b as Z,S as me,c as te,R as de,e as Ct,d as Je,m as ne,aS as yt,B as q,$ as St,a0 as bt,L as Xe,aK as Qe,aV as xt,I as ve,bx as Ot,J as Ce,as as Ne,K as Pe,bo as De,a3 as Re,V as H,a1 as Ze,a2 as ie,g as kt,f as Pt,O as $t,P as Dt,h as Rt,b7 as we,A as Ve,X as Mt,z as Fe,D as At}from"./index-sihFV1NS.js";import{u as et}from"./ConfirmDialog-WMVurgkl.js";import{F as Et}from"./FormAccess-EK-4wbwg.js";import{V as Nt}from"./ViewHeader-xo54NRb6.js";import{u as tt}from"./useParams-OD1jI_R2.js";import{u as nt,m as it}from"./useLocaleSort-K-jL4v2R.js";import{M as rt,a as ot}from"./Modal-uOAPm2rX.js";import{T as he,O as fe,P as Y,Q as K,R as ge,S as j}from"./Td-uwYquKT4.js";import{u as ue}from"./useToggle-mZS4AEtR.js";import{h as wt}from"./ClientScopeTypes-Hwl8E8GJ.js";import{L as Vt}from"./PaginatingTableToolbar--Dt3wwL6.js";import{K as Ft}from"./KeycloakDataTable-Q3kZYP9q.js";import{g as Lt}from"./utils-9X4NJJvK.js";import{F as Le}from"./filter-icon-0B3gA_nj.js";import{G as _t}from"./GroupPickerDialog-gC2-xBPw.js";import{K as pe}from"./KeycloakTextInput--S1SG2UN.js";import{C as Ht,L as qt}from"./CodeEditor-7uqvO0EK.js";import{K as Ut}from"./KeycloakTextArea-NBwG1p2x.js";import{A as Gt,S as Kt}from"./AddRoleMappingModal-uxjjMt5W.js";import{d as le,D as jt}from"./DatePicker-zM1UwT7F.js";import{m as ye,M as Bt,a as zt,b as Wt,c as Yt}from"./MenuList-82IaVNxu.js";import{F as Jt}from"./Flex-W2FoLD7u.js";import{F as _e}from"./FlexItem-Mxf6oLng.js";import{N as Xt}from"./NumberInput-QtFengwl.js";import{A as Qt}from"./Form-bfj-xQZn.js";const z=" AM",W=" PM",Zt=(t,i,r,l,c,u)=>{const d=[],p=new Date(new Date().setHours(0,0,0,0)),f=p.getDay();for(;p.getDay()===f;){let m=p.getHours(),n=z;i&&(m===0?m=12:m>=12&&(n=W),m>12&&(m%=12)),m=i?m.toString():m.toString().padStart(2,"0");const s=p.getMinutes().toString().padStart(2,"0"),o=`${m}${r}${s}${i?n:""}`;at(l,c,o,r,u)&&d.push(o),p.setMinutes(p.getMinutes()+t)}return d},B=(t,i,r,l,c)=>{const u=new Date(t);if(!isNaN(u.getDate())&&(t instanceof Date||t.includes("T"))){const d=l?`${u.getHours()>12?u.getHours()-12:u.getHours()}`:`${u.getHours()}`.padStart(2,"0"),p=`${u.getMinutes()}`.padStart(2,"0"),f=c?`${u.getSeconds()}`.padStart(2,"0"):"",m=f?`${r}${f}`:"";let n="";return l&&u.getHours()>11?n=W:l&&(n=z),`${d}${r}${p}${m}${n}`}else if(typeof t=="string"&&(t=t.trim(),t!==""&&st(t,i,r,l))){const[,d,p,f,m=""]=i.exec(t),n=c?`${r}${f??"00"}`:"";let s="";if(l){const o=m.toUpperCase();o===z.toUpperCase().trim()?s=z:o===W.toUpperCase().trim()?s=W:s=new Date().getHours()>11?W:z}return`${d}${r}${p}${n}${s}`}return t.toString()},st=(t,i,r,l)=>{const c=new Date(t);if(!isNaN(c.getDate())&&t.includes("T"))return!0;const u=parseInt(t.split(r)[0]),d=u>=(l?1:0)&&u<=(l?12:23);return t===""||i.test(t)&&d},He=(t,i)=>{const r=t.match(i);return r&&r.length?/pm/i.test(r[4])?parseInt(r[1])===12?parseInt(r[1]):parseInt(r[1])+12:/am/i.test(r[4])&&parseInt(r[1])===12?0:parseInt(r[1]):null},qe=(t,i)=>{const r=t.match(i);return r&&r.length?parseInt(r[2]):null},Ue=(t,i)=>{var r;const l=(r=t.match(i))===null||r===void 0?void 0:r[3];return l?parseInt(l):null},at=(t,i,r,l,c)=>{if(r.trim()==="")return!0;const u=Se(t,l,c),d=Se(r,l,c),p=Se(i,l,c);return u<=d&&d<=p},Se=(t,i,r)=>{const c=new RegExp(`^\\s*(\\d\\d?)${i}([0-5]\\d)${i}?([0-5]\\d)?\\s*([AaPp][Mm])?\\s*$`).exec(t);if(!c||!c.length)return;let u=c[1].padStart(2,"0");const d=c[2];let p=c[3]?`${i}${c[3]}`:"";!p&&r&&(p=`${i}00`);const f=c[4]||"";return f.toUpperCase()==="PM"&&u!=="12"?u=`${parseInt(u)+12}`:f.toUpperCase()==="AM"&&u==="12"&&(u="00"),`${u}${i}${d}${p}`};class Me extends M.Component{constructor(i){super(i),this.baseComponentRef=M.createRef(),this.toggleRef=M.createRef(),this.inputRef=M.createRef(),this.menuRef=M.createRef(),this.onDocClick=n=>{var s,o,a,h;const T=(o=(s=this.toggleRef)===null||s===void 0?void 0:s.current)===null||o===void 0?void 0:o.contains(n.target),S=(h=(a=this.menuRef)===null||a===void 0?void 0:a.current)===null||h===void 0?void 0:h.contains(n.target);this.state.isTimeOptionsOpen&&!(T||S)&&this.onToggle(!1)},this.handleGlobalKeys=n=>{var s,o,a,h;const{isTimeOptionsOpen:T,focusedIndex:S,scrollIndex:x}=this.state;!((o=(s=this.inputRef)===null||s===void 0?void 0:s.current)===null||o===void 0)&&o.contains(n.target)?!T&&n.key!==G.Tab&&n.key!==G.Escape?this.onToggle(!0):T&&(n.key===G.Escape||n.key===G.Tab?this.onToggle(!1):n.key===G.Enter?S!==null?(this.focusSelection(S),n.stopPropagation()):this.onToggle(!1):(n.key===G.ArrowDown||n.key===G.ArrowUp)&&(this.focusSelection(x),this.updateFocusedIndex(0),n.preventDefault())):!((h=(a=this.menuRef)===null||a===void 0?void 0:a.current)===null||h===void 0)&&h.contains(n.target)&&(n.key===G.ArrowDown?(this.updateFocusedIndex(1),n.preventDefault()):n.key===G.ArrowUp?(this.updateFocusedIndex(-1),n.preventDefault()):(n.key===G.Escape||n.key===G.Tab)&&(this.inputRef.current.focus(),this.onToggle(!1)))},this.updateFocusedIndex=n=>{this.setState(s=>{const o=this.getOptions().length-1;let a=s.focusedIndex!==null?s.focusedIndex+n:s.scrollIndex+n;return a<0?a=o:a>o&&(a=0),this.scrollToIndex(a),{focusedIndex:a}})},this.getIndexToScroll=n=>this.props.menuAppendTo==="inline"?n>0?n-1:0:n,this.scrollToIndex=n=>{this.getOptions()[n].closest(`.${ye.menuContent}`).scrollTop=this.getOptions()[this.getIndexToScroll(n)].offsetTop},this.focusSelection=n=>{var s;const o=n!==-1?n:0;!((s=this.menuRef)===null||s===void 0)&&s.current&&this.getOptions()[o].querySelector(`.${ye.menuItem}`).focus()},this.scrollToSelection=n=>{const{delimiter:s,is24Hour:o}=this.props;let a=n.split(this.props.delimiter),h=null;if(a.length<2?(n=`${n}${s}00`,a=n.split(s)):a.length>2&&(n=B(n,this.state.timeRegex,s,!o,!1),a=n.split(s)),!o&&a.length>1&&a[1].length<2){const S=a[1].length===0?"00":a[1]+"0";n=`${a[0]}${s}${S}${new Date().getHours()>11?W:z}`}else!o&&a.length>1&&a[1].length===2&&!n.toUpperCase().includes(z.toUpperCase().trim())&&!n.toUpperCase().includes(W.toUpperCase().trim())&&(n=`${n}${new Date().getHours()>11?W:z}`);let T=this.getOptions().findIndex(S=>S.textContent===n);if(T!==-1)this.scrollToIndex(T),h=T;else if(a.length===2){let S="";o||(a[1].toUpperCase().includes("P")?S=W:a[1].toUpperCase().includes("A")&&(S=z)),n=`${a[0]}${s}00${S}`,T=this.getOptions().findIndex(x=>x.textContent===n),T!==-1&&this.scrollToIndex(T)}this.setState({focusedIndex:h,scrollIndex:T})},this.getRegExp=(n=!0)=>{const{is24Hour:s,delimiter:o}=this.props;let a=`\\s*(\\d\\d?)${o}([0-5]\\d)`;return n&&(a+=`${o}?([0-5]\\d)?`),new RegExp(`^${a}${s?"":"\\s*([AaPp][Mm])?"}\\s*$`)},this.getOptions=()=>{var n;return!((n=this.menuRef)===null||n===void 0)&&n.current?Array.from(this.menuRef.current.querySelectorAll(`.${ye.menuListItem}`)):[]},this.isValidFormat=n=>{if(this.props.validateTime)return this.props.validateTime(n);const{delimiter:s,is24Hour:o,includeSeconds:a}=this.props;return st(n,this.getRegExp(a),s,!o)},this.isValidTime=n=>{const{delimiter:s,includeSeconds:o}=this.props,{minTimeState:a,maxTimeState:h}=this.state;return at(a,h,n,s,o)},this.isValid=n=>this.isValidFormat(n)&&this.isValidTime(n),this.onToggle=n=>{this.setState(s=>{const{timeRegex:o,isInvalid:a,timeState:h}=s,{delimiter:T,is24Hour:S,includeSeconds:x,onChange:A}=this.props,g=B(h,o,T,!S,x);return A&&!n&&g!==h&&A(null,g,He(g,o),qe(g,o),Ue(g,o),this.isValid(g)),{isTimeOptionsOpen:n,timeState:g,isInvalid:n?a:!this.isValid(g)}}),this.props.setIsOpen(n),n||this.inputRef.current.focus()},this.onSelect=n=>{const{timeRegex:s,timeState:o}=this.state,{delimiter:a,is24Hour:h,includeSeconds:T,setIsOpen:S}=this.props,x=B(n.target.textContent,s,a,!h,T);x!==o&&this.onInputChange(x,n),this.inputRef.current.focus(),this.setState({isTimeOptionsOpen:!1,isInvalid:!1}),S(!1)},this.onInputClick=n=>{this.state.isTimeOptionsOpen||this.onToggle(!0),n.stopPropagation()},this.onInputChange=(n,s)=>{const{onChange:o}=this.props,{timeRegex:a}=this.state;o&&o(s,n,He(n,a),qe(n,a),Ue(n,a),this.isValid(n)),this.scrollToSelection(n),this.setState({timeState:n})};const{is24Hour:r,delimiter:l,time:c,includeSeconds:u,isOpen:d}=this.props;let{minTime:p,maxTime:f}=this.props;if(p===""){const n=u?`${l}00`:"";p=r?`00${l}00${n}`:`12${l}00${n} AM`}if(f===""){const n=u?`${l}59`:"";f=r?`23${l}59${n}`:`11${l}59${n} PM`}const m=this.getRegExp();this.state={isInvalid:!1,isTimeOptionsOpen:d,timeState:B(c,m,l,!r,u),focusedIndex:null,scrollIndex:0,timeRegex:m,minTimeState:B(p,m,l,!r,u),maxTimeState:B(f,m,l,!r,u)}}componentDidMount(){document.addEventListener("mousedown",this.onDocClick),document.addEventListener("touchstart",this.onDocClick),document.addEventListener("keydown",this.handleGlobalKeys),this.setState({isInvalid:!this.isValid(this.state.timeState)})}componentWillUnmount(){document.removeEventListener("mousedown",this.onDocClick),document.removeEventListener("touchstart",this.onDocClick),document.removeEventListener("keydown",this.handleGlobalKeys)}componentDidUpdate(i,r){const{timeState:l,isTimeOptionsOpen:c,isInvalid:u,timeRegex:d}=this.state,{time:p,is24Hour:f,delimiter:m,includeSeconds:n,isOpen:s,minTime:o,maxTime:a}=this.props;if(i.isOpen!==s&&this.onToggle(s),c&&!r.isTimeOptionsOpen&&l&&!u&&this.scrollToSelection(l),m!==i.delimiter&&this.setState({timeRegex:this.getRegExp()}),p!==""&&p!==i.time){const h=B(p,d,m,!f,n);this.setState({timeState:h,isInvalid:!this.isValid(h)})}o!==""&&o!==i.minTime&&this.setState({minTimeState:B(o,d,m,!f,n)}),a!==""&&a!==i.maxTime&&this.setState({maxTimeState:B(a,d,m,!f,n)})}render(){const i=this.props,{"aria-label":r,isDisabled:l,className:c,placeholder:u,id:d,menuAppendTo:p,is24Hour:f,invalidFormatErrorMessage:m,invalidMinMaxErrorMessage:n,stepMinutes:s,width:o,delimiter:a,inputProps:h,onChange:T,setIsOpen:S,isOpen:x,time:A,validateTime:g,minTime:v,maxTime:F,includeSeconds:b,removeFindDomNode:R,zIndex:C}=i,_=ut(i,["aria-label","isDisabled","className","placeholder","id","menuAppendTo","is24Hour","invalidFormatErrorMessage","invalidMinMaxErrorMessage","stepMinutes","width","delimiter","inputProps","onChange","setIsOpen","isOpen","time","validateTime","minTime","maxTime","includeSeconds","removeFindDomNode","zIndex"]),{timeState:J,isTimeOptionsOpen:Te,isInvalid:re,minTimeState:oe,maxTimeState:Ie}=this.state,I={"--pf-c-date-picker__input--c-form-control--Width":o},X=Zt(s,!f,a,oe,Ie,b),k=this.isValidFormat(J),L=d||pt("time-picker"),U=()=>this.baseComponentRef&&this.baseComponentRef.current?this.baseComponentRef.current.parentElement:null,Q=M.createElement(Bt,{ref:this.menuRef,isScrollable:!0},M.createElement(zt,{maxMenuHeight:"200px"},M.createElement(Wt,{"aria-label":r},X.map((Ee,ct)=>M.createElement(Yt,{onClick:this.onSelect,key:Ee,id:`${L}-option-${ct}`},Ee))))),lt=M.createElement(mt,Object.assign({"aria-haspopup":"menu",className:ae(ht.formControl),id:`${L}-input`,"aria-label":r,validated:re?"error":"default",placeholder:u,value:J||"",type:"text",iconVariant:"clock",onClick:this.onInputClick,onChange:this.onInputChange,autoComplete:"off",isDisabled:l,ref:this.inputRef},h));let se;switch(p){case"inline":se=()=>this.toggleRef.current;break;case"parent":se=U;break;default:se=p}return M.createElement("div",{ref:this.baseComponentRef,className:ae(le.datePicker,c)},M.createElement("div",Object.assign({className:ae(le.datePickerInput),style:I},_),M.createElement(ft,null,M.createElement("div",{id:L},M.createElement("div",{ref:this.toggleRef,style:{paddingLeft:"0"}},M.createElement(gt,{appendTo:se,trigger:lt,popper:Q,isVisible:Te,removeFindDomNode:R,zIndex:C})))),re&&M.createElement("div",{className:ae(le.datePickerHelperText,le.modifiers.error)},k?n:m)))}}Me.displayName="TimePicker";Me.defaultProps={className:"",isDisabled:!1,time:"",is24Hour:!1,invalidFormatErrorMessage:"Invalid time format",invalidMinMaxErrorMessage:"Invalid time entered",placeholder:"hh:mm",delimiter:":","aria-label":"Time picker",width:"150px",menuAppendTo:"inline",stepMinutes:30,inputProps:{},minTime:"",maxTime:"",isOpen:!1,setIsOpen:()=>{},removeFindDomNode:!1,zIndex:9999};const en={name:"CaretUpIcon",height:512,width:320,svgPath:"M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z",yOffset:0,xOffset:0},tn=Tt(en);var nn=/\s/;function rn(t){for(var i=t.length;i--&&nn.test(t.charAt(i)););return i}var on=/^\s+/;function sn(t){return t&&t.slice(0,rn(t)+1).replace(on,"")}var Ge=0/0,an=/^[-+]0x[0-9a-f]+$/i,ln=/^0b[01]+$/i,cn=/^0o[0-7]+$/i,dn=parseInt;function Ke(t){if(typeof t=="number")return t;if(It(t))return Ge;if(ke(t)){var i=typeof t.valueOf=="function"?t.valueOf():t;t=ke(i)?i+"":i}if(typeof t!="string")return t===0?t:+t;t=sn(t);var r=ln.test(t);return r||cn.test(t)?dn(t.slice(2),r?2:8):an.test(t)?Ge:+t}var un=function(){return vt.Date.now()};const be=un;var pn="Expected a function",mn=Math.max,hn=Math.min;function fn(t,i,r){var l,c,u,d,p,f,m=0,n=!1,s=!1,o=!0;if(typeof t!="function")throw new TypeError(pn);i=Ke(i)||0,ke(r)&&(n=!!r.leading,s="maxWait"in r,u=s?mn(Ke(r.maxWait)||0,i):u,o="trailing"in r?!!r.trailing:o);function a(b){var R=l,C=c;return l=c=void 0,m=b,d=t.apply(C,R),d}function h(b){return m=b,p=setTimeout(x,i),n?a(b):d}function T(b){var R=b-f,C=b-m,_=i-R;return s?hn(_,u-C):_}function S(b){var R=b-f,C=b-m;return f===void 0||R>=i||R<0||s&&C>=u}function x(){var b=be();if(S(b))return A(b);p=setTimeout(x,T(b))}function A(b){return p=void 0,o&&l?a(b):(l=c=void 0,d)}function g(){p!==void 0&&clearTimeout(p),m=0,l=f=c=p=void 0}function v(){return p===void 0?d:A(be())}function F(){var b=be(),R=S(b);if(l=arguments,c=this,f=b,R){if(p===void 0)return h(f);if(s)return clearTimeout(p),p=setTimeout(x,i),a(f)}return p===void 0&&(p=setTimeout(x,i)),d}return F.cancel=g,F.flush=v,F}const gn=({name:t,label:i,helpText:r,defaultValue:l,isRequired:c,variant:u=Z.typeaheadMulti})=>{const{t:d}=D(),{control:p,getValues:f,formState:{errors:m}}=V(),n=f(t),[s,o]=ue(),[a,h]=O([]),[T,S]=O(""),x=dt(fn(S,1e3),[]);ee(()=>{const g={max:20};return T&&(g.username=T),n?.length&&!T?Promise.all(n.map(v=>E.users.findOne({id:v}))):E.users.find(g)},h,[T]);const A=g=>g.filter(v=>v!==void 0).map(v=>e(te,{value:v.id,selected:n?.includes(v.id),children:v.username},v.id));return e(P,{label:d(i),isRequired:c,labelIcon:e($,{helpText:r,fieldLabelId:i}),fieldId:t,validated:m[t]?"error":"default",helperTextInvalid:d("required"),children:e(w,{name:t,defaultValue:l,control:p,rules:c&&u===Z.typeaheadMulti?{validate:g=>g.length>0}:{required:c},render:({field:g})=>e(me,{toggleId:t,variant:u,placeholderText:d("selectAUser"),onToggle:o,isOpen:s,selections:g.value,onFilter:(v,F)=>(x(F),A(a)),onSelect:(v,F)=>{const b=F.toString();if(u!==Z.typeaheadMulti)g.value.includes(b)?g.onChange([]):g.onChange([b]);else{const R=g.value.find(C=>C===b)?g.value.filter(C=>C!==b):[...g.value,b];g.onChange(R)}o()},"aria-label":d(t),children:A(a)})})})},xe=["UNANIMOUS","AFFIRMATIVE","CONSENSUS"],Tn=({helpLabel:t,isLimited:i=!1})=>{const{t:r}=D(),{control:l}=V();return e(P,{label:r("decisionStrategy"),labelIcon:e($,{helpText:r(`${t||"decisionStrategyHelp"}`),fieldLabelId:"decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e(w,{name:"decisionStrategy","data-testid":"decisionStrategy",defaultValue:xe[0],control:l,render:({field:c})=>e(N,{children:(i?xe.slice(0,2):xe).map(u=>e(de,{id:u,"data-testid":u,isChecked:c.value===u,name:"decisionStrategy",onChange:()=>c.onChange(u),label:r(`decisionStrategies.${u}`),className:"pf-u-mb-md"},u))})})})},In={resources:{searchFunction:"listResources",fetchFunction:"getAssociatedResources"},policies:{searchFunction:"listPolicies",fetchFunction:"getAssociatedPolicies"}},vn=({name:t,clientId:i,permissionId:r,variant:l=Z.typeaheadMulti,preSelected:c,isRequired:u=!1})=>{const{realm:d}=Ct(),{t:p}=D(),f=Je(),{control:m,formState:{errors:n,isDirty:s}}=V(),[o,a]=O([]),[h,T]=O(""),[S,x]=O(!1),[A,g]=ue(),[v,F]=O(),[b,R]=O(),C=In[t],_=I=>({id:"_id"in I?I._id:"id"in I?I.id:void 0,name:I.name,type:I.type});ee(async()=>{const I=Object.assign({id:i,first:0,max:10,permission:"false"},h===""?null:{name:h});return await Promise.all([E.clients.listPolicyProviders({id:i}),E.clients[C.searchFunction](I),r?E.clients[C.fetchFunction]({id:i,permissionId:r}):Promise.resolve([])])},([I,...X])=>{F(I.filter(k=>k.type!=="resource"&&k.type!=="scope")),a(X.flat().filter(k=>typeof k!="string").map(_).filter(({id:k},L,U)=>L===U.findIndex(({id:Q})=>k===Q)))},[h]);const[J,Te]=et({titleKey:p("unsavedChangesTitle"),messageKey:p("unsavedChangesConfirm"),continueButtonLabel:p("continue"),continueButtonVariant:ne.danger,onConfirm:()=>b?.()}),re=I=>t==="policies"?Qe({realm:d,id:i,policyId:I.id,policyType:I.type}):xt({realm:d,id:i,resourceId:I.id}),oe=()=>o.map(I=>e(te,{value:I.id,children:I.name},I.id)),Ie=I=>e(St,{children:I.value?.map(X=>{const k=o.find(U=>U.id===X);if(!k)return;const L=re(k);return e(bt,{onClick:()=>{I.onChange(I.value?.filter(U=>U!==k.id))},children:e(Xe,{to:L,onClick:U=>{s&&(U.preventDefault(),R(()=>()=>f(L)),J())},children:k.name})},k.id)})});return y(N,{children:[e(Te,{}),A&&e(En,{policyProviders:v,onSelect:I=>{f(yt({id:i,realm:d,policyType:I.type}))},toggleDialog:g}),e(w,{name:t,defaultValue:c?[c]:[],control:m,rules:{validate:I=>!u||I.length>0},render:({field:I})=>e(me,{toggleId:t,variant:l,onToggle:x,onFilter:(X,k)=>(T(k),oe()),onClear:()=>{I.onChange([]),T("")},selections:I.value,onSelect:(X,k)=>{const L=k.toString();if(l===Z.typeaheadMulti){const U=I.value?.find(Q=>Q===L)?I.value.filter(Q=>Q!==L):[...I.value,L];I.onChange(U)}else I.onChange([L]);T("")},isOpen:S,"aria-labelledby":p(t),isDisabled:!!c,validated:n[t]?"error":"default",typeAheadAriaLabel:p(t),chipGroupComponent:Ie(I),footer:t==="policies"?e(q,{variant:"link",isInline:!0,onClick:()=>{s?(x(!1),R(()=>g),J()):g()},children:p("createPolicy")}):void 0,children:oe()})})]})},Cn=()=>{const{t}=D(),{id:i}=tt();return y(N,{children:[e(P,{label:t("applyPolicy"),fieldId:"policies",labelIcon:e($,{helpText:t("applyPolicyHelp"),fieldLabelId:"policies"}),children:e(vn,{name:"policies",clientId:i})}),e(Tn,{helpLabel:"policyDecisionStagey"})]})},yn=()=>{const{t}=D(),{control:i,getValues:r,formState:{errors:l}}=V(),c=r("clients"),[u,d]=O(!1),[p,f]=O([]),[m,n]=O("");ee(async()=>{const o={max:20};return m&&(o.clientId=m,o.search=!0),c?.length&&!m?await Promise.all(c.map(a=>E.clients.findOne({id:a}))):await E.clients.find(o)},f,[m]);const s=o=>o.map(a=>e(te,{value:a.id,selected:c?.includes(a.id),children:a.clientId},a.id));return e(P,{label:t("clients"),labelIcon:e($,{helpText:t("policyClientHelp"),fieldLabelId:"client"}),fieldId:"clients",helperTextInvalid:t("requiredClient"),validated:l.clients?"error":"default",isRequired:!0,children:e(w,{name:"clients",defaultValue:[],control:i,rules:{validate:o=>o.length>0},render:({field:o})=>e(me,{toggleId:"clients",variant:Z.typeaheadMulti,onToggle:a=>d(a),isOpen:u,selections:o.value,onFilter:(a,h)=>(n(h),s(p)),onSelect:(a,h)=>{const T=h.toString();o.value.includes(T)?o.onChange(o.value.filter(S=>S!==T)):o.onChange([...o.value,T]),d(!1)},"aria-label":t("clients"),children:s(p)})})})},Sn=({clientScopes:t,clientName:i,open:r,toggleDialog:l,onAdd:c,isClientScopesConditionType:u})=>{const{t:d}=D(),[p,f]=O(!1),[m,n]=O([]),[s,o]=O("Name"),[a,h]=O("All"),[T,S]=ue(),[x,A]=ue(!1),g=Ye(()=>a==="OpenID Connect"?t.filter(C=>C.protocol==="openid-connect"):a==="SAML"?t.filter(C=>C.protocol==="saml"):t,[t,s,a]),v=C=>{const _=m.map(J=>({scope:J,type:C}));c(_),f(!1),l()},F=C=>{C==="Name"?o("Protocol"):C==="Protocol"&&(o("Name"),h("All")),S()},b=C=>{C==="SAML"?h("SAML"):C==="OpenID Connect"?h("OpenID Connect"):C==="All"&&h("All"),A()},R=[e(te,{value:"SAML",children:d("protocolTypes.saml")},1),e(te,{value:"OpenID Connect",children:d("protocolTypes.openid-connect")},2),e(te,{value:"All",isPlaceholder:!0,children:d("protocolTypes.all")},3)];return e(rt,{variant:ot.medium,title:u?d("addClientScope"):d("addClientScopesTo",{clientName:i}),isOpen:r,onClose:l,actions:u?[e(q,{id:"modal-add","data-testid":"confirm",variant:ne.primary,onClick:()=>{const C=m.map(_=>({scope:_}));c(C),l()},isDisabled:m.length===0,children:d("add")},"add"),e(q,{id:"modal-cancel","data-testid":"cancel",variant:ne.link,onClick:()=>{n([]),l()},children:d("cancel")},"cancel")]:[e(ve,{className:"keycloak__client-scopes-add__add-dropdown",id:"add-dropdown",direction:Ot.up,isOpen:p,toggle:e(Ce,{isDisabled:m.length===0,onToggle:()=>f(!p),isPrimary:!0,toggleIndicator:tn,id:"add-scope-toggle",children:d("add")}),dropdownItems:wt(d,v)},"add-dropdown"),e(q,{id:"modal-cancel",variant:ne.link,onClick:()=>{n([]),l()},children:d("cancel")},"cancel")],children:e(Ft,{loader:g,ariaLabelKey:"chooseAMapperType",searchPlaceholderKey:s==="Name"?"searchForClientScope":void 0,isSearching:s!=="Name",searchTypeComponent:e(ve,{onSelect:()=>{F(s)},"data-testid":"filter-type-dropdown",toggle:e(Ce,{id:"toggle-id-9",onToggle:S,toggleIndicator:Ne,icon:e(Le,{}),children:s}),isOpen:T,dropdownItems:[e(Pe,{"data-testid":"filter-type-dropdown-item",children:d(s==="Name"?"protocol":"name")},"filter-type")]}),toolbarItem:s==="Protocol"&&y(N,{children:[e(ve,{onSelect:()=>{F(s)},"data-testid":"filter-type-dropdown",toggle:e(Ce,{id:"toggle-id-9",onToggle:S,toggleIndicator:Ne,icon:e(Le,{}),children:s}),isOpen:T,dropdownItems:[e(Pe,{"data-testid":"filter-type-dropdown-item",children:d("name")},"filter-type")]}),e(me,{variant:Z.single,className:"kc-protocolType-select","aria-label":d("selectOne"),onToggle:A,onSelect:(C,_)=>b(_.toString()),selections:a,isOpen:x,children:R})]}),canSelectAll:!0,onSelect:C=>n(C),columns:[{name:"name"},{name:"protocol",displayKey:"protocol",cellRenderer:C=>Lt(d,C.protocol??"openid-connect")},{name:"description"}],emptyState:e(Vt,{message:d("emptyAddClientScopes"),instructions:d("emptyAddClientScopesInstructions")})})})},bn=()=>{const{t}=D(),{control:i,getValues:r,setValue:l,formState:{errors:c}}=V(),[u,d]=O(!1),[p,f]=O([]),[m,n]=O([]),s=nt();return ee(()=>E.clientScopes.find(),o=>{n(r("clientScopes").map(a=>o.find(h=>h.id===a.id))),f(s(o,it("name")))},[]),y(P,{label:t("clientScopes"),labelIcon:e($,{helpText:t("clientsClientScopesHelp"),fieldLabelId:"clientScopes"}),fieldId:"clientScopes",helperTextInvalid:t("requiredClientScope"),validated:c.clientScopes?"error":"default",isRequired:!0,children:[e(w,{name:"clientScopes",control:i,defaultValue:[],rules:{validate:o=>o.filter(a=>a.id).length>0},render:({field:o})=>y(N,{children:[u&&e(Sn,{clientScopes:p.filter(a=>!o.value.map(h=>h.id).includes(a.id)),isClientScopesConditionType:!0,open:u,toggleDialog:()=>d(!u),onAdd:a=>{n([...m,...a.map(h=>h.scope)]),o.onChange([...o.value,...a.map(h=>h.scope).map(h=>({id:h.id,required:!1}))])}}),e(q,{"data-testid":"select-scope-button",variant:"secondary",onClick:()=>{d(!0)},children:t("addClientScopes")})]})}),m.length>0&&y(he,{variant:"compact",children:[e(fe,{children:y(Y,{children:[e(K,{children:t("clientScopeTitle")}),e(K,{children:t("required")}),e(K,{"aria-hidden":"true"})]})}),e(ge,{children:m.map((o,a)=>y(Y,{children:[e(j,{children:o.name}),e(j,{children:e(w,{name:`clientScopes.${a}.required`,defaultValue:!1,control:i,render:({field:h})=>e(De,{id:"required","data-testid":"standard",name:"required",isChecked:h.value,onChange:h.onChange})})}),e(j,{children:e(q,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Re,{}),onClick:()=>{l("clientScopes",[...r("clientScopes").filter(h=>h.id!==o.id)]),n([...m.filter(h=>h.id!==o.id)])}})})]},o.id))})]})]})},xn=()=>{const{t}=D(),{control:i,register:r,getValues:l,setValue:c,formState:{errors:u}}=V(),d=l("groups"),[p,f]=O(!1),[m,n]=O([]);return ee(()=>d&&d.length>0?Promise.all(d.map(s=>E.groups.findOne({id:s.id}))):Promise.resolve([]),s=>{const o=s.filter(a=>a);n(o)},[]),y(N,{children:[e(P,{label:t("groupsClaim"),labelIcon:e($,{helpText:t("groupsClaimHelp"),fieldLabelId:"groupsClaim"}),fieldId:"groups",children:e(pe,{type:"text",id:"groupsClaim","data-testid":"groupsClaim",...r("groupsClaim")})}),y(P,{label:t("groups"),labelIcon:e($,{helpText:t("policyGroupsHelp"),fieldLabelId:"groups"}),fieldId:"groups",helperTextInvalid:t("requiredGroups"),validated:u.groups?"error":"default",isRequired:!0,children:[e(w,{name:"groups",control:i,defaultValue:[],rules:{validate:s=>s&&s.filter(({id:o})=>o).length>0},render:({field:s})=>y(N,{children:[p&&e(_t,{type:"selectMany",text:{title:"addGroupsToGroupPolicy",ok:"add"},onConfirm:o=>{s.onChange([...s.value||[],...(o||[]).map(({id:a})=>({id:a}))]),n([...m,...o||[]]),f(!1)},onClose:()=>{f(!1)},filterGroups:m}),e(q,{"data-testid":"select-group-button",variant:"secondary",onClick:()=>{f(!0)},children:t("addGroups")})]})}),m.length>0&&y(he,{variant:"compact",children:[e(fe,{children:y(Y,{children:[e(K,{children:t("groups")}),e(K,{children:t("extendToChildren")}),e(K,{"aria-hidden":"true"})]})}),e(ge,{children:m.map((s,o)=>y(Y,{children:[e(j,{children:s.path}),e(j,{children:e(w,{name:`groups.${o}.extendChildren`,defaultValue:!1,control:i,render:({field:a})=>e(De,{id:"extendChildren","data-testid":"standard",name:"extendChildren",isChecked:a.value,onChange:a.onChange,isDisabled:s.subGroups?.length===0})})}),e(j,{children:e(q,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Re,{}),onClick:()=>{c("groups",[...(d||[]).filter(({id:a})=>a!==s.id)]),n([...m.filter(({id:a})=>a!==s.id)])}})})]},s.id))})]})]})]})},On=()=>{const{t}=D(),{control:i}=V();return e(P,{label:t("code"),labelIcon:e($,{helpText:t("policyCodeHelp"),fieldLabelId:"code"}),fieldId:"code",isRequired:!0,children:e(w,{name:"code",defaultValue:"",control:i,render:({field:r})=>e(Ht,{id:"code","data-testid":"code",onChange:r.onChange,code:r.value,height:"600px",language:qt.javascript,isReadOnly:!0})})})},je=["POSITIVE","NEGATIVE"],kn=({isDisabled:t})=>{const{t:i}=D(),{control:r}=V();return e(P,{label:i("logic"),labelIcon:e($,{helpText:i("logicHelp"),fieldLabelId:"logic"}),fieldId:"logic",hasNoPaddingTop:!0,children:e(w,{name:"logic","data-testid":"logic",defaultValue:je[0],control:r,render:({field:l})=>e(N,{children:je.map(c=>e(de,{id:c,"data-testid":c,isChecked:l.value===c,name:"logic",onChange:()=>l.onChange(c),label:i(`logicType.${c.toLowerCase()}`),className:"pf-u-mb-md",isDisabled:t},c))})})})},Pn=({prefix:t,isDisabled:i})=>{const{t:r}=D(),{register:l,formState:{errors:c}}=V();return y(N,{children:[e(P,{label:r("name"),fieldId:"kc-name",helperTextInvalid:r("required"),validated:c.name?H.error:H.default,isRequired:!0,labelIcon:e($,{helpText:r(`${t}-nameHelp`),fieldLabelId:"name"}),children:e(pe,{isDisabled:i,id:"kc-name","data-testid":"name",validated:c.name?H.error:H.default,...l("name",{required:!0})})}),e(P,{label:r("description"),fieldId:"kc-description",labelIcon:e($,{helpText:r(`${t}-descriptionHelp`),fieldLabelId:"description"}),validated:c.description?H.error:H.default,helperTextInvalid:r("maxLength",{length:255}),children:e(Ut,{isDisabled:i,id:"kc-description","data-testid":"description",validated:c.description?H.error:H.default,...l("description",{maxLength:255})})})]})},$n=()=>{const{t}=D(),{register:i,formState:{errors:r}}=V();return y(N,{children:[e(P,{label:t("targetClaim"),fieldId:"targetClaim",helperTextInvalid:t("required"),validated:r.targetClaim?"error":"default",isRequired:!0,labelIcon:e($,{helpText:t("targetClaimHelp"),fieldLabelId:"targetClaim"}),children:e(pe,{id:"targetClaim","data-testid":"targetClaim",validated:r.targetClaim?"error":"default",...i("targetClaim",{required:!0})})}),e(P,{label:t("regexPattern"),fieldId:"pattern",labelIcon:e($,{helpText:t("regexPatternHelp"),fieldLabelId:"regexPattern"}),isRequired:!0,validated:r.pattern?"error":"default",helperTextInvalid:t("required"),children:e(pe,{id:"pattern","data-testid":"regexPattern",validated:r.pattern?"error":"default",...i("pattern",{required:!0})})})]})},Dn=()=>{const{t}=D(),{control:i,getValues:r,setValue:l,formState:{errors:c}}=V(),u=r("roles"),[d,p]=O(!1),[f,m]=O([]);return ee(async()=>{if(u&&u.length>0){const n=await Promise.all(u.map(s=>E.roles.findOneById({id:s.id})));return Promise.all(n.map(async s=>({role:s,client:s.clientRole?await E.clients.findOne({id:s?.containerId}):void 0})))}return Promise.resolve([])},m,[]),y(P,{label:t("roles"),labelIcon:e($,{helpText:t("policyRolesHelp"),fieldLabelId:"roles"}),fieldId:"roles",helperTextInvalid:t("requiredRoles"),validated:c.roles?"error":"default",isRequired:!0,children:[e(w,{name:"roles",control:i,defaultValue:[],rules:{validate:n=>n&&n.filter(s=>s.id).length>0},render:({field:n})=>y(N,{children:[d&&e(Gt,{id:"role",type:"roles",onAssign:s=>{n.onChange([...n.value||[],...s.map(o=>({id:o.role.id}))]),m([...f,...s]),p(!1)},onClose:()=>{p(!1)},isLDAPmapper:!0}),e(q,{"data-testid":"select-role-button",variant:"secondary",onClick:()=>{p(!0)},children:t("addRoles")})]})}),f.length>0&&y(he,{variant:"compact",children:[e(fe,{children:y(Y,{children:[e(K,{children:t("roles")}),e(K,{children:t("required")}),e(K,{"aria-hidden":"true"})]})}),e(ge,{children:f.map((n,s)=>y(Y,{children:[e(j,{children:e(Kt,{role:n.role,client:n.client})}),e(j,{children:e(w,{name:`roles.${s}.required`,defaultValue:!1,control:i,render:({field:o})=>e(De,{id:"required","data-testid":"standard",name:"required",isChecked:o.value,onChange:o.onChange})})}),e(j,{children:e(q,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Re,{}),onClick:()=>{l("roles",[...(u||[]).filter(o=>o.id!==n.role.id)]),m([...f.filter(o=>o.role.id!==n.role.id)])}})})]},n.role.id))})]})]})},Oe=/(\d\d\d\d-\d\d-\d\d)? (\d\d?):(\d\d?)/,Be=t=>t.toString().padStart(2,"0"),ze=({name:t})=>{const{control:i}=V(),r=(c,u)=>{if(!u)return c;const d=c.match(Oe);return`${[u.getFullYear(),Be(u.getMonth()+1),Be(u.getDate())].join("-")} ${d?d[2]:"00"}:${d?d[3]:"00"}:00`},l=(c,u,d)=>{const p=c.match(Oe);return d!=null?`${p?p[1]:""} ${u}:${d<10?`0${d}`:d}:00`:c};return e(w,{name:t,defaultValue:"",control:i,rules:{required:!0},render:({field:c})=>{const u=c.value.match(Oe)||["","","0","00"];return y(Ze,{hasGutter:!0,id:t,children:[e(ie,{children:e(jt,{value:u[1],onChange:(d,p,f)=>{c.onChange(r(c.value,f))}})}),e(ie,{children:e(Me,{time:`${u[2]}:${u[3]}`,onChange:(d,p,f,m)=>c.onChange(l(c.value,f,m)),is24Hour:!0})})]})}})},We=({name:t,min:i,max:r})=>{const{control:l}=V(),c=u=>Math.min(u,r);return e(w,{name:t,defaultValue:"",control:l,render:({field:u})=>e(Xt,{id:t,value:u.value,min:i,max:r,onPlus:()=>u.onChange(Number(u.value)+1),onMinus:()=>u.onChange(Number(u.value)-1),onChange:d=>{const p=Number(d.currentTarget.value);u.onChange(c(isNaN(p)?0:p))}})})},ce=({name:t,...i})=>{const{t:r}=D();return e(P,{label:r(t),fieldId:t,labelIcon:e($,{helpText:r(`${t}Help`),fieldLabelId:t}),children:y(Ze,{hasGutter:!0,children:[e(ie,{children:e(We,{name:t,...i})}),e(ie,{children:r("to")}),e(ie,{children:e(We,{name:`${t}End`,...i})})]})})},Rn=()=>{const{t}=D(),{getValues:i,formState:{errors:r}}=V(),[l,c]=O(i("month"));return y(N,{children:[e(P,{label:t("repeat"),fieldId:"repeat",labelIcon:e($,{helpText:t("repeatHelp"),fieldLabelId:"repeat"}),children:y(Jt,{children:[e(_e,{children:e(de,{id:"notRepeat","data-testid":"notRepeat",isChecked:!l,name:"repeat",onChange:()=>c(!1),label:t("notRepeat"),className:"pf-u-mb-md"})}),e(_e,{children:e(de,{id:"repeat","data-testid":"repeat",isChecked:l,name:"repeat",onChange:()=>c(!0),label:t("repeat"),className:"pf-u-mb-md"})})]})}),l&&y(N,{children:[e(ce,{name:"month",min:1,max:12}),e(ce,{name:"dayMonth",min:1,max:31}),e(ce,{name:"hour",min:0,max:23}),e(ce,{name:"minute",min:0,max:59})]}),e(P,{label:t("startTime"),fieldId:"notBefore",labelIcon:e($,{helpText:t("startTimeHelp"),fieldLabelId:"startTime"}),isRequired:!0,helperTextInvalid:t("required"),validated:r.notBefore?H.error:H.default,children:e(ze,{name:"notBefore"})}),e(P,{label:t("expireTime"),fieldId:"notOnOrAfter",labelIcon:e($,{helpText:t("expireTimeHelp"),fieldLabelId:"expireTime"}),isRequired:!0,helperTextInvalid:t("required"),validated:r.notOnOrAfter?H.error:H.default,children:e(ze,{name:"notOnOrAfter"})})]})},Mn=()=>{const{t}=D();return e(gn,{name:"users",label:"users",helpText:t("policyUsers"),defaultValue:[],isRequired:!0})},$e={aggregate:Cn,client:yn,user:Mn,"client-scope":bn,group:xn,regex:$n,role:Dn,time:Rn,js:On},Ae=t=>t in $e;function An(){const{t}=D(),{id:i,realm:r,policyId:l,policyType:c}=tt(),u=Je(),d=kt(),{reset:p,handleSubmit:f}=d,{addAlert:m,addError:n}=Pt(),[s,o]=O(),a=c==="js";ee(async()=>{if(l){const g=await Promise.all([E.clients.findOnePolicy({id:i,type:c,policyId:l}),E.clients.getAssociatedPolicies({id:i,permissionId:l})]);if(!g[0])throw new Error(t("notFound"));return{policy:g[0],policies:g[1].map(v=>v.id)}}return{}},({policy:g,policies:v})=>{p({...g,policies:v}),o(g)},[i,c,l]);const h=async g=>{g.groups=g.groups?.filter(v=>v.id),g.clientScopes=g.clientScopes?.filter(v=>v.id),g.roles=g.roles?.filter(v=>v.id).map(v=>({...v,required:v.required||!1}));try{if(l)await E.clients.updatePolicy({id:i,type:c,policyId:l},g);else{const v=await E.clients.createPolicy({id:i,type:c},g);u(Qe({realm:r,id:i,policyType:c,policyId:v.id}))}m(t((l?"update":"create")+"PolicySuccess"),Ve.success)}catch(v){n("policySaveError",v)}},[T,S]=et({titleKey:"deletePolicy",messageKey:"deletePolicyConfirm",continueButtonLabel:"confirm",onConfirm:async()=>{try{await E.clients.delPolicy({id:i,policyId:l}),m(t("policyDeletedSuccess"),Ve.success),u(we({realm:r,clientId:i,tab:"policies"}))}catch(g){n("policyDeletedError",g)}}});if(l&&!s)return e($t,{});function x(){return Ae(c)?$e[c]:$e.js}const A=x();return y(N,{children:[e(S,{}),e(Nt,{titleKey:l?s?.name:t("createPolicyOfType",{policyType:c}),dropdownItems:l?[e(Pe,{"data-testid":"delete-policy",onClick:()=>T(),children:t("delete")},"delete")]:void 0}),e(Dt,{variant:"light",children:y(Et,{isHorizontal:!0,onSubmit:f(h),role:"view-clients",children:[y(Rt,{...d,children:[e(Pn,{isDisabled:a,prefix:"policy"}),e(A,{}),e(kn,{isDisabled:a})]}),e(Qt,{children:y("div",{className:"pf-u-mt-md",children:[e(q,{isDisabled:a,variant:ne.primary,className:"pf-u-mr-md",type:"submit","data-testid":"save",children:t("save")}),e(q,{variant:"link","data-testid":"cancel",component:g=>e(Xe,{...g,to:we({realm:r,clientId:i,tab:"policies"})}),children:t("cancel")})]})})]})})]})}const ai=Object.freeze(Object.defineProperty({__proto__:null,default:An,isValidComponentType:Ae},Symbol.toStringTag,{value:"Module"})),En=({policyProviders:t,onSelect:i,toggleDialog:r})=>{const{t:l}=D(),c=nt(),u=Ye(()=>t?c(t,it("name")):[],[t]);return e(rt,{"aria-labelledby":l("addPredefinedMappers"),variant:ot.medium,header:y(Mt,{children:[e(Fe,{component:At.h1,children:l("chooseAPolicyType")}),e(Fe,{children:l("chooseAPolicyTypeInstructions")})]}),isOpen:!0,onClose:r,children:y(he,{"aria-label":l("policies"),variant:"compact",children:[e(fe,{children:y(Y,{children:[e(K,{children:l("name")}),e(K,{children:l("description")})]})}),e(ge,{children:u.map(d=>y(Y,{"data-testid":d.type,onRowClick:()=>i(d),isHoverable:!0,children:[e(j,{children:d.name}),e(j,{children:Ae(d.type)&&l(`policyProvider.${d.type}`)})]},d.type))})]})})};export{Sn as A,Tn as D,En as N,ai as P,vn as R,gn as U};
//# sourceMappingURL=NewPolicyDialog-th1Dwl3Y.js.map
