import{jsx as e,jsxs as v,Fragment as Re}from"react/jsx-runtime";import{useState as D}from"react";import{d as q,e as J,u as X,a7 as fe,P as Y,W as he,B as h,aj as I,bg as ye,j as l,g as ge,bh as ve,f as ke,Z as $,r as we,ak as Q,m as z,A as F,K as N,O as Ce,am as G,bi as H,aP as Ae,bj as Te,bk as De,bl as Ie,b5 as Fe,bm as Ne}from"./index-sihFV1NS.js";import{u as Z}from"./ConfirmDialog-WMVurgkl.js";import{A as Ke}from"./AttributeForm-St-qQE3r.js";import{P as Ee}from"./PermissionTab-5VqfGSUL.js";import{R as Be}from"./RoleForm-Sjfz-ceM.js";import{A as Se,R as Pe}from"./AddRoleMappingModal-uxjjMt5W.js";import{R as xe,u as Le}from"./RoutableTabs-a7VqIL_I.js";import{V as Ve}from"./ViewHeader-xo54NRb6.js";import{u as Me,F as Oe}from"./useIsFeatureEnabled-qmmJPqO8.js";import{u as _}from"./useParams-OD1jI_R2.js";import{L as We}from"./PaginatingTableToolbar--Dt3wwL6.js";import{K as Ue}from"./KeycloakDataTable-Q3kZYP9q.js";import{Q as je}from"./question-circle-icon-0KWACECW.js";import{a as y,b as g}from"./Tabs-wiayO8Tk.js";import"react-dom";import"./Modal-uOAPm2rX.js";import"./FormAccess-EK-4wbwg.js";import"./copy-icon-WaWzxYgU.js";import"./Form-bfj-xQZn.js";import"./KeyValueInput-CbiNnu-2.js";import"./KeycloakTextInput--S1SG2UN.js";import"./useToggle-mZS4AEtR.js";import"./minus-icon-3MARcJXf.js";import"./ActionListItem-1jrwMZdM.js";import"./EmptyStateBody-jnnI7hpP.js";import"./useLocaleSort-K-jL4v2R.js";import"./Trans-1cjg0ImV.js";import"./Td-uwYquKT4.js";import"./TableToolbar-vuixsfwd.js";import"./ToolbarContent-46I9Yg7h.js";import"./grip-vertical-icon-accuSWkz.js";import"./KeycloakTextArea-NBwG1p2x.js";import"./resource-BRtaBrSc.js";import"./filter-icon-0B3gA_nj.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./_baseRest-lI6NnEVt.js";import"./plus-icon-zbmNbCLY.js";import"./MenuList-82IaVNxu.js";const $e=()=>{const m=q(),{realm:o}=J(),{t:a}=X(),{id:k,clientId:K}=_(),E=async(r,i)=>{const d=await l.roles.findOneById({id:k});if(!d)throw new Error(a("notFound"));return d.clientRole?l.clients.findUsersWithRole({roleName:d.name,id:K,first:r,max:i}):l.roles.findUsersWithRole({name:d.name,first:r,max:i})},{enabled:b}=fe();return e(Y,{"data-testid":"users-page",variant:"light",children:e(Ue,{isPaginated:!0,loader:E,ariaLabelKey:"roleList",searchPlaceholderKey:"",toolbarItem:b&&e(he,{"aria-label":"Basic popover",position:"bottom",bodyContent:v("div",{children:[a("whoWillAppearPopoverTextRoles"),e(h,{className:"kc-groups-link",variant:"link",onClick:()=>m(`/${o}/groups`),children:a("groups")}),a("or"),v(h,{className:"kc-users-link",variant:"link",onClick:()=>m(`/${o}/users`),children:[a("users"),"."]})]}),footerContent:a("whoWillAppearPopoverFooterText"),children:e(h,{variant:"link",className:"kc-who-will-appear-button",icon:e(je,{}),children:a("whoWillAppearLinkTextRoles")},"who-will-appear-button")}),emptyState:e(We,{hasIcon:!0,message:a("noDirectUsers"),instructions:v("div",{children:[a("noUsersEmptyStateDescription"),e(h,{className:"kc-groups-link-empty-state",variant:"link",onClick:()=>m(`/${o}/groups`),children:a("groups")}),a("or"),e(h,{className:"kc-users-link-empty-state",variant:"link",onClick:()=>m(`/${o}/users`),children:a("users")}),a("noUsersEmptyStateDescriptionContinued")]})}),columns:[{name:"username",displayKey:"userName",cellFormatters:[I()]},{name:"email",displayKey:"email",cellFormatters:[I()]},{name:"lastName",displayKey:"lastName",cellFormatters:[I()]},{name:"firstName",displayKey:"firstName",cellFormatters:[ye(),I()]}]})})};function Kt(){const m=Me(),{t:o}=X(),a=ge({mode:"onChange"}),{control:k,reset:K,setValue:E}=a,b=q(),{id:r,clientId:i}=_(),{pathname:d}=ve(),{realm:c}=J(),[B,ee]=D(0),[te,S]=D(),P=()=>ee(B+1),{addAlert:w,addError:C}=ke(),[x,L]=D(!1),oe=t=>{const{attributes:s,...p}=t;return{attributes:Ne(s),...p}},n=$({control:k,defaultValue:void 0,name:"name"}),V=$({control:k,defaultValue:!1,name:"composite"}),[A,ae]=D();we(async()=>{const[t,s]=await Promise.all([l.realms.findOne({realm:c}),l.roles.findOneById({id:r})]);return{realm:t,role:s}},({realm:t,role:s})=>{if(!t||!s)throw new Error(o("notFound"));const p=oe(s);K(p),S(p.attributes),ae(t)},[B]);const M=async t=>{try{const{attributes:s,...p}=t,f=p;f.name=f.name?.trim(),f.attributes=Ae(s),i?await l.clients.updateRole({id:i,roleName:t.name},f):await l.roles.updateById({id:r},f),S(s),w(o("roleSaveSuccess"),F.success)}catch(s){C("roleSaveError",s)}},O=Q(Te.path),u=Q(De.path),se=()=>{if(O)return H({realm:c});if(u)return G({realm:c,clientId:u.params.clientId,tab:"roles"});throw new Error("Roles overview route could not be determined.")},T=t=>{if(O)return Ie({realm:c,id:r,tab:t});if(u)return Fe({realm:c,id:r,clientId:u.params.clientId,tab:t});throw new Error("Route could not be determined.")},R=t=>Le(T(t)),re=R("details"),le=R("associated-roles"),ie=R("attributes"),ne=R("users-in-role"),ce=R("permissions"),[W,me]=Z({titleKey:"roleDeleteConfirm",messageKey:o("roleDeleteConfirmDialog",{selectedRoleName:n||o("createRole")}),continueButtonLabel:"delete",continueButtonVariant:z.danger,onConfirm:async()=>{try{i?await l.clients.delRole({id:i,roleName:n}):await l.roles.delById({id:r}),w(o("roleDeletedSuccess"),F.success),b(se())}catch(t){C("roleDeleteError",t)}}}),de=d.includes("associated-roles")?[e(N,{component:"button",onClick:()=>ue(),children:o("removeAllAssociatedRoles")},"delete-all-associated"),e(N,{component:"button",onClick:()=>{W()},children:o("deleteRole")},"delete-role")]:[e(N,{"data-testid":"add-roles",component:"button",onClick:()=>be(),children:o("addAssociatedRolesText")},"toggle-modal"),e(N,{component:"button",onClick:()=>W(),children:o("deleteRole")},"delete-role")],[ue,pe]=Z({titleKey:o("removeAllAssociatedRoles")+"?",messageKey:o("removeAllAssociatedRolesConfirmDialog",{name:n||o("createRole")}),continueButtonLabel:"delete",continueButtonVariant:z.danger,onConfirm:async()=>{try{const t=await l.roles.getCompositeRoles({id:r});await l.roles.delCompositeRoles({id:r},t),w(o("compositeRoleOff"),F.success,o("compositesRemovedAlertDescription")),b(T("details")),P()}catch(t){C("roleDeleteError",t)}}}),be=()=>{L(!x)},U=async t=>{try{await l.roles.createComposite({roleId:r,realm:A.realm},t),P(),b(T("associated-roles")),w(o("addAssociatedRolesSuccess"),F.success)}catch(s){C("addAssociatedRolesError",s)}},j=t=>A?.defaultRole&&A.defaultRole.name===t;return A?v(Re,{children:[e(me,{}),e(pe,{}),x&&e(Se,{id:r,type:"roles",name:n,onAssign:t=>U(t.map(s=>s.role)),onClose:()=>L(!1)}),e(Ve,{titleKey:n,badges:[{id:"composite-role-badge",text:V?o("composite"):"",readonly:!0}],actionsDropdownId:"roles-actions-dropdown",dropdownItems:de,divider:!1}),e(Y,{variant:"light",className:"pf-u-p-0",children:v(xe,{isBox:!0,mountOnEnter:!0,defaultLocation:T("details"),children:[e(y,{title:e(g,{children:o("details")}),...re,children:e(Be,{form:a,onSubmit:M,role:u?"manage-clients":"manage-realm",cancelLink:u?G({realm:c,clientId:i,tab:"roles"}):H({realm:c}),editMode:!0})}),V&&e(y,{"data-testid":"associatedRolesTab",title:e(g,{children:o("associatedRolesText")}),...le,children:e(Pe,{name:n,id:r,type:"roles",isManager:!0,save:t=>U(t.map(s=>s.role))})}),!j(n)&&e(y,{"data-testid":"attributesTab",className:"kc-attributes-tab",title:e(g,{children:o("attributes")}),...ie,children:e(Ke,{form:a,save:M,reset:()=>E("attributes",te,{shouldDirty:!1})})}),!j(n)&&e(y,{title:e(g,{children:o("usersInRole")}),...ne,children:e($e,{"data-cy":"users-in-role-tab"})}),m(Oe.AdminFineGrainedAuthz)&&e(y,{title:e(g,{children:o("permissions")}),...ce,children:e(Ee,{id:r,type:"roles"})})]})})]}):e(Ce,{})}export{Kt as default};
//# sourceMappingURL=RealmRoleTabs-xlmeoDxU.js.map
