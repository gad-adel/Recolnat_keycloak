import{jsx as e,jsxs as m,Fragment as N}from"react/jsx-runtime";import{useState as f}from"react";import{g as U,d as $,e as z,u as W,f as Z,r as _,m as J,j as d,A as K,dL as L,Z as Q,O as X,K as v,P as Y,F as g,i as w,V as M,C as ee,S as re,b as te,c as ae,h as pe,B as O,H as oe,G as ie}from"./index-sihFV1NS.js";import{u as ne}from"./ConfirmDialog-WMVurgkl.js";import{D as se}from"./DynamicComponents-f6aNOnzT.js";import{F as de}from"./FormAccess-EK-4wbwg.js";import{K as c}from"./KeycloakTextInput--S1SG2UN.js";import{V as le}from"./ViewHeader-xo54NRb6.js";import{u as me}from"./useParams-OD1jI_R2.js";import{F as ce,A as ue}from"./Form-bfj-xQZn.js";import"react-dom";import"./Modal-uOAPm2rX.js";import"./ClientSelect-sh5SEoBO.js";import"./FileUpload-LIezXv7x.js";import"./CodeEditor-7uqvO0EK.js";import"./copy-icon-WaWzxYgU.js";import"./EmptyStateBody-jnnI7hpP.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./GroupPickerDialog-gC2-xBPw.js";import"./PaginatingTableToolbar--Dt3wwL6.js";import"./TableToolbar-vuixsfwd.js";import"./ToolbarContent-46I9Yg7h.js";import"./useToggle-mZS4AEtR.js";import"./DataListItemRow-te2VcAoi.js";import"./data-list-CDN1kyj9.js";import"./grip-vertical-icon-accuSWkz.js";import"./_baseRest-lI6NnEVt.js";import"./ActionListItem-1jrwMZdM.js";import"./Flex-W2FoLD7u.js";import"./FlexItem-Mxf6oLng.js";import"./MultiLineInput-MBnUzZD_.js";import"./PasswordInput-P6txGPqu.js";import"./AddRoleMappingModal-uxjjMt5W.js";import"./useLocaleSort-K-jL4v2R.js";import"./KeycloakDataTable-Q3kZYP9q.js";import"./Td-uwYquKT4.js";import"./resource-BRtaBrSc.js";import"./filter-icon-0B3gA_nj.js";import"./KeycloakTextArea-NBwG1p2x.js";function Ye(){const p=U(),[n,P]=f(),[h,q]=f(),{id:k,mapperId:o}=me(),u=$(),{realm:I}=z(),{t}=W(),{addAlert:S,addError:T}=Z(),[D,F]=f(!1),[C,E]=f(0),H=()=>E(C+1);_(async()=>{const r=await d.components.listSubComponents({id:k,type:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper"});if(o&&o!=="new"){const a=await d.components.findOne({id:o});return{components:r,fetchedMapper:a}}return{components:r}},({components:r,fetchedMapper:a})=>{if(P(a),q(r),o!=="new"&&!a)throw new Error(t("notFound"));a&&V(a)},[]);const V=r=>{ie(r,p.setValue)},R=async r=>{const a=oe(r),l={...a,config:Object.entries(a.config||{}).reduce((y,[G,b])=>(y[G]=Array.isArray(b)?b:[b],y),{})};try{o==="new"?(await d.components.create(l),u(L({realm:I,id:r.parentId,tab:"mappers"}))):await d.components.update({id:o},l),V(l),S(t(o==="new"?"mappingCreatedSuccess":"mappingUpdatedSuccess"),K.success)}catch(y){T(o==="new"?"mappingCreatedError":"mappingUpdatedError",y)}},A=async r=>{try{const a=await d.userStorageProvider.mappersSync({parentId:n?.parentId||"",id:o,direction:r});S(t("syncLDAPGroupsSuccessful",{result:a.status}))}catch(a){T("syncLDAPGroupsError",a)}H()},[j,B]=ne({titleKey:"deleteMappingTitle",messageKey:"deleteMappingConfirm",continueButtonLabel:"delete",continueButtonVariant:J.danger,onConfirm:async()=>{try{await d.components.del({id:n.id}),S(t("mappingDeletedSuccess"),K.success),u(L({id:k,realm:I,tab:"mappers"}))}catch(r){T("mappingDeletedError",r)}}}),x=Q({control:p.control,name:"providerId"});if(!h)return e(X,{});const s=o==="new",i=h.find(r=>r.id===x);return m(N,{children:[e(B,{}),e(le,{titleKey:n?n.name:t("createNewMapper"),dropdownItems:s?void 0:[e(v,{onClick:j,children:t("delete")},"delete"),...i?.metadata.fedToKeycloakSyncSupported?[e(v,{onClick:()=>A("fedToKeycloak"),children:t(i.metadata.fedToKeycloakSyncMessage)},"fedSync")]:[],...i?.metadata.keycloakToFedSyncSupported?[e(v,{onClick:()=>{A("keycloakToFed")},children:t(i.metadata.keycloakToFedSyncMessage)},"ldapSync")]:[]]},C),m(Y,{variant:"light",isFilled:!0,children:[m(de,{role:"manage-realm",isHorizontal:!0,children:[!s&&e(g,{label:t("id"),fieldId:"kc-ldap-mapper-id",children:e(c,{isDisabled:!0,id:"kc-ldap-mapper-id","data-testid":"ldap-mapper-id",...p.register("id")})}),m(g,{label:t("name"),labelIcon:e(w,{helpText:t("nameHelp"),fieldLabelId:"name"}),fieldId:"kc-ldap-mapper-name",isRequired:!0,children:[e(c,{isDisabled:!s,isRequired:!0,id:"kc-ldap-mapper-name","data-testid":"ldap-mapper-name",validated:p.formState.errors.name?M.error:M.default,...p.register("name",{required:!0})}),e(c,{hidden:!0,defaultValue:s?k:n?n.parentId:"",id:"kc-ldap-parentId","data-testid":"ldap-mapper-parentId",...p.register("parentId")}),e(c,{hidden:!0,defaultValue:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper",id:"kc-ldap-provider-type","data-testid":"ldap-mapper-provider-type",...p.register("providerType")})]}),s?e(g,{label:t("mapperType"),labelIcon:e(w,{helpText:i?.helpText?i.helpText:t("mapperTypeHelp"),fieldLabelId:"mapperType"}),fieldId:"kc-providerId",isRequired:!0,children:e(ee,{name:"providerId",defaultValue:"",control:p.control,"data-testid":"ldap-mapper-type-select",render:({field:r})=>e(re,{toggleId:"kc-providerId",required:!0,onToggle:()=>F(!D),isOpen:D,onSelect:(a,l)=>{r.onChange(l),F(!1)},selections:r.value,variant:te.typeahead,children:h.map(a=>e(ae,{value:a.id},a.id))})})}):e(g,{label:t("mapperType"),labelIcon:e(w,{helpText:i?.helpText?i.helpText:t("mapperTypeHelp"),fieldLabelId:"mapperType"}),fieldId:"kc-ldap-mapper-type",isRequired:!0,children:e(c,{isDisabled:!s,isRequired:!0,id:"kc-ldap-mapper-type","data-testid":"ldap-mapper-type-fld",...p.register("providerId")})}),e(pe,{...p,children:!!x&&e(se,{properties:i?.properties})})]}),e(ce,{onSubmit:p.handleSubmit(()=>R(p.getValues())),children:m(ue,{children:[e(O,{isDisabled:!p.formState.isDirty,variant:"primary",type:"submit","data-testid":"ldap-mapper-save",children:t("save")}),e(O,{variant:"link",onClick:()=>u(s?-1:`/${I}/user-federation/ldap/${n.parentId}/mappers`),"data-testid":"ldap-mapper-cancel",children:t("cancel")})]})})]})]})}export{Ye as default};
//# sourceMappingURL=LdapMapperDetails-p2Bz0H_3.js.map
