import{jsx as t,jsxs as d,Fragment as ne}from"react/jsx-runtime";import{useState as y,useMemo as Oe}from"react";import{bA as De,bB as Pe,bC as Le,bD as we,e as M,L as oe,E as fe,am as Ke,bE as Ue,ag as Ve,b3 as Te,k as xe,bl as Ge,u as H,a4 as Be,g as be,aB as Me,j as te,I as ge,J as ke,F as h,C,S as ae,b as se,$ as K,a0 as F,c as re,B as S,r as He,bF as je,a8 as We,P as $e,bG as le,q as ze}from"./index-sihFV1NS.js";import{K as b}from"./KeycloakTextInput--S1SG2UN.js";import{L as ve}from"./PaginatingTableToolbar--Dt3wwL6.js";import{R as Je,u as Xe}from"./RoutableTabs-a7VqIL_I.js";import{T as Ze,m as qe,n as Ye,K as Ce}from"./KeycloakDataTable-Q3kZYP9q.js";import{V as Qe}from"./ViewHeader-xo54NRb6.js";import{u as Fe,F as Ie}from"./useFormatDate-kyFeutIw.js";import{X as et,N as Ee,Y as tt}from"./Td-uwYquKT4.js";import{C as at,L as st}from"./CodeEditor-7uqvO0EK.js";import{M as rt,a as nt}from"./Modal-uOAPm2rX.js";import{F as Ae}from"./Flex-W2FoLD7u.js";import{F as G}from"./FlexItem-Mxf6oLng.js";import{F as Se,A as Ne}from"./Form-bfj-xQZn.js";import{D as B}from"./DatePicker-zM1UwT7F.js";import{T as ot}from"./Trans-1cjg0ImV.js";import{W as lt}from"./warning-triangle-icon-CFZFa_fd.js";import{a as ie,b as ce}from"./Tabs-wiayO8Tk.js";import{D as it,a as de,b as pe,c as ue}from"./DescriptionListTerm-sSQQqmBE.js";import"react-dom";import"./EmptyStateBody-jnnI7hpP.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./TableToolbar-vuixsfwd.js";import"./ToolbarContent-46I9Yg7h.js";import"./_baseRest-lI6NnEVt.js";import"./grip-vertical-icon-accuSWkz.js";import"./copy-icon-WaWzxYgU.js";import"./plus-icon-zbmNbCLY.js";import"./MenuList-82IaVNxu.js";function Re(e,n){if(e==null)return{};var l=De(Pe(e),function(i){return[i]});return n=Le(n),we(e,l,function(i,g){return n(i,g[0])})}const me=38,ct=({text:e,children:n})=>{const l=e||"",i=l.length>me,g=l.substring(0,me);return i?t(fe,{content:e,children:n(g+"â€¦")}):n(l)},dt=e=>e.operationType==="DELETE"?!1:e.resourceType==="USER"||e.resourceType==="GROUP_MEMBERSHIP"||e.resourceType==="GROUP"||e.resourceType==="CLIENT"||e.resourceType?.startsWith("AUTHORIZATION_RESOURCE")||e.resourceType==="CLIENT_SCOPE"||e.resourceType==="AUTH_FLOW"||e.resourcePath?.startsWith("roles-by-id"),pt=new RegExp(/([0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12})/),ut=(e,n)=>{const l=pt.exec(n.resourcePath);if(!l)return console.warn("event didn't contain a valid link",n),"";const i=l[1];return n.resourceType==="CLIENT"||n.resourceType?.startsWith("AUTHORIZATION_RESOURCE")?Ke({realm:e,clientId:i,tab:n.resourceType==="CLIENT"?"settings":"authorization"}):n.resourceType==="GROUP"?Ue({realm:e,id:i}):n.resourceType==="CLIENT_SCOPE"?Ve({realm:e,id:i,tab:"settings"}):n.resourceType==="USER"||n.resourceType==="GROUP_MEMBERSHIP"?Te({realm:e,id:i,tab:"settings"}):n.resourceType==="AUTH_FLOW"?xe({realm:e,id:i,usedBy:"-"}):n.resourcePath?.startsWith("roles-by-id")?Ge({realm:e,id:i,tab:"details"}):""},mt=({event:e})=>{const{realm:n}=M();return t(ct,{text:e.resourcePath,children:l=>dt(e)?t(oe,{to:ut(n,e),children:l}):t("span",{children:l})})},ht=e=>t(mt,{event:e}),he={resourceTypes:[],operationTypes:[],resourcePath:"",dateFrom:"",dateTo:"",authClient:"",authUser:"",authRealm:"",authIpAddress:""},ye=({titleKey:e,onClose:n,children:l})=>{const{t:i}=H();return t(rt,{variant:nt.medium,title:i(e),isOpen:!0,onClose:n,children:l})},yt=()=>{const{t:e}=H(),{realm:n}=M(),l=Be(),i=Fe(),g=l.enums?.resourceType,j=l.enums?.operationType,[N,W]=y(0),[$,U]=y(!1),[z,I]=y(!1),[J,X]=y(!1),[f,R]=y({}),[_,O]=y(),[T,V]=y(),Z={resourceTypes:e("resourceTypes"),operationTypes:e("operationTypes"),resourcePath:e("resourcePath"),dateFrom:e("dateFrom"),dateTo:e("dateTo"),authClient:e("client"),authUser:e("userId"),authRealm:e("realm"),authIpAddress:e("ipAddress")},{getValues:E,register:k,reset:D,formState:{isDirty:x},control:A}=be({mode:"onChange",defaultValues:he});function q(a,r){return te.realms.findAdminEvents({...f,realm:n,first:a,max:r})}function Y(){U(!1),s()}function v(){D(),s()}function Q(a){const r={...E()};delete r[a],D({...he,...r}),s()}function ee(a,r){const p=E(),c=p[a],L=Array.isArray(c)?c.filter(w=>w!==r):c;D({...p,[a]:L}),s()}function s(){const a=Re(E(),r=>r!==""||Array.isArray(r)&&r.length>0);R(a),W(N+1)}function o(){s()}const u=()=>d(Ae,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[d(G,{children:[t(ge,{id:"admin-events-search-select","data-testid":"AdminEventsSearchSelector",className:"pf-u-ml-md",toggle:t(ke,{"data-testid":"adminEventsSearchSelectorToggle",onToggle:a=>U(a),className:"keycloak__events_search_selector_dropdown__toggle",children:e("searchForAdminEvent")}),isOpen:$,children:d(Se,{isHorizontal:!0,className:"keycloak__events_search__form","data-testid":"searchForm",children:[t(h,{label:e("resourceTypes"),fieldId:"kc-resourceTypes",className:"keycloak__events_search__form_label",children:t(C,{name:"resourceTypes",control:A,render:({field:a})=>t(ae,{className:"keycloak__events_search__type_select",name:"resourceTypes","data-testid":"resource-types-searchField",chipGroupProps:{numChips:1,expandedText:e("hide"),collapsedText:e("showRemaining")},variant:se.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:r=>I(r),selections:a.value,onSelect:(r,p)=>{const c=p.toString(),L=a.value.includes(c)?a.value.filter(w=>w!==c):[...a.value,c];a.onChange(L)},onClear:r=>{r.stopPropagation(),a.onChange([])},isOpen:z,"aria-labelledby":"resourceTypes",chipGroupComponent:t(K,{children:a.value.map(r=>t(F,{onClick:p=>{p.stopPropagation(),a.onChange(a.value.filter(c=>c!==r))},children:r},r))}),children:g?.map(r=>t(re,{value:r},r))})})}),t(h,{label:e("operationTypes"),fieldId:"kc-operationTypes",className:"keycloak__events_search__form_label",children:t(C,{name:"operationTypes",control:A,render:({field:a})=>t(ae,{className:"keycloak__events_search__type_select",name:"operationTypes","data-testid":"operation-types-searchField",chipGroupProps:{numChips:1,expandedText:e("hide"),collapsedText:e("showRemaining")},variant:se.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:r=>X(r),selections:a.value,onSelect:(r,p)=>{const c=p.toString(),L=a.value.includes(c)?a.value.filter(w=>w!==c):[...a.value,c];a.onChange(L)},onClear:r=>{r.stopPropagation(),a.onChange([])},isOpen:J,"aria-labelledby":"operationTypes",chipGroupComponent:t(K,{children:a.value.map(r=>t(F,{onClick:p=>{p.stopPropagation(),a.onChange(a.value.filter(c=>c!==r))},children:r},r))}),children:j?.map(r=>t(re,{value:r},r))})})}),t(h,{label:e("resourcePath"),fieldId:"kc-resourcePath",className:"keycloak__events_search__form_label",children:t(b,{id:"kc-resourcePath","data-testid":"resourcePath-searchField",...k("resourcePath")})}),t(h,{label:e("realm"),fieldId:"kc-realm",className:"keycloak__events_search__form_label",children:t(b,{id:"kc-realm","data-testid":"realm-searchField",...k("authRealm")})}),t(h,{label:e("client"),fieldId:"kc-client",className:"keycloak__events_search__form_label",children:t(b,{id:"kc-client","data-testid":"client-searchField",...k("authClient")})}),t(h,{label:e("user"),fieldId:"kc-user",className:"keycloak__events_search__form_label",children:t(b,{id:"kc-user","data-testid":"user-searchField",...k("authUser")})}),t(h,{label:e("ipAddress"),fieldId:"kc-ipAddress",className:"keycloak__events_search__form_label",children:t(b,{id:"kc-ipAddress","data-testid":"ipAddress-searchField",...k("authIpAddress")})}),t(h,{label:e("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:t(C,{name:"dateFrom",control:A,render:({field:a})=>t(B,{className:"pf-u-w-100",value:a.value,onChange:(r,p)=>a.onChange(p),inputProps:{id:"kc-dateFrom"}})})}),t(h,{label:e("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:t(C,{name:"dateTo",control:A,render:({field:a})=>t(B,{className:"pf-u-w-100",value:a.value,onChange:(r,p)=>a.onChange(p),inputProps:{id:"kc-dateTo"}})})}),d(Ne,{children:[t(S,{variant:"primary",onClick:Y,"data-testid":"search-events-btn",isDisabled:!x,children:e("searchAdminEventsBtn")}),t(S,{variant:"secondary",onClick:v,isDisabled:!x,children:e("resetBtn")})]})]})}),t(S,{className:"pf-u-ml-md",onClick:o,"data-testid":"refresh-btn",children:e("refresh")})]}),t(G,{children:Object.entries(f).length>0&&t("div",{className:"keycloak__searchChips pf-u-ml-md",children:Object.entries(f).map(a=>{const[r,p]=a;return t(K,{className:"pf-u-mt-md pf-u-mr-md",categoryName:Z[r],isClosable:!0,onClick:()=>Q(r),children:typeof p=="string"?t(F,{isReadOnly:!0,children:p}):p.map(c=>t(F,{onClick:()=>ee(r,c),children:c},c))},r)})})})]}),m=[[e("realm"),_?.authDetails?.realmId],[e("client"),_?.authDetails?.clientId],[e("user"),_?.authDetails?.userId],[e("ipAddress"),_?.authDetails?.ipAddress]],P=Oe(()=>T?.representation?Me(JSON.parse(T.representation)):"",[T?.representation]);return d(ne,{children:[_&&t(ye,{titleKey:"auth",onClose:()=>O(void 0),children:d(Ze,{"aria-label":"authData","data-testid":"auth-dialog",variant:et.compact,cells:[e("attribute"),e("value")],rows:m,children:[t(qe,{}),t(Ye,{})]})}),T&&t(ye,{titleKey:"representation","data-testid":"representation-dialog",onClose:()=>V(void 0),children:t(at,{isLineNumbersVisible:!0,isReadOnly:!0,code:P,language:st.json,height:"8rem"})}),t(Ce,{loader:q,isPaginated:!0,ariaLabelKey:"adminEvents",toolbarItem:u(),actions:[{title:e("auth"),onRowClick:a=>O(a)},{title:e("representation"),onRowClick:a=>V(a)}],columns:[{name:"time",displayKey:"time",cellRenderer:a=>i(new Date(a.time),Ie)},{name:"resourcePath",displayKey:"resourcePath",cellRenderer:ht},{name:"resourceType",displayKey:"resourceType"},{name:"operationType",displayKey:"operationType",transforms:[Ee(10)]},{name:"",displayKey:"user",cellRenderer:a=>a.authDetails?.userId||""}],emptyState:t(ve,{message:e("emptyEvents"),instructions:e("emptyEventsInstructions")}),isSearching:Object.keys(f).length>0},N)]})},_e={client:"",dateFrom:"",dateTo:"",user:"",type:[],ipAddress:""},_t=e=>e.error?t(fe,{content:e.error,children:d("span",{children:[t(lt,{color:"orange"})," ",e.type]})}):d("span",{children:[t(ze,{color:"green"})," ",e.type]}),ft=e=>d(it,{isHorizontal:!0,className:"keycloak_eventsection_details",children:[e.details&&Object.entries(e.details).map(([n,l])=>d(de,{children:[t(pe,{children:n}),t(ue,{children:l})]},n)),e.error&&d(de,{children:[t(pe,{children:"error"}),t(ue,{children:e.error})]},"error")]}),Tt=e=>{const{t:n}=H(),{realm:l}=M();return d(ne,{children:[e.userId&&t(oe,{to:Te({realm:l,id:e.userId,tab:"settings"}),children:e.userId},`link-${e.time}-${e.type}`),!e.userId&&n("noUserDetails")]})};function Xt(){const{t:e}=H(),{realm:n}=M(),l=Fe(),[i,g]=y(0),[j,N]=y(!1),[W,$]=y(!1),[U,z]=y(),[I,J]=y({}),X={client:e("client"),dateFrom:e("dateFrom"),dateTo:e("dateTo"),user:e("userId"),type:e("eventType"),ipAddress:e("ipAddress")},{getValues:f,register:R,reset:_,formState:{isDirty:O},control:T,handleSubmit:V}=be({mode:"onChange",defaultValues:_e});He(()=>te.realms.getConfigEvents({realm:n}),s=>z(s),[]);function Z(s,o){return te.realms.findEvents({...I,realm:n,first:s,max:o})}const E=s=>Xe(le({realm:n,tab:s})),k=E("user-events"),D=E("admin-events");function x(){N(!1),v()}function A(){_(),v()}function q(s){const o={...f()};delete o[s],_({..._e,...o}),v()}function Y(s,o){const u=f(),m=u[s],P=Array.isArray(m)?m.filter(a=>a!==o):m;_({...u,[s]:P}),v()}function v(){const s=Re(f(),o=>o!==""||Array.isArray(o)&&o.length>0);J(s),g(i+1)}function Q(){v()}const ee=()=>d(Ae,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[d(G,{children:[t(ge,{id:"user-events-search-select","data-testid":"UserEventsSearchSelector",className:"pf-u-ml-md",toggle:t(ke,{"data-testid":"userEventsSearchSelectorToggle",onToggle:s=>N(s),className:"keycloak__events_search_selector_dropdown__toggle",children:e("searchForUserEvent")}),isOpen:j,children:d(Se,{"data-testid":"searchForm",className:"keycloak__events_search__form",onSubmit:V(x),isHorizontal:!0,children:[t(h,{label:e("userId"),fieldId:"kc-userId",className:"keycloak__events_search__form_label",children:t(b,{id:"kc-userId","data-testid":"userId-searchField",...R("user")})}),t(h,{label:e("eventType"),fieldId:"kc-eventType",className:"keycloak__events_search__form_label",children:t(C,{name:"type",control:T,render:({field:s})=>t(ae,{className:"keycloak__events_search__type_select",name:"eventType","data-testid":"event-type-searchField",chipGroupProps:{numChips:1,expandedText:e("hide"),collapsedText:e("showRemaining")},variant:se.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:o=>$(o),selections:s.value,onSelect:(o,u)=>{const m=u.toString(),P=s.value.includes(m)?s.value.filter(a=>a!==m):[...s.value,m];s.onChange(P)},onClear:o=>{o.stopPropagation(),s.onChange([])},isOpen:W,"aria-labelledby":"eventType",chipGroupComponent:t(K,{children:s.value.map(o=>t(F,{onClick:u=>{u.stopPropagation(),s.onChange(s.value.filter(m=>m!==o))},children:e(`eventTypes.${o}.name`)},o))}),children:U?.enabledEventTypes?.map(o=>t(re,{value:o,children:e(`eventTypes.${o}.name`)},o))})})}),t(h,{label:e("client"),fieldId:"kc-client",className:"keycloak__events_search__form_label",children:t(b,{id:"kc-client","data-testid":"client-searchField",...R("client")})}),t(h,{label:e("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:t(C,{name:"dateFrom",control:T,render:({field:s})=>t(B,{className:"pf-u-w-100",value:s.value,onChange:(o,u)=>s.onChange(u),inputProps:{id:"kc-dateFrom"}})})}),t(h,{label:e("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:t(C,{name:"dateTo",control:T,render:({field:s})=>t(B,{className:"pf-u-w-100",value:s.value,onChange:(o,u)=>s.onChange(u),inputProps:{id:"kc-dateTo"}})})}),t(h,{label:e("ipAddress"),fieldId:"kc-ipAddress",className:"keycloak__events_search__form_label",children:t(b,{id:"kc-ipAddress","data-testid":"ipAddress-searchField",...R("ipAddress")})}),d(Ne,{children:[t(S,{"data-testid":"search-events-btn",variant:"primary",type:"submit",isDisabled:!O,children:e("searchUserEventsBtn")}),t(S,{variant:"secondary",onClick:A,isDisabled:!O,children:e("resetBtn")})]})]})}),t(S,{className:"pf-u-ml-md",onClick:Q,"data-testid":"refresh-btn",children:e("refresh")})]}),t(G,{children:Object.entries(I).length>0&&t("div",{className:"keycloak__searchChips pf-u-ml-md",children:Object.entries(I).map(s=>{const[o,u]=s;return t(K,{className:"pf-u-mt-md pf-u-mr-md",categoryName:X[o],isClosable:!0,onClick:()=>q(o),children:typeof u=="string"?t(F,{isReadOnly:!0,children:u}):u.map(m=>t(F,{onClick:()=>Y(o,m),children:e(`eventTypes.${m}.name`)},m))},o)})})})]});return d(ne,{children:[t(Qe,{titleKey:"titleEvents",subKey:d(ot,{i18nKey:"eventExplain",children:["If you want to configure user events, Admin events or Event listeners, please enter",t(oe,{to:je({realm:n,tab:"events"}),children:e("eventConfig")}),"page realm settings to configure."]}),helpUrl:We.eventsUrl,divider:!1}),t($e,{variant:"light",className:"pf-u-p-0",children:d(Je,{isBox:!0,defaultLocation:le({realm:n,tab:"user-events"}),children:[t(ie,{title:t(ce,{children:e("userEvents")}),...k,children:t("div",{className:"keycloak__events_table",children:t(Ce,{loader:Z,detailColumns:[{name:"details",enabled:s=>s.details!==void 0,cellRenderer:ft}],isPaginated:!0,ariaLabelKey:"titleEvents",toolbarItem:ee(),columns:[{name:"time",displayKey:"time",cellFormatters:[tt],cellRenderer:s=>l(new Date(s.time),Ie)},{name:"userId",displayKey:"user",cellRenderer:Tt},{name:"type",displayKey:"eventType",cellRenderer:_t},{name:"ipAddress",displayKey:"ipAddress",transforms:[Ee(10)]},{name:"clientId",displayKey:"client"}],emptyState:t(ve,{message:e("emptyEvents"),instructions:e("emptyEventsInstructions")}),isSearching:Object.keys(I).length>0},i)})}),t(ie,{title:t(ce,{children:e("adminEvents")}),"data-testid":"admin-events-tab",...D,children:t(yt,{})})]})})]})}export{Xt as default};
//# sourceMappingURL=EventsSection-GFIh4Umm.js.map
