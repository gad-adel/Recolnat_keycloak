import{jsxs as l,Fragment as P,jsx as t}from"react/jsx-runtime";import{useState as L,useMemo as se}from"react";import{bb as W,u as f,f as E,e as g,d as Q,m as N,j as h,A as U,B as K,L as R,bc as j,a4 as oe,M as X,r as re,ay as Y,ax as O,i as $,aG as Z,a8 as le,P as ce,aw as H,b8 as de,am as me,bd as ue,aj as ee,be as pe,bf as ye}from"./index-sihFV1NS.js";import{u as V}from"./ConfirmDialog-WMVurgkl.js";import{V as he,F as fe}from"./ViewHeader-xo54NRb6.js";import{R as te,u as ie}from"./RoutableTabs-a7VqIL_I.js";import{K as F}from"./KeycloakDataTable-Q3kZYP9q.js";import{L as ge}from"./PaginatingTableToolbar--Dt3wwL6.js";import{u as be,F as _}from"./useFormatDate-kyFeutIw.js";import{V as Ce,N as A,W as ne}from"./Td-uwYquKT4.js";import{u as Te}from"./useToggle-mZS4AEtR.js";import{u as De,m as Ae}from"./useLocaleSort-K-jL4v2R.js";import{M as ke,a as Ie}from"./Modal-uOAPm2rX.js";import{e as Le,D as G,a as q,c as z,d as S}from"./DataListItemRow-te2VcAoi.js";import{b as M}from"./ToolbarContent-46I9Yg7h.js";import{a as k,b as I}from"./Tabs-wiayO8Tk.js";import{i as Re,g as Ke}from"./utils-9X4NJJvK.js";import"react-dom";import"./EmptyStateBody-jnnI7hpP.js";import"./_baseRest-lI6NnEVt.js";import"./EmptyStateSecondaryActions-G5doWCZ5.js";import"./TableToolbar-vuixsfwd.js";import"./Form-bfj-xQZn.js";import"./grip-vertical-icon-accuSWkz.js";import"./data-list-CDN1kyj9.js";import"./plus-icon-zbmNbCLY.js";import"./MenuList-82IaVNxu.js";const Pe=()=>({className:Ce.modifiers.wrap}),we=({rootUrl:e,baseUrl:i},n)=>i?.startsWith("http")?i:(e==="${authBaseUrl}"||e==="${authAdminUrl}")&&i?e.replace(/\$\{(authAdminUrl|authBaseUrl)\}/,W(n,i)):e?.startsWith("http")?i?W(e,i):e:i,ve=()=>{const{t:e}=f(),{addAlert:i,addError:n}=E(),{realm:s}=g(),o=be(),c=Q(),[d,m]=L(),a=async()=>{try{return await h.realms.getClientsInitialAccess({realm:s})}catch{return[]}},[y,b]=V({titleKey:"tokenDeleteConfirmTitle",messageKey:e("tokenDeleteConfirm",{id:d?.id}),continueButtonLabel:"delete",continueButtonVariant:N.danger,onConfirm:async()=>{try{await h.realms.delClientsInitialAccess({realm:s,id:d.id}),i(e("tokenDeleteSuccess"),U.success),m(void 0)}catch(r){n("tokenDeleteError",r)}}});return l(P,{children:[t(b,{}),t(F,{ariaLabelKey:"initialAccessToken",searchPlaceholderKey:"searchInitialAccessToken",loader:a,toolbarItem:t(K,{component:r=>t(R,{...r,to:j({realm:s})}),children:e("create")}),actions:[{title:e("delete"),onRowClick:r=>{m(r),y()}}],columns:[{name:"id",displayKey:"id"},{name:"timestamp",displayKey:"timestamp",cellRenderer:r=>o(new Date(r.timestamp*1e3),_)},{name:"expiration",displayKey:"expires",cellRenderer:r=>o(new Date(r.timestamp*1e3+r.expiration*1e3),_)},{name:"count",displayKey:"count"},{name:"remainingCount",displayKey:"remainingCount",transforms:[Pe]}],emptyState:t(ge,{message:e("noTokens"),instructions:e("noTokensInstructions"),primaryActionText:e("create"),onPrimaryAction:()=>c(j({realm:s}))})},d?.id)]})},xe=({onConfirm:e,toggleDialog:i})=>{const{t:n}=f(),s=oe(),o=Object.keys(s.providers?.["client-registration-policy"].providers||[]),c=s.componentTypes?.["org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy"],d=De(),m=se(()=>d(c?.filter(a=>o.includes(a.id))||[],Ae("id")),[o,c]);return t(ke,{variant:Ie.medium,title:n("chooseAPolicyProvider"),isOpen:!0,onClose:i,children:l(Le,{onSelectDataListItem:a=>{e(a),i()},"aria-label":n("addPredefinedMappers"),isCompact:!0,children:[t(G,{"aria-label":n("headerName"),id:"header",children:t(q,{children:t(z,{dataListCells:[n("name"),n("description")].map(a=>t(S,{style:{fontWeight:700},children:a},a))})})}),m.map(a=>t(G,{"aria-label":a.id,"data-testid":a.id,id:a.id,children:t(q,{children:t(z,{dataListCells:[t(S,{width:2,children:a.id},`name-${a.id}`),t(S,{width:4,children:a.helpText},`description-${a.id}`)]})})},a.id))]})})},Be=e=>{const{realm:i}=g(),{subTab:n}=X();return t(R,{to:Y({realm:i,subTab:n||"anonymous",providerId:e.providerId,id:e.id}),children:e.name},e.id)},J=({subType:e})=>{const{t:i}=f(),{subTab:n}=X(),s=Q(),{addAlert:o,addError:c}=E(),{realm:d}=g(),[m,a]=L([]),[y,b]=L(),[r,C]=Te();re(()=>h.components.find({type:"org.keycloak.services.clientregistration.policy.ClientRegistrationPolicy"}),u=>a(u.filter(x=>x.subType===e)),[y]);const[w,v]=V({titleKey:"clientRegisterPolicyDeleteConfirmTitle",messageKey:i("clientRegisterPolicyDeleteConfirm",{name:y?.name}),continueButtonLabel:"delete",continueButtonVariant:N.danger,onConfirm:async()=>{try{await h.components.del({realm:d,id:y?.id}),o(i("clientRegisterPolicyDeleteSuccess")),b(void 0)}catch(u){c("clientRegisterPolicyDeleteError",u)}}});return l(P,{children:[r&&t(xe,{onConfirm:u=>s(Y({realm:d,subTab:n||"anonymous",providerId:u})),toggleDialog:C}),t(v,{}),t(F,{ariaLabelKey:"initialAccessToken",searchPlaceholderKey:"searchInitialAccessToken",loader:m,toolbarItem:t(M,{children:t(K,{"data-testid":"createPolicy",onClick:C,children:i("createPolicy")})}),actions:[{title:i("delete"),onRowClick:u=>{b(u),w()}}],columns:[{name:"name",displayKey:"name",cellRenderer:Be},{name:"providerId",displayKey:"providerId"}]})]})},Se=()=>{const{t:e}=f(),{realm:i}=g(),n=c=>ie(O({realm:i,subTab:c})),s=n("anonymous"),o=n("authenticated");return l(te,{defaultLocation:O({realm:i,subTab:"anonymous"}),mountOnEnter:!0,children:[t(k,{"data-testid":"anonymous",title:l(I,{children:[e("anonymousAccessPolicies")," ",t($,{fieldLabelId:"",helpText:e("anonymousAccessPoliciesHelp"),noVerticalAlign:!1,unWrap:!0})]}),...s,children:t(J,{subType:"anonymous"})}),t(k,{"data-testid":"authenticated",title:l(I,{children:[e("authenticatedAccessPolicies")," ",t($,{fieldLabelId:"",helpText:e("authenticatedAccessPoliciesHelp"),noVerticalAlign:!1,unWrap:!0})]}),...o,children:t(J,{subType:"authenticated"})})]})},Me=e=>{const{t:i}=f(),{realm:n}=g();return l(R,{to:me({realm:n,clientId:e.id,tab:"settings"}),children:[e.clientId,!e.enabled&&t(ue,{isRead:!0,className:"pf-u-ml-sm",children:i("disabled")},`${e.id}-disabled`)]},e.id)},Ee=e=>t(ne,{wrapModifier:"truncate",children:ee()(e.name)}),Ne=e=>t(ne,{wrapModifier:"truncate",children:ee()(e.description)}),Ve=e=>{const i=we(e,h.baseUrl);return i?t(fe,{href:i}):"â€”"},Fe=()=>{const{t:e}=f(),{realm:i}=g(),{hasAccess:n}=Z();return n("manage-clients")?l(P,{children:[t(M,{children:t(K,{component:o=>t(R,{...o,to:pe({realm:i})}),children:e("createClient")})}),t(M,{children:t(K,{component:o=>t(R,{...o,to:ye({realm:i})}),variant:"link","data-testid":"importClient",children:e("importClient")})})]}):t("span",{})};function ut(){const{t:e}=f(),{addAlert:i,addError:n}=E(),{realm:s}=g(),[o,c]=L(0),d=()=>c(new Date().getTime()),[m,a]=L(),{hasAccess:y}=Z(),b=y("manage-clients"),r=async(p,T,D)=>{const B={first:p,max:T};return D&&(B.clientId=D,B.search=!0),await h.clients.find({...B})},C=p=>ie(H({realm:s,tab:p})),w=C("list"),v=C("initial-access-token"),u=C("client-registration"),[x,ae]=V({titleKey:e("clientDelete",{clientId:m?.clientId}),messageKey:"clientDeleteConfirm",continueButtonLabel:"delete",continueButtonVariant:N.danger,onConfirm:async()=>{try{await h.clients.del({id:m.id}),i(e("clientDeletedSuccess"),U.success),d()}catch(p){n("clientDeleteError",p)}}});return l(P,{children:[t(he,{titleKey:"clientList",subKey:"clientsExplain",helpUrl:le.clientsUrl,divider:!1}),t(ce,{variant:"light",className:"pf-u-p-0",children:l(te,{mountOnEnter:!0,isBox:!0,defaultLocation:H({realm:s,tab:"list"}),children:[l(k,{"data-testid":"list",title:t(I,{children:e("clientsList")}),...w,children:[t(ae,{}),t(F,{loader:r,isPaginated:!0,ariaLabelKey:"clientList",searchPlaceholderKey:"searchForClient",toolbarItem:t(Fe,{}),actionResolver:p=>{const T=p.data,D=[{title:e("export"),onClick(){de(T)}}];return!Re(T)&&(b||T.access?.configure)&&D.push({title:e("delete"),onClick(){a(T),x()}}),D},columns:[{name:"clientId",displayKey:"clientId",transforms:[A(20)],cellRenderer:Me},{name:"clientName",displayKey:"clientName",transforms:[A(20)],cellRenderer:Ee},{name:"protocol",displayKey:"type",transforms:[A(10)],cellRenderer:p=>Ke(e,p.protocol??"openid-connect")},{name:"description",displayKey:"description",transforms:[A(30)],cellRenderer:Ne},{name:"baseUrl",displayKey:"homeURL",transforms:[A(20)],cellRenderer:Ve}]},o)]}),t(k,{"data-testid":"initialAccessToken",title:t(I,{children:e("initialAccessToken")}),...v,children:t(ve,{})}),t(k,{"data-testid":"registration",title:t(I,{children:e("clientRegistration")}),...u,children:t(Se,{})})]})})]})}export{ut as default};
//# sourceMappingURL=ClientsSection-NuedAl0j.js.map
